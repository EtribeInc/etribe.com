var Vr=pc.createScript("vr");Vr.attributes.add("buttonVr",{type:"entity",title:"VR Button"}),Vr.attributes.add("elementUnsupported",{type:"entity",title:"Unsupported Message"}),Vr.attributes.add("elementHttpsRequired",{type:"entity",title:"HTTPS Required Message"}),Vr.attributes.add("cameraEntity",{type:"entity",title:"Camera"}),Vr.prototype.initialize=function(){this.app.xr.on("available:"+pc.XRTYPE_VR,this.checkButton,this),this.app.xr.on("start",this.checkButton,this),this.app.xr.on("end",this.checkButton,this),this.buttonVr.element.on("click",(function(){this.sessionStart()}),this),this.app.keyboard.on("keydown",(function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.active&&this.app.xr.end()}),this),this.checkButton()},Vr.prototype.checkButton=function(){if(this.app.xr.supported)if(this.elementHttpsRequired.enabled=!1,this.elementUnsupported.enabled=!1,this.app.xr.active)this.buttonVr.enabled=!1;else{this.buttonVr.enabled=!0;var t=this.app.xr&&!this.app.xr.active&&this.app.xr.isAvailable(pc.XRTYPE_VR);this.buttonVr.element.opacity=t?.2:.1,this.buttonVr.children[0].element.opacity=t?1:.2}else this.buttonVr.enabled=!1,"https:"==window.location.protocol?(this.elementUnsupported.enabled=!0,this.elementHttpsRequired.enabled=!1):(this.elementUnsupported.enabled=!1,this.elementHttpsRequired.enabled=!0)},Vr.prototype.sessionStart=function(){this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"==t&&window.addEventListener("deviceorientation",function(t){this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCAL)}.bind(this))}.bind(this)).catch(console.error):this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCAL)))};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"entity",title:"Controller Template"}),Controllers.attributes.add("cameraParent",{type:"entity",title:"Camera Parent"}),Controllers.prototype.initialize=function(){this.app.xr.input.on("add",(function(t){var e=this.controllerTemplate.clone();e.script.controller.setInputSource(t),e.reparent(this.cameraParent),e.enabled=!0}),this)};var Controller=pc.createScript("controller");Controller.prototype.initialize=function(){this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.matA=new pc.Mat4,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.modelEntity=this.entity.findByName("model"),this.hoverEntity=null,this.targetPointerSize=2,this.targetTeleportable=!1,this.pointer=this.entity.findByName("pointer"),this.pointer.element.material.depthTest=!1,this.hoverPoint=new pc.Vec3,this.pointerDistance=3},Controller.prototype.setInputSource=function(t){this.inputSource=t,this.inputSource.once("remove",this.onRemove,this),this.on("hover",this.onHover,this),this.on("blur",this.onBlur,this),this.inputSource.on("select",this.onSelect,this)},Controller.prototype.onRemove=function(){this.entity.destroy()},Controller.prototype.onSelect=function(){if(this.app.fire("object:pick",this),this.hoverEntity)if(this.targetTeleportable)this.app.fire("controller:teleport",this.hoverPoint);else if(this.hoverEntity.tags.has("interactive")){var t=this.hoverEntity.model.meshInstances[0];t.pickedColor||(t.pickedColor=new pc.Color),t.pickedColor.set(Math.random(),Math.random(),Math.random()),t.setParameter("material_diffuse",t.pickedColor.data3)}},Controller.prototype.onHover=function(t,e){this.hoverEntity=t,this.hoverPoint.copy(e),this.targetPointerSize=16,this.targetTeleportable=this.hoverEntity.tags.has("teleportable")},Controller.prototype.onBlur=function(){this.hoverEntity=null,this.targetPointerSize=4,this.targetTeleportable=!1},Controller.prototype.update=function(t){if(this.app.fire("object:pick",this),this.inputSource.grip&&(this.modelEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation()),this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(0,1,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color)),this.hoverEntity){var e=this.vecA.copy(this.hoverPoint).sub(this.inputSource.getOrigin()).length();this.pointerDistance+=.3*(e-this.pointerDistance)}this.vecA.copy(this.inputSource.getDirection()).scale(this.pointerDistance).add(this.inputSource.getOrigin()),this.pointer.setPosition(this.vecA);var i=this.targetPointerSize*(this.targetTeleportable?8:1);this.pointer.element.width!==i&&(this.pointer.element.width+=.3*(i-this.pointer.element.width),Math.abs(this.pointer.element.width-i)<=1&&(this.pointer.element.width=i),this.pointer.element.height=this.pointer.element.width),this.targetTeleportable?this.pointer.setEulerAngles(-90,0,0):this.app.xr.camera&&(this.pointer.lookAt(this.app.xr.camera.getPosition(),pc.Vec3.DOWN),this.pointer.rotateLocal(0,180,0));var o=this.inputSource.gamepad;o&&(this.inputSource.handedness===pc.XRHAND_LEFT&&(o.axes[3]||o.axes[2])?this.app.fire("controller:move",o.axes[2],o.axes[3],t):this.inputSource.handedness===pc.XRHAND_RIGHT&&o.axes[2]&&this.app.fire("controller:rotate",-o.axes[2],t))};var ObjectPicker=pc.createScript("objectPicker");ObjectPicker.prototype.initialize=function(){this.entities=this.app.root.findByTag("pickable"),this.ray=new pc.Ray,this.vec3A=new pc.Vec3,this.vec3B=new pc.Vec3,this.app.on("object:pick",this.pick,this)},ObjectPicker.prototype.pick=function(i){var t=null,e=1/0;this.ray.set(i.inputSource.getOrigin(),i.inputSource.getDirection());for(var c=0;c<this.entities.length;c++){if(this.entities[c].model)if(this.entities[c].model.meshInstances[0].aabb.intersectsRay(this.ray,this.vec3A)){var s=this.vec3A.distance(this.ray.origin);s<e&&(e=s,t=this.entities[c],this.vec3B.copy(this.vec3A))}}t?i.fire("hover",t,this.vec3B):i.hoverEntity&&i.fire("blur")};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0!==r&&0!==n&&(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var CameraController=pc.createScript("camera-controller");CameraController.attributes.add("height",{type:"number",default:1.6,placeholder:"m",title:"Height from Floor"}),CameraController.attributes.add("movementSpeed",{type:"number",default:1.5,placeholder:"m/s",title:"Movement Speed"}),CameraController.attributes.add("rotateSpeed",{type:"number",default:45,placeholder:"Â°",title:"Rotation Speed"}),CameraController.attributes.add("rotateThreshold",{type:"number",default:.5,min:0,max:1,title:"Rotation thumbstick threshold"}),CameraController.attributes.add("rotateResetThreshold",{type:"number",default:.25,min:0,max:1,title:"Rotation thumbstick reset threshold"}),CameraController.attributes.add("camera",{type:"entity",title:"Camera Entity"}),CameraController.prototype.initialize=function(){this.vec2A=new pc.Vec2,this.vec2B=new pc.Vec2,this.vec3A=new pc.Vec3,this.lastRotate=0,this.lastRotateValue=0,this.app.on("controller:teleport",this.onTeleport,this),this.app.on("controller:move",this.onMove,this),this.app.on("controller:rotate",this.onRotate,this)},CameraController.prototype.onTeleport=function(t){this.app.xr.type!==pc.XRTYPE_AR&&(this.vec3A.copy(this.camera.getLocalPosition()).scale(-1),this.entity.setPosition(t),this.entity.translate(0,this.height,0),this.entity.translateLocal(this.vec3A))},CameraController.prototype.onMove=function(t,e,a){if(this.vec2A.set(t,e),this.vec2A.length()){this.vec2A.normalize(),this.vec2B.x=this.camera.forward.x,this.vec2B.y=this.camera.forward.z,this.vec2B.normalize();var o=Math.atan2(this.vec2B.x,this.vec2B.y)-Math.PI/2,i=this.vec2A.x*Math.sin(o)-this.vec2A.y*Math.cos(o);this.vec2A.y=this.vec2A.y*Math.sin(o)+this.vec2A.x*Math.cos(o),this.vec2A.x=i,this.vec2A.scale(this.movementSpeed),this.entity.translate(this.vec2A.x*a,0,this.vec2A.y*a)}},CameraController.prototype.onRotate=function(t,e){if(!(Date.now()-this.lastRotate<200)){if(0!==this.lastRotateValue)if(this.lastRotateValue>0){if(!(t<this.rotateResetThreshold))return;this.lastRotateValue=0}else{if(!(t>-this.rotateResetThreshold))return;this.lastRotateValue=0}Math.abs(t)>this.rotateThreshold&&(this.lastRotateValue=Math.sign(t),this.vec3A.copy(this.camera.getLocalPosition()),this.entity.translateLocal(this.vec3A),this.entity.rotateLocal(0,Math.sign(t)*this.rotateSpeed,0),this.entity.translateLocal(this.vec3A.scale(-1)))}};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("speed",{type:"number",default:1.5,description:"speed multiplier for movement"}),CameraMovement.attributes.add("lookSpeed",{type:"number",default:.2,description:"speed multiplier for mouse lookaround"});var startingHeight=0;CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mousedown",(function(){this.app.mouse.enablePointerLock()}),this),startingHeight=this.entity.getPosition().y},CameraMovement.prototype.update=function(e){this.force,this.forward,this.right;this.app.keyboard.isPressed(pc.KEY_W)&&this.entity.translateLocal(0,0,-.01*this.speed),this.app.keyboard.isPressed(pc.KEY_A)&&this.entity.translateLocal(-.01*this.speed,0,0),this.app.keyboard.isPressed(pc.KEY_S)&&this.entity.translateLocal(0,0,.01*this.speed),this.app.keyboard.isPressed(pc.KEY_D)&&this.entity.translateLocal(.01*this.speed,0,0);var t=this.entity.getPosition(),s=new pc.Vec3(t.x,startingHeight,t.z);this.entity.setPosition(s),this.entity.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},CameraMovement.prototype.onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)};