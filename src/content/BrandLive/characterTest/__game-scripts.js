var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.attributes.add("lerpSpeed",{title:"Lerp Speed",description:"Speed to adjust how fast the cropping to detected face is adjusted.",type:"number",default:2}),VideoTexture.prototype.initialize=function(){var e=this.app,t=this;t.cropArea=[[0,0],[0,0]],t.cropTarget=[[0,0],[0,0]],t.lerpedCrop=[[0,0],[0,0]],t.faceReady=!1,t.videoPlaying=!1,t.lerpVal=0,t.workerScript=this.app.assets.find("tfjs-faceDetection-worker.js"),t.worker=new Worker(t.workerScript.getFileUrl()),t.video=document.createElement("video"),t.canvas=document.createElement("canvas"),t.canvasSrc=document.createElement("canvas"),t.video.loop=!0,t.video.muted=!0,t.video.playsInline=!0;var i=t.video.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t.video),t.canvas.style.width="200px",t.canvas.style.height="200px",t.canvas.style.position="absolute",t.canvas.width=256,t.canvas.height=256,t.ctx=t.canvas.getContext("2d"),document.body.appendChild(t.canvas),t.canvasSrc.style.visibility="hidden",t.canvasSrc.style.width="1px",t.canvasSrc.style.height="1px",t.ctxSrc=t.canvasSrc.getContext("2d"),document.body.appendChild(t.canvasSrc),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t.canvas);navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(i){t.video.srcObject=i,t.video.onloadedmetadata=function(e){t.canvasSrc.width=this.videoWidth,t.canvasSrc.height=this.videoHeight},t.video.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.video.play()}.bind(this))}.bind(this)).catch((function(e){console.log(e.name+": "+e.message)})),t.video.addEventListener("play",(function(){t.videoPlaying=!0,t.worker.addEventListener("message",(e=>{t.faceReady=!0,e.data&&(t.lerpVal=0,t.cropArea=t.lerpedCrop,t.cropTarget=e.data),t.processFrame()})),t.processFrame()}),!1)},VideoTexture.prototype.processFrame=function(){if(this.videoPlaying){this.ctxSrc.drawImage(this.video,0,0,this.canvasSrc.width,this.canvasSrc.height);var e=this.ctxSrc.getImageData(0,0,this.canvasSrc.width,this.canvasSrc.height).data;this.worker.postMessage({data:e,width:this.canvasSrc.width,height:this.canvasSrc.height})}},VideoTexture.prototype.update=function(e){this.faceReady&&(this.updateVideoCanvas(e),this.videoTexture.upload())},VideoTexture.prototype.updateVideoCanvas=function(e){var t=Math.max(Math.abs(this.lerpedCrop[0][0]-this.cropTarget[0][0]),Math.abs(this.lerpedCrop[1][1]-this.cropTarget[1][1]),Math.abs(this.lerpedCrop[0][1]-this.cropTarget[0][1]),Math.abs(this.lerpedCrop[1][0]-this.cropTarget[1][0]));this.lerpVal+=e*this.lerpSpeed*t,this.lerpedCrop[0][0]=pc.math.lerp(this.cropArea[0][0],this.cropTarget[0][0],this.lerpVal),this.lerpedCrop[0][1]=pc.math.lerp(this.cropArea[0][1],this.cropTarget[0][1],this.lerpVal),this.lerpedCrop[1][0]=pc.math.lerp(this.cropArea[1][0],this.cropTarget[1][0],this.lerpVal),this.lerpedCrop[1][1]=pc.math.lerp(this.cropArea[1][1],this.cropTarget[1][1],this.lerpVal);var i=this.lerpedCrop[1][0]-this.lerpedCrop[0][0],a=this.lerpedCrop[1][1]-this.lerpedCrop[0][1];this.ctx.drawImage(this.video,this.lerpedCrop[0][0]*this.video.videoWidth,this.lerpedCrop[0][1]*this.video.videoHeight,i*this.video.videoWidth,a*this.video.videoHeight,0,0,this.canvas.width,this.canvas.height)};var TvScreen=pc.createScript("screenMat");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};var AnimateRotation=pc.createScript("animateRotation");AnimateRotation.attributes.add("offsetCurve",{type:"curve",title:"Offset Curve",curves:["x","y","z"]}),AnimateRotation.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimateRotation.prototype.initialize=function(){this.startRotation=this.entity.getEulerAngles().clone(),this.rotation=new pc.Vec3,this.time=0},AnimateRotation.prototype.update=function(t){this.time+=t,this.time>this.duration&&(this.time-=this.duration);var i=this.time/this.duration,e=this.offsetCurve.value(i);this.rotation.copy(this.startRotation),this.rotation.x+=e[0],this.rotation.y+=e[1],this.rotation.z+=e[2],this.entity.setEulerAngles(this.rotation)};var AnimatePosition=pc.createScript("animatePosition");AnimatePosition.attributes.add("targetPos",{type:"vec3",title:"Target Position"}),AnimatePosition.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimatePosition.prototype.initialize=function(){this.entity.tween(this.entity.getLocalPosition()).to(this.targetPos,this.duration,pc.SineInOut).loop(!0).yoyo(!0).start()},AnimatePosition.prototype.update=function(t){};var SpatialAudioSource=pc.createScript("spatialAudio_Source");SpatialAudioSource.attributes.add("audioFile",{type:"asset",assetType:"audio"}),SpatialAudioSource.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.play,this);let i=this.app.root.children[0].findOne((function(i){return i.script&&i.script.spatialAudio_Listener}));i&&(this.audioListener=i.script.spatialAudio_Listener),this.audioSource=document.createElement("audio"),console.log(this.audioFile.url),this.audioSource.src=this.audioFile.getFileUrl(),this.audioListener&&this.addAudioSource(this.audioSource)},SpatialAudioSource.prototype.update=function(i){if(this.source){var t=this.entity.getPosition(),e=this.entity.up,o=this.entity.forward;this.source.setPosition(t.x,t.y,t.z),this.source.setOrientation(o.x,o.y,o.z,e.x,e.y,e.z)}},SpatialAudioSource.prototype.play=function(){this.audioSource&&this.audioSource.play()},SpatialAudioSource.prototype.addAudioSource=function(i){let t=this.audioListener.audioContext.createMediaElementSource(i);this.source=this.audioListener.resonanceAudioScene.createSource(),t.connect(this.source.input)};var SpatialAudioListener=pc.createScript("spatialAudio_Listener");SpatialAudioListener.attributes.add("roomDimensions",{title:"Room Dimensions",type:"json",schema:[{name:"width",type:"number",default:5},{name:"height",type:"number",default:3},{name:"depth",type:"number",default:5}]}),SpatialAudioListener.attributes.add("roomMaterials",{title:"Room Materials",type:"json",schema:[{name:"left",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"right",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"front",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"back",type:"string",default:"brick-bare",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"down",type:"string",default:"parquet-on-concrete",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"up",type:"string",default:"wood-ceiling",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]}]}),SpatialAudioListener.prototype.initialize=function(){this.audioContext=this.app.systems.sound.context,this.resonanceAudioScene=new ResonanceAudio(this.audioContext),this.resonanceAudioScene.output.connect(this.audioContext.destination),this.setRoom()},SpatialAudioListener.prototype.update=function(e){var t=this.entity.getPosition(),o=this.entity.up,i=this.entity.forward;this.resonanceAudioScene.setListenerPosition(t.x,t.y,t.z),this.resonanceAudioScene.setListenerOrientation(i.x,i.y,i.z,o.x,o.y,o.z)},SpatialAudioListener.prototype.setRoom=function(){let e={width:this.roomDimensions.width,height:this.roomDimensions.height,depth:this.roomDimensions.depth},t={left:this.roomMaterials.left,right:this.roomMaterials.right,front:this.roomMaterials.front,back:this.roomMaterials.back,down:this.roomMaterials.down,up:this.roomMaterials.up};this.resonanceAudioScene.setRoomProperties(e,t)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=0===this.duration?1:this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();var AnimationHandler=pc.createScript("animationHandler");AnimationHandler.attributes.add("workerFileName",{title:"Hand Pose Worker",description:"Hand Pose Worker Script Name",type:"string",default:"tfjs-handPose-worker.js"}),AnimationHandler.attributes.add("useHandPose",{title:"Use Hand Pose",description:"Use Hand Pose Detection",type:"boolean",default:!1}),AnimationHandler.prototype.initialize=function(){this.useHandPose&&this.initTFJS(),this.app.on("player:move",this.onPlayerMove,this),this.on("destroy",(function(){this.app.off("player:move",this.onPlayerMove)})),this.app.on("player:stop",this.onPlayerStop,this),this.on("destroy",(function(){this.app.off("player:stop",this.onPlayerStop)}))},AnimationHandler.prototype.onKeyDown=function(e){e.event.preventDefault()},AnimationHandler.prototype.onKeyUp=function(e){},AnimationHandler.prototype.onPlayerMove=function(){this.entity.anim.setBoolean("Forward",!0)},AnimationHandler.prototype.onPlayerStop=function(){this.entity.anim.setBoolean("Forward",!1)},AnimationHandler.prototype.initTFJS=function(){console.log("Initializing Hand Pose tracking");var e=this;e.state="idle",e.video=document.querySelector("video"),e.videoPlaying=!1,e.canvas=document.createElement("canvas"),e.ctx=e.canvas.getContext("2d"),e.workerScript=this.app.assets.find(e.workerFileName),e.worker=new Worker(e.workerScript.getFileUrl()),e.video.addEventListener("play",(function(){videoPlaying=!0,e.worker.addEventListener("message",(t=>{const a=t.data;e.state,console.log(a),e.processFrame()})),e.processFrame()}),!1)},AnimationHandler.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_UP)?(console.log("Walk forward"),this.entity.anim.setBoolean("Forward",!0)):this.app.keyboard.wasReleased(pc.KEY_UP)&&this.entity.anim.setBoolean("Forward",!1),this.app.keyboard.wasPressed(pc.KEY_DOWN)?(console.log("Walk backward"),this.entity.anim.setBoolean("Backwards",!0)):this.app.keyboard.wasReleased(pc.KEY_DOWN)&&this.entity.anim.setBoolean("Backwards",!1)},AnimationHandler.prototype.processFrame=function(){if(videoPlaying){this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height);var e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data;this.worker.postMessage({data:e,width:this.canvas.width,height:this.canvas.height})}};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("playerSpeed",{type:"number",default:2,title:"Player Speed"}),PlayerController.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PlayerController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,.5,0),this.rayStart=new pc.Vec3,this.rayEnd=new pc.Vec3,this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.app.on("player:target",this.onNewTarget,this),this.on("destroy",(function(){this.app.off("player:target",this.onNewTarget)})),this.angle=0,this.targetAngle=0},PlayerController.newPosition=new pc.Vec3,PlayerController.prototype.update=function(t){if(Math.abs(this.angle)<Math.abs(this.targetAngle)){var e=t*this.targetAngle*5;this.angle+=e,Math.abs(this.angle)>Math.abs(this.targetAngle)?this.playerEntity.lookAt(this.targetPosition):this.entity.rotateLocal(0,e,0)}else if(this.direction.lengthSq()>0){this.app.fire("player:move");var i=this.playerSpeed*t,r=PlayerController.newPosition;r.copy(this.direction).scale(i),r.add(this.playerEntity.getPosition()),this.rayStart.add2(r,this.groundCheckRay),this.rayEnd.sub2(r,this.groundCheckRay);var a=this.app.systems.rigidbody.raycastFirst(this.rayStart,this.rayEnd);a?(r=a.point,this.playerEntity.setPosition(r),this.distanceToTravel-=i):(this.targetPosition.copy(this.playerEntity.getPosition()),this.distanceToTravel=0),this.distanceToTravel<=0&&(this.direction.set(0,0,0),this.app.fire("player:stop"))}},PlayerController.prototype.onNewTarget=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.playerEntity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.playerEntity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.angle=0,this.targetAngle=this.entity.forward.angle(this.direction)):this.direction.set(0,0,0)};var InputHandler=pc.createScript("inputHandler");InputHandler.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),InputHandler.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),InputHandler.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),InputHandler.prototype.initialize=function(){this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(4,.001,4)),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this)},InputHandler.newPosition=new pc.Vec3,InputHandler.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},InputHandler.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())},InputHandler.ray=new pc.Ray,InputHandler.hitPosition=new pc.Vec3,InputHandler.prototype.doRayCast=function(t){var e=this.cameraEntity.getPosition(),n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),a=this.app.systems.rigidbody.raycastFirst(e,n);console.log(a),a&&a.entity.tags.has(["Raycast","Movement"])&&this.app.fire("player:target",a.point)};var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),CameraFollow.attributes.add("targetEntity",{type:"entity",title:"Target Entity"}),CameraFollow.prototype.initialize=function(){},CameraFollow.prototype.update=function(t){this.cameraEntity.setPosition(this.targetEntity.getPosition())};!function(){for(var t=[],o=[],r=0,a=0,c=0;c<256;c++)o.push(new pc.Vec3),t.push(new pc.Quat);function Q(o){var a=t[255&r++];return!1!==o&&a.copy(o||pc.Quat.IDENTITY),a}function V(t,r,c){var n=o[255&a++];if(void 0!==r&&void 0!==c){var e=n.data;return e[0]=t,e[1]=r,e[2]=c,n}if(void 0!==t){var p=n.data,i=t.data;p[0]=i[0],p[1]=i[1],p[2]=i[2]}return n}function orthogonal(t){var o=Math.abs(t.x),r=Math.abs(t.y),a=Math.abs(t.z),c=o<r?o<a?pc.Vec3.RIGHT:pc.Vec3.FORWARD:r<a?pc.Vec3.UP:pc.Vec3.FORWARD;return V().cross(t,c)}pc.Vec3.temp=V,pc.Quat.temp=Q,pc.Vec3.prototype.angle=function(t,o){return function angleBetween(t,o,r){return r=r||pc.Vec3.UP,Math.atan2(V().cross(t,o).dot(r),t.dot(o))*pc.math.RAD_TO_DEG}(this,t,o)},pc.Quat.prototype.fromToRotation=function(t,o){return function fromToRotation(t,o,r){var a=t.dot(o);if(r=r||Q(),a<=-.999){r.w=0;var c=orthogonal(t).normalize();return r.x=c.x,r.y=c.y,r.z=c.z,r}var n=V(t).add(o).scale(.5);r.w=t.dot(n);var e=V().cross(t,n);return r.x=e.x,r.y=e.y,r.z=e.z,r.normalize()}(t,o,this)},pc.Quat.prototype.twist=function(t){var o=orthogonal(t),r=this.transformVector(o,V()),a=V(r).sub(V(t).scale(r.dot(t))).normalize(),c=Math.acos(o.dot(a))*pc.math.RAD_TO_DEG;return V(this.x,this.y,this.z).dot(t)>0?-c:c};var n=new pc.Mat4;pc.Quat.prototype.lookAt=function(t,o,r){return n.setLookAt(t,o,r||pc.Vec3.UP),this.setFromMat4(n),this};var e=pc.Vec3.prototype.mul;pc.Vec3.prototype.mul=function(t,o,r){return t instanceof pc.Quat?t.transformVector(this,this):e.call(this,t,o,r)}}();var AnimationLooper=pc.createScript("animationLooper");AnimationLooper.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},AnimationLooper.prototype.update=function(i){},AnimationLooper.prototype.onKeyDown=function(i){i.key===pc.KEY_R?this.entity.animation.play("walk.glb",.2):i.key===pc.KEY_E?this.entity.animation.play("idle.glb",.2):i.key===pc.KEY_W&&this.entity.animation.play("Wave.glb",.2)};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://etribe.com/content/BrandLive/images/splashLogo_01.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));!function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,n){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const d=a(n(1)),c=a(n(2)),l=a(n(3)),u=a(n(5));new d.default,new c.default,new l.default,new u.default,console.log("Orestis 3D Pathfinding v2.0.5")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.createPcScript()}createPcScript(){const t=pc.createScript("orestisAgent");this.attachAttributes(t),t.prototype.initialize=function(){let t;this.agentId=void 0,this.crowd=void 0,pc.events.attach(this.entity),this.on("attr",(()=>{window.clearTimeout(t),t=window.setTimeout(this.updateAgentAttributes.bind(this),300)})),this.entity.on("OrestisPathfinding:updateAgentAttributes",this.updateAgentAttributes,this)},t.prototype.onAddAgent=function(t,e){this.agentId=t,this.crowd=e},t.prototype.updateAgentAttributes=function(){this.crowd.updateAgentParameters(this.agentId,{radius:this.radius,height:this.height,maxAcceleration:this.maxAcceleration,maxSpeed:this.maxSpeed,collisionQueryRange:this.collisionQueryRange,pathOptimizationRange:this.pathOptimizationRange,separationWeight:this.separationWeight,stopDistance:this.stopDistance,orientAgent:this.orientAgent,orientInertia:this.orientInertia})}}attachAttributes(t){t.attributes.add("radius",{type:"number",default:.5,min:0,title:"Radius",description:"Agent radius. [Limit: >= 0]"}),t.attributes.add("height",{type:"number",default:1,min:0,title:"Height",description:"Agent height. [Limit: >= 0]"}),t.attributes.add("maxAcceleration",{type:"number",default:1,min:0,title:"Max Acceleration",description:"Maximum allowed acceleration. [Limit: >= 0]"}),t.attributes.add("maxSpeed",{type:"number",default:1,min:0,title:"Max Speed",description:"Maximum allowed speed. [Limit: >= 0]"}),t.attributes.add("collisionQueryRange",{type:"number",default:.5,min:0,title:"Collision Query Range",description:"Defines how close a collision element must be before it is considered for steering behaviors. [Limits: > 0]"}),t.attributes.add("pathOptimizationRange",{type:"number",default:0,min:0,title:"Path Optimization Range",description:"The path visibility optimization range. [Limit: > 0]"}),t.attributes.add("separationWeight",{type:"number",default:1,min:0,title:"Separation Weight",description:"How aggressive the agent manager should be at avoiding collisions with this agent. [Limit: >= 0]"}),t.attributes.add("stopDistance",{type:"number",default:0,title:"Stop Distance",description:"The distance from the path end point this agent should stop at. If 0.0 is provided the agent will reach as close as possible to the end point."}),t.attributes.add("orientInertia",{type:"number",default:.1,title:"Orient Inertia",description:"How smoothly the agent entity will rotate to orient itself."}),t.attributes.add("orientAgent",{type:"boolean",default:!0,title:"Orient Agent",description:"If selected the agent entity will automatically orient itself on the Y axis to look at the next point on the path."})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.createPcScript()}createPcScript(){const t=pc.createScript("orestisObstacle");this.attachAttributes(t),t.prototype.initialize=function(){this.pathfinder=void 0,this.obstacleRef=void 0,this.state=this.initialState,this.obstaclePos=this.entity.getPosition().clone(),this.entity.on("OrestisPathfinding:initializeObstacle",this.initializeObstacle,this),this.on("state",(function(t){this.updateObstacle(t)}),this)},t.prototype.initializeObstacle=function(t){var e,n,a;if(t)this.pathfinder=t;else{if(!this.pathfinderEntity)return;this.pathfinder=null===(a=null===(n=null===(e=this.pathfinderEntity)||void 0===e?void 0:e.script)||void 0===n?void 0:n.orestisPathfinding)||void 0===a?void 0:a.pathfinder}this.updateObstacle(this.state)},t.prototype.updateObstacle=function(t){this.state=!0===t;const e=this.pathfinder;if(!0===t){let t;switch(this.obstacleType){case"box":t=e.addBoxObstacle(this.obstaclePos,this.boxExtents,this.boxYAngle*pc.math.DEG_TO_RAD);break;case"cylinder":t=e.addCylinderObstacle(this.obstaclePos,this.cylinderRadius,this.cylinderHeight)}this.obstacleRef=t}else e.removeObstacle(this.obstacleRef),this.obstacleRef=void 0,e.navMesh.update()}}attachAttributes(t){t.attributes.add("pathfinderEntity",{type:"entity",title:"Pathfinder",description:"Drag and drop the pathfinder entity this obstacle should interact with. Updating this requires regenerating the navmesh or reloading your app"}),t.attributes.add("obstacleType",{type:"string",default:"box",title:"Obstacle Type",description:"Set the type of the obstacle shape.",enum:[{Box:"box"},{Cylinder:"cylinder"}]}),t.attributes.add("boxExtents",{type:"vec3",default:[1,1,1],title:"Box Extents",description:"The box extents on each axis."}),t.attributes.add("boxYAngle",{type:"number",default:0,min:0,max:360,title:"Box Y Angle",description:"The angle of the box orientation on the Y axis."}),t.attributes.add("cylinderRadius",{type:"number",default:1,min:0,title:"Cylinder Radius",description:"The cylinder radius."}),t.attributes.add("cylinderHeight",{type:"number",default:2,min:0,title:"Cylinder Height",description:"The cylinder height."}),t.attributes.add("initialState",{type:"boolean",default:!0,title:"Initial State",description:"If the obstacle will be enabled or disabled when the navmesh is generated."})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=n(4);e.default=class{constructor(){this.createPcScript()}createPcScript(){const t=pc.createScript("orestisCrowd");this.attachAttributes(t),t.prototype.initialize=function(){this.pathfinder=void 0,this.crowd=void 0,this.agentsList=void 0,this.activeAgents=void 0,this.debugPath=void 0,this.debugColors=void 0,this.debugDestination=void 0,this.debugLineColor=new pc.Color(1,1,1,.5),pc.events.attach(this.entity),this.entity.on("OrestisPathfinding:moveCrowdTo",(function(t,e){this.moveCrowdTo(null,t,e)}),this),this.entity.on("OrestisPathfinding:moveAgentsTo",(function(t,e,n){this.moveCrowdTo(t,e,n)}),this),this.entity.on("OrestisPathfinding:stopCrowd",(function(){this.stopCrowd(null)}),this),this.entity.on("OrestisPathfinding:stopAgents",(function(t){this.stopCrowd(t)}),this),this.entity.on("OrestisPathfinding:teleportAgentsTo",(function(t,e,n){this.teleportAgentsTo(t,e)}),this),this.on("attr",(function(t,e){this.initializeCrowd()}))},t.prototype.initializeCrowd=function(t){t&&(this.pathfinder=t),this.crowd&&this.crowd.destroy(),this.crowd=new a.OrestisCrowd(this,this.pathfinder,this.maxAgents,this.maxAgentRadius),this.assignAgents()},t.prototype.destroyCrowd=function(){this.crowd&&this.crowd.destroy(),this.crowd=void 0},t.prototype.assignAgents=function(){this.agentsList={},this.agents.forEach((t=>{var e;const n=null===(e=null==t?void 0:t.script)||void 0===e?void 0:e.orestisAgent;if(!n||!n.enabled)return!0;const a=this.crowd.addAgent(t,{radius:n.radius,height:n.height,maxAcceleration:n.maxAcceleration,maxSpeed:n.maxSpeed,collisionQueryRange:n.collisionQueryRange,pathOptimizationRange:n.pathOptimizationRange,separationWeight:n.separationWeight,stopDistance:n.stopDistance,orientAgent:n.orientAgent,orientInertia:n.orientInertia});n.onAddAgent(a,this.crowd),this.agentsList[t._guid]=a}))},t.prototype.moveCrowdTo=function(t,e,n){if(!this.crowd)return;let a,d;t?(d=[],t.forEach((t=>{d.push(this.agentsList[t._guid])}))):d=this.crowd.getAgents(),d.forEach((t=>{a=this.pathfinder.getClosestPoint(e),!0===this.isPointCloseToSelected(a,e)&&this.crowd.agentGoto(t,a)})),this.activeAgents=d,this.debugDestination=n?a.clone():void 0},t.prototype.stopCrowd=function(t){if(!this.crowd)return;let e;t?(e=[],t.forEach((t=>{e.push(this.agentsList[t._guid])}))):e=this.crowd.getAgents(),e.forEach((t=>{this.crowd.agentStop(t)})),this.activeAgents=void 0,this.debugDestination=void 0},t.prototype.isPointCloseToSelected=function(t,e){let n=!0;const a=this.pathfinder.parameters.queryExtent;return Math.abs(t.x-e.x)>a.x&&(n=!1),n&&Math.abs(t.y-e.y)>a.y&&(n=!1),n&&Math.abs(t.z-e.z)>a.z&&(n=!1),n},t.prototype.teleportAgentsTo=function(t,e){if(!this.crowd)return;let n,a;t?(a=[],t.forEach((t=>{a.push(this.agentsList[t._guid])}))):a=this.crowd.getAgents(),a.forEach((t=>{n=this.pathfinder.getClosestPoint(e),!0===this.isPointCloseToSelected(n,e)&&(this.crowd.agentTeleport(t,n),!1===this.crowd.isAgentActive(t)&&this.crowd.getAgentEntity(t).setPosition(n))})),this.activeAgents=void 0,this.debugDestination=void 0},t.prototype.calculateDebugLines=function(){const t=this.pathfinder,e=this.activeAgents;this.debugPath=[],this.debugColors=[],e.forEach((e=>{const n=this.crowd.getAgentEntity(e);if(!n)return!0;const a=t.computePath(t.getClosestPoint(n.getPosition()),this.debugDestination);a.forEach(((t,e)=>{if(0===e)return!0;const n=a[e-1];this.debugPath.push(n),this.debugPath.push(t),this.debugColors.push(this.debugLineColor),this.debugColors.push(this.debugLineColor)}))}))},t.prototype.update=function(){this.debugDestination&&(this.calculateDebugLines(),this.app.renderLines(this.debugPath,this.debugColors))}}attachAttributes(t){t.attributes.add("pathfinderEntity",{type:"entity",title:"Pathfinder",description:"Drag and drop the pathfinder entity this crowd should interact with. Updating this requires regenerating the navmesh or reloading your app"}),t.attributes.add("agents",{type:"entity",array:!0,title:"Agents",description:"Assigns agents to this crowd."}),t.attributes.add("maxAgents",{type:"number",default:1,min:1,title:"Max Agents",description:"The maximum number of agents allowed on this crowd."}),t.attributes.add("maxAgentRadius",{type:"number",default:.1,min:0,title:"Max Agent Radius",description:"The maximum radius an agent can have."})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OrestisCrowd=void 0,e.OrestisCrowd=class{constructor(t,e,n,a){this.vec=new pc.Vec3,this.vec2=new pc.Vec3,this.vec3=new pc.Vec3,this.recastCrowd={},this.entities=new Array,this.agents=new Array,this.agentsActive=new Array,this.agentsTargetPoint=new Array,this.script=t,this.app=t.app,this.pathfinder=e,this.recastCrowd=new this.pathfinder.RECAST.Crowd(n,a,this.pathfinder.navMesh.getNavMesh()),this.agentScriptParameters=[],this.agentCurrentAngleY=[],this.updateRef=this.update.bind(this),this.app.on("update",this.updateRef)}destroy(){this.recastCrowd&&this.recastCrowd.destroy()}addAgent(t,e){var n=new this.pathfinder.RECAST.dtCrowdAgentParams;n.radius=e.radius,n.height=e.height,n.maxAcceleration=e.maxAcceleration,n.maxSpeed=e.maxSpeed,n.collisionQueryRange=e.collisionQueryRange,n.pathOptimizationRange=e.pathOptimizationRange,n.separationWeight=e.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;const a=this.vec3;this.pathfinder.getRandomPointAround(t.getPosition(),.25,a);var d=this.recastCrowd.addAgent(new this.pathfinder.RECAST.Vec3(a.x,a.y,a.z),n);return this.entities.push(t),this.agents.push(d),this.agentScriptParameters[d]=e,this.agentCurrentAngleY[d]=t.getEulerAngles().y,d}getAgentPosition(t,e){const n=this.recastCrowd.getAgentPosition(t),a=-.75*this.pathfinder.parameters.cellHeight;return e?e.set(n.x,n.y+a,n.z):new pc.Vec3(n.x,n.y+a,n.z)}getAgentVelocity(t,e){var n=this.recastCrowd.getAgentVelocity(t);return e?e.set(n.x,n.y,n.z):new pc.Vec3(n.x,n.y,n.z)}getAgentNextTargetPath(t,e){var n=this.recastCrowd.getAgentNextTargetPath(t);return e?e.set(n.x,n.y,n.z):new pc.Vec3(n.x,n.y,n.z)}getAgentState(t){return this.recastCrowd.getAgentState(t)}getAgentEntity(t){return this.entities[t]}getAgentIndex(t){return this.entities.findIndex((e=>e._guid===t._guid))}overOffmeshConnection(t){return this.recastCrowd.overOffmeshConnection(t)}agentGoto(t,e){this.recastCrowd.agentGoto(t,new this.pathfinder.RECAST.Vec3(e.x,e.y,e.z)),this.agentsTargetPoint[t]||(this.agentsTargetPoint[t]=new pc.Vec3),this.agentsTargetPoint[t].copy(e),-1===this.agentsActive.indexOf(t)&&this.agentsActive.push(t)}agentStop(t){const e=this.getAgentEntity(t).getPosition();this.agentTeleport(t,e);const n=this.agentsActive.indexOf(t);n>-1&&this.agentsActive.splice(n,1)}isAgentActive(t){return this.agentsActive.indexOf(t)>-1}agentTeleport(t,e){this.recastCrowd.agentTeleport(t,new this.pathfinder.RECAST.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){var n=this.recastCrowd.getAgentParameters(t);void 0!==e.radius&&(n.radius=e.radius),void 0!==e.height&&(n.height=e.height),void 0!==e.maxAcceleration&&(n.maxAcceleration=e.maxAcceleration),void 0!==e.maxSpeed&&(n.maxSpeed=e.maxSpeed),void 0!==e.collisionQueryRange&&(n.collisionQueryRange=e.collisionQueryRange),void 0!==e.pathOptimizationRange&&(n.pathOptimizationRange=e.pathOptimizationRange),void 0!==e.separationWeight&&(n.separationWeight=e.separationWeight),this.agentScriptParameters[t]=e,this.recastCrowd.setAgentParameters(t,n)}removeAgent(t){this.recastCrowd.removeAgent(t);var e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.entities.splice(e,1))}getAgents(){return this.agents}update(t){this.pathfinder.navMesh.update();var e=this.pathfinder.getTimeStep(),n=this.pathfinder.getMaximumSubStepCount();if(e<=.001)this.recastCrowd.update(t);else{var a=Math.floor(t/e);n&&a>n&&(a=n),a<1&&(a=1);var d=t/a;for(let t=0;t<a;t++)this.recastCrowd.update(d)}for(let e=0;e<this.agents.length;e++){if(-1===this.agentsActive.indexOf(e))continue;const n=this.agentScriptParameters[e],a=this.entities[e],d=this.getAgentPosition(this.agents[e],this.vec3);if(n.stopDistance>0&&this.agentsTargetPoint[e].distance(d)<=n.stopDistance)this.agentStop(e);else if(a.setPosition(d),n.orientAgent){const c=this.getAgentVelocity(e,this.vec2);if(c.length()>.2){const l=this.vec.copy(d).add(c.scale(3)),u=this.vec3.set(l.x,d.y,l.z);a.lookAt(u.x,u.y,u.z);const p=a.getEulerAngles(),g=p.y;this.agentCurrentAngleY[e]=pc.math.lerp(this.agentCurrentAngleY[e],g,n.orientInertia*t),a.setEulerAngles(p.x,this.agentCurrentAngleY[e],p.z)}}}}setDefaultQueryExtent(t){let e=new this.pathfinder.RECAST.Vec3(t.x,t.y,t.z);this.recastCrowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(t){let e=this.recastCrowd.getDefaultQueryExtent();return t?t.set(e.x,e.y,e.z):new pc.Vec3(e.x,e.y,e.z)}getCorners(t){let e;const n=this.recastCrowd.getPath(t),a=n.getPointCount();var d=[];for(e=0;e<a;e++){let t=n.getPoint(e);d.push(new pc.Vec3(t.x,t.y,t.z))}return d}dispose(){this.recastCrowd.destroy(),this.app.off("update",this.updateRef),this.updateRef=void 0}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=n(6);e.default=class{constructor(){this.createPcScript()}createPcScript(){const t=pc.createScript("orestisPathfinding");this.attachAttributes(t),t.prototype.postInitialize=function(){let t;this.pathfinder=new a.OrestisPathfinder(this),pc.events.attach(this.entity),this.on("attr",(()=>{window.clearTimeout(t),t=window.setTimeout((()=>{this.pathfinder.onAttrUpdate()}),300)})),this.entity.on("OrestisPathfinding:findPath",this.findPath,this),this.onEventStart?this.app.once(this.onEventStart,(function(){this.pathfinder.createNavMesh()}),this):this.pathfinder.createNavMesh()},t.prototype.findPath=function(t,e,n){n(this.pathfinder.computePath(t,e))}}attachAttributes(t){t.attributes.add("cellSize",{type:"number",default:.25,min:0,title:"Cell Size",description:"XZ plane cell size, used to calculate the grid size based on the bounding box of the selected scene. [Limit: >= 0]"}),t.attributes.add("cellHeight",{type:"number",default:.25,min:0,title:"Cell Height",description:"Y-axis cell size, used to calculate the grid size based on the bounding box of the selected scene. [Limit: >= 0]"}),t.attributes.add("walkableHeight",{type:"number",default:1,min:0,title:"Walkable Height",description:"Minimum floor to ceiling height that will still allow the floor area to be considered walkable. [Limit: >=0]"}),t.attributes.add("walkableRadius",{type:"number",default:1,min:0,title:"Walkable Radius",description:"The distance to erode/shrink the walkable area of the heightfield away from obstructions. [Limit: >=0]"}),t.attributes.add("walkableClimb",{type:"number",default:1,min:0,title:"Walkable Climb",description:"Maximum ledge height that is considered to still be traversable. [Limit: >=0]"}),t.attributes.add("walkableSlopeAngle",{type:"number",default:35,min:0,max:90,title:"Walkable Slope Angle",description:"The maximum slope that is considered walkable. [Limits: 0 <= value < 90]"}),t.attributes.add("regionMinSize",{type:"number",default:8,min:0,title:"Region Min Size",description:"The minimum number of cells allowed to form isolated island areas. [Limit: >=0]"}),t.attributes.add("regionMergeSize",{type:"number",default:20,min:0,title:"Region Merge Size",description:"Any regions with a span count smaller than this value will, if possible, be merged with larger regions. [Limit: >=0]"}),t.attributes.add("edgeMaxLen",{type:"number",default:12,min:0,title:"Edge Max Length",description:"The maximum allowed length for contour edges along the border of the mesh. [Limit: >=0]"}),t.attributes.add("edgeMaxError",{type:"number",default:1.3,min:0,title:"Edge Max Error",description:"The maximum distance a simplfied contour's border edges should deviate the original raw contour. [Limit: >=0]"}),t.attributes.add("vertsPerPoly",{type:"number",default:6,min:3,title:"Max Verts Per Poly",description:"The maximum number of vertices allowed for polygons generated during the contour to polygon conversion process. [Limit: >= 3]"}),t.attributes.add("detailSampleDist",{type:"number",default:6,min:.9,title:"Detail Sample Dist",description:"Sets the sampling distance to use when generating the detail mesh, for height detail only. [Limits: >= 0.9]"}),t.attributes.add("detailSampleMaxError",{type:"number",default:1,min:0,title:"Detail Sample Max Error",description:"The maximum distance the detail mesh surface should deviate from heightfield data, for height detail only. [Limit: >=0]"}),t.attributes.add("tileSize",{type:"number",default:0,min:0,title:"Tile Size",description:"The width/height size of tile's on the xz-plane. If you plan to use obstacles the tileSize should be > 0. [Limit: >= 0]"}),t.attributes.add("borderSize",{type:"number",default:0,min:0,title:"Border Size",description:"The size of the non-navigable border around the heightfield. [Limit: >= 0]"}),t.attributes.add("debugNavMesh",{type:"boolean",default:!1,title:"Debug Nav Mesh",description:"If enabled the generated nav mesh will be rendered."}),t.attributes.add("queryExtent",{type:"vec3",default:[1,1,1],title:"Query Extent",description:"Set the Bounding box extent for doing spatial queries (getClosestPoint, getRandomPointAround etc.)."}),t.attributes.add("excludeTags",{type:"string",default:"navmesh-exclude",title:"Exclude Tags",description:"A comma separated list of entity tags to exclude from the navmesh."}),t.attributes.add("onEventStart",{type:"string",title:"On Event Start",description:"Run the navmesh generator when this app wide event fires, if empty the navmesh will be generated on initialize."}),t.attributes.add("onEventReady",{type:"string",title:"On Event Ready",description:"Fire a custom event when the navmesh generation finished."})}}},function(t,e,n){"use strict";var a=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))((function(d,c){function r(t){try{h(a.next(t))}catch(t){c(t)}}function o(t){try{h(a.throw(t))}catch(t){c(t)}}function h(t){var e;t.done?d(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,o)}h((a=a.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.OrestisPathfinder=void 0;const d=n(7);e.OrestisPathfinder=class{constructor(t,e=Recast){this.RECAST={},this._maximumSubStepCount=10,this._timeStep=1/60,this.parameters=t,this.app=t.app,this.parentEntity=t.entity,"function"==typeof e?e(this.RECAST):this.RECAST=e,this.isSupported()?this.setTimeStep():console.log("Orestis 3D Pathfinding, RecastJS is not available. Please make sure you included the js file.")}onAttrUpdate(){return a(this,void 0,void 0,(function*(){this.debugEntity&&(this.debugEntity.model.meshInstances[0].material.destroy(),this.debugEntity.model.meshInstances[0].mesh.destroy(),this.debugEntity.destroy(),this.debugEntity=void 0),this.createNavMesh()}))}setTimeStep(t=1/60){this._timeStep=t}getTimeStep(){return this._timeStep}setMaximumSubStepCount(t=10){this._maximumSubStepCount=t}getMaximumSubStepCount(){return this._maximumSubStepCount}createNavMesh(){this.navMesh&&(this.getCrowdEntities().forEach((t=>{t.script.orestisCrowd.destroyCrowd()})),this.navMesh.destroy());const t=new this.RECAST.rcConfig,e=this.parameters;t.borderSize=e.borderSize?e.borderSize:0,t.tileSize=e.tileSize?e.tileSize:0,t.cs=e.cellSize,t.ch=e.cellHeight,t.walkableSlopeAngle=e.walkableSlopeAngle?e.walkableSlopeAngle:35,t.walkableHeight=e.walkableHeight,t.walkableClimb=e.walkableClimb,t.walkableRadius=e.walkableRadius,t.maxEdgeLen=e.edgeMaxLen,t.maxSimplificationError=e.edgeMaxError,t.minRegionArea=e.regionMinSize,t.mergeRegionArea=e.regionMergeSize,t.maxVertsPerPoly=e.vertsPerPoly,t.detailSampleDist=e.detailSampleDist,t.detailSampleMaxError=e.detailSampleMaxError;const n=new d.OrestisGeometry(this.parentEntity,e.excludeTags).getGeometry();this.navMesh=new this.RECAST.NavMesh;const a=performance.now();this.navMesh.build(n.positions,n.offset,n.indices,n.indices.length,t);const c=performance.now();console.log(`Orestis 3D Pathfinding, nav mesh generation for ${this.parentEntity.name} entity ${c-a} milliseconds.`),e.debugNavMesh&&this.createDebugNavMesh(),this.bootCrowds(),this.setDefaultQueryExtent(this.parameters.queryExtent)}getCrowdEntities(){const t=this.parentEntity._guid;return this.app.root.find((e=>e.script&&e.script.orestisCrowd&&e.script.orestisCrowd.pathfinderEntity&&e.script.orestisCrowd.pathfinderEntity._guid===t))}bootCrowds(){const t=this.parentEntity._guid;this.getCrowdEntities().forEach((t=>{t.script.orestisCrowd.initializeCrowd(this)})),this.app.root.find((e=>e.script&&e.script.orestisObstacle&&e.script.orestisObstacle.pathfinderEntity&&e.script.orestisObstacle.pathfinderEntity._guid===t)).forEach((t=>{t.script.orestisObstacle.initializeObstacle(this)}))}createDebugNavMesh(t){var e=t?t.indices:null,n=t?t.positions:null;if(!t){e=[],n=[];var a=this.navMesh.getDebugNavMesh();let t=a.getTriangleCount();var d,c;for(d=0;d<3*t;d++)e.push(d);for(d=0;d<t;d++)for(c=0;c<3;c++){let t=a.getTriangle(d).getPoint(c);n.push(t.x,t.y,t.z)}}const l=new pc.Entity,u=new pc.StandardMaterial;u.emissive.set(.8,.8,.8,1),u.cull=pc.CULLFACE_FRONT,u.update();const p=new pc.GraphNode,g=new pc.Mesh(this.app.graphicsDevice);g.setPositions(n),g.setNormals(pc.calculateNormals(n,e)),g.setIndices(e),g.update();const f=new pc.MeshInstance(p,g,u),m=new pc.Model;m.graph=p,m.meshInstances.push(f),l.addComponent("model",{layers:[this.app.scene.layers.getLayerByName("World").id],castShadows:!1,receiveShadows:!1}),l.model.model=m,this.app.root.addChild(l),this.debugEntity=l}isSupported(){return void 0!==this.RECAST}getClosestPoint(t,e){var n=new this.RECAST.Vec3(t.x,t.y,t.z),a=this.navMesh.getClosestPoint(n);return e?e.set(a.x,a.y,a.z):new pc.Vec3(a.x,a.y,a.z)}getRandomPointAround(t,e,n){var a=new this.RECAST.Vec3(t.x,t.y,t.z),d=this.navMesh.getRandomPointAround(a,e);return n?n.set(d.x,d.y,d.z):new pc.Vec3(d.x,d.y,d.z)}moveAlong(t,e,n){var a=new this.RECAST.Vec3(t.x,t.y,t.z),d=new this.RECAST.Vec3(e.x,e.y,e.z),c=this.navMesh.moveAlong(a,d);return n?n.set(c.x,c.y,c.z):new pc.Vec3(c.x,c.y,c.z)}computePath(t,e){var n;let a=new this.RECAST.Vec3(t.x,t.y,t.z),d=new this.RECAST.Vec3(e.x,e.y,e.z),c=this.navMesh.computePath(a,d),l=c.getPointCount();var u=[];for(n=0;n<l;n++){let t=c.getPoint(n);u.push(new pc.Vec3(t.x,t.y,t.z))}return u}setDefaultQueryExtent(t){let e=new this.RECAST.Vec3(t.x,t.y,t.z);this.navMesh.setDefaultQueryExtent(e)}getDefaultQueryExtent(t){let e=this.navMesh.getDefaultQueryExtent();return t?t.set(e.x,e.y,e.z):new pc.Vec3(e.x,e.y,e.z)}buildFromNavmeshData(t){var e=t.length*t.BYTES_PER_ELEMENT,n=this.RECAST._malloc(e),a=new Uint8Array(this.RECAST.HEAPU8.buffer,n,e);a.set(t);let d=new this.RECAST.NavmeshData;d.dataPointer=a.byteOffset,d.size=t.length,this.navMesh=new this.RECAST.NavMesh,this.navMesh.buildFromNavmeshData(d),this.RECAST._free(a.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData();var e=new Uint8Array(this.RECAST.HEAPU8.buffer,t.dataPointer,t.size),n=new Uint8Array(t.size);return n.set(e),this.navMesh.freeNavmeshData(t),n}addCylinderObstacle(t,e,n){return this.navMesh.addCylinderObstacle(new this.RECAST.Vec3(t.x,t.y,t.z),e,n)}addBoxObstacle(t,e,n){return this.navMesh.addBoxObstacle(new this.RECAST.Vec3(t.x,t.y,t.z),new this.RECAST.Vec3(e.x,e.y,e.z),n)}removeObstacle(t){this.navMesh.removeObstacle(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OrestisGeometry=void 0,e.OrestisGeometry=class{constructor(t,e){this.excludeTags=e,this.setParentEntity(t)}setParentEntity(t){t&&(this.parentEntity=t)}getMeshInstances(t){const e=[],n=this.excludeTags.split(","),s=t=>{const e=t.tags.list();let a=!1;return e.forEach((t=>{if(!a&&n.indexOf(t)>-1)return a=!0,!1})),a};return t.find((function(t){t.model&&t.model.meshInstances&&!1===s(t)&&t.model.meshInstances.forEach((function(t){e.push(t)}))})),t.model&&t.model.meshInstances&&!1===s(t)&&t.model.meshInstances.forEach((function(t){e.push(t)})),e}getMeshGeometry(t){const e=t.node.getWorldTransform(),n=t.mesh.vertexBuffer,a=new pc.VertexIterator(n),d=[],c=new pc.Vec3;for(let t=0;t<n.getNumVertices();t++){const t=a.element[pc.SEMANTIC_POSITION],n=t.array[t.index],l=t.array[t.index+1],u=t.array[t.index+2];c.set(n,l,u),e.transformPoint(c,c),d.push(c.x,c.y,c.z),a.next()}a.end();const l=t.mesh.indexBuffer[pc.RENDERSTYLE_SOLID],u=new Uint16Array(l.lock()),p=[],g=t.mesh.primitive[0].base,f=t.mesh.primitive[0].count;for(let t=0;t<f;t++)p.push(u[t+g]);return{vertices:d,indices:p,numIndices:f,numVertices:d.length/3}}getGeometry(){if(!this.parentEntity)return;const t=this.getMeshInstances(this.parentEntity);if(0===t.length)return;const e=[],n=[];let a=0,d=0;for(let c=0;c<t.length;c++){const l=t[c],u=this.getMeshGeometry(l);let p=0;for(let t=0;t<u.vertices.length;t+=3)n.push(u.vertices[t],u.vertices[t+1],u.vertices[t+2]),p++;for(let t=0;t<u.indices.length;t+=3)e.push(u.indices[t+2]+d,u.indices[t+1]+d,u.indices[t]+d);a+=u.vertices.length/3,d+=p}return{positions:n,indices:e,offset:a}}}}]);