var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.attributes.add("lerpSpeed",{title:"Lerp Speed",description:"Speed to adjust how fast the cropping to detected face is adjusted.",type:"number",default:2}),VideoTexture.prototype.initialize=function(){var e=this.app,t=this;t.cropArea=[[0,0],[0,0]],t.cropTarget=[[0,0],[0,0]],t.lerpedCrop=[[0,0],[0,0]],t.faceReady=!1,t.videoPlaying=!1,t.lerpVal=0,t.workerScript=this.app.assets.find("tfjs-faceDetection-worker.js"),t.worker=new Worker(t.workerScript.getFileUrl()),t.video=document.createElement("video"),t.canvas=document.createElement("canvas"),t.canvasSrc=document.createElement("canvas"),t.video.loop=!0,t.video.muted=!0,t.video.playsInline=!0;var i=t.video.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t.video),t.canvas.style.width="200px",t.canvas.style.height="200px",t.canvas.style.position="absolute",t.canvas.width=256,t.canvas.height=256,t.ctx=t.canvas.getContext("2d"),document.body.appendChild(t.canvas),t.canvasSrc.style.visibility="hidden",t.canvasSrc.style.width="1px",t.canvasSrc.style.height="1px",t.ctxSrc=t.canvasSrc.getContext("2d"),document.body.appendChild(t.canvasSrc),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t.canvas);navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(i){t.video.srcObject=i,t.video.onloadedmetadata=function(e){t.canvasSrc.width=this.videoWidth,t.canvasSrc.height=this.videoHeight},t.video.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.video.play()}.bind(this))}.bind(this)).catch((function(e){console.log(e.name+": "+e.message)})),t.video.addEventListener("play",(function(){t.videoPlaying=!0,t.worker.addEventListener("message",(e=>{t.faceReady=!0,e.data&&(t.lerpVal=0,t.cropArea=t.lerpedCrop,t.cropTarget=e.data),t.processFrame()})),t.processFrame()}),!1)},VideoTexture.prototype.processFrame=function(){if(this.videoPlaying){this.ctxSrc.drawImage(this.video,0,0,this.canvasSrc.width,this.canvasSrc.height);var e=this.ctxSrc.getImageData(0,0,this.canvasSrc.width,this.canvasSrc.height).data;this.worker.postMessage({data:e,width:this.canvasSrc.width,height:this.canvasSrc.height})}},VideoTexture.prototype.update=function(e){this.faceReady&&(this.updateVideoCanvas(e),this.videoTexture.upload())},VideoTexture.prototype.updateVideoCanvas=function(e){var t=Math.max(Math.abs(this.lerpedCrop[0][0]-this.cropTarget[0][0]),Math.abs(this.lerpedCrop[1][1]-this.cropTarget[1][1]),Math.abs(this.lerpedCrop[0][1]-this.cropTarget[0][1]),Math.abs(this.lerpedCrop[1][0]-this.cropTarget[1][0]));this.lerpVal+=e*this.lerpSpeed*t,this.lerpedCrop[0][0]=pc.math.lerp(this.cropArea[0][0],this.cropTarget[0][0],this.lerpVal),this.lerpedCrop[0][1]=pc.math.lerp(this.cropArea[0][1],this.cropTarget[0][1],this.lerpVal),this.lerpedCrop[1][0]=pc.math.lerp(this.cropArea[1][0],this.cropTarget[1][0],this.lerpVal),this.lerpedCrop[1][1]=pc.math.lerp(this.cropArea[1][1],this.cropTarget[1][1],this.lerpVal);var i=this.lerpedCrop[1][0]-this.lerpedCrop[0][0],a=this.lerpedCrop[1][1]-this.lerpedCrop[0][1];this.ctx.drawImage(this.video,this.lerpedCrop[0][0]*this.video.videoWidth,this.lerpedCrop[0][1]*this.video.videoHeight,i*this.video.videoWidth,a*this.video.videoHeight,0,0,this.canvas.width,this.canvas.height)};var TvScreen=pc.createScript("screenMat");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};var AnimateRotation=pc.createScript("animateRotation");AnimateRotation.attributes.add("offsetCurve",{type:"curve",title:"Offset Curve",curves:["x","y","z"]}),AnimateRotation.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimateRotation.prototype.initialize=function(){this.startRotation=this.entity.getEulerAngles().clone(),this.rotation=new pc.Vec3,this.time=0},AnimateRotation.prototype.update=function(t){this.time+=t,this.time>this.duration&&(this.time-=this.duration);var i=this.time/this.duration,e=this.offsetCurve.value(i);this.rotation.copy(this.startRotation),this.rotation.x+=e[0],this.rotation.y+=e[1],this.rotation.z+=e[2],this.entity.setEulerAngles(this.rotation)};var AnimatePosition=pc.createScript("animatePosition");AnimatePosition.attributes.add("targetPos",{type:"vec3",title:"Target Position"}),AnimatePosition.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimatePosition.prototype.initialize=function(){this.entity.tween(this.entity.getLocalPosition()).to(this.targetPos,this.duration,pc.SineInOut).loop(!0).yoyo(!0).start()},AnimatePosition.prototype.update=function(t){};var SpatialAudioSource=pc.createScript("spatialAudio_Source");SpatialAudioSource.attributes.add("audioFile",{type:"asset",assetType:"audio"}),SpatialAudioSource.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.play,this);let i=this.app.root.children[0].findOne((function(i){return i.script&&i.script.spatialAudio_Listener}));i&&(this.audioListener=i.script.spatialAudio_Listener),this.audioSource=document.createElement("audio"),console.log(this.audioFile.url),this.audioSource.src=this.audioFile.getFileUrl(),this.audioListener&&this.addAudioSource(this.audioSource)},SpatialAudioSource.prototype.update=function(i){if(this.source){var t=this.entity.getPosition(),e=this.entity.up,o=this.entity.forward;this.source.setPosition(t.x,t.y,t.z),this.source.setOrientation(o.x,o.y,o.z,e.x,e.y,e.z)}},SpatialAudioSource.prototype.play=function(){this.audioSource&&this.audioSource.play()},SpatialAudioSource.prototype.addAudioSource=function(i){let t=this.audioListener.audioContext.createMediaElementSource(i);this.source=this.audioListener.resonanceAudioScene.createSource(),t.connect(this.source.input)};var SpatialAudioListener=pc.createScript("spatialAudio_Listener");SpatialAudioListener.attributes.add("roomDimensions",{title:"Room Dimensions",type:"json",schema:[{name:"width",type:"number",default:5},{name:"height",type:"number",default:3},{name:"depth",type:"number",default:5}]}),SpatialAudioListener.attributes.add("roomMaterials",{title:"Room Materials",type:"json",schema:[{name:"left",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"right",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"front",type:"string",default:"brick-painted",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"back",type:"string",default:"brick-bare",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"down",type:"string",default:"parquet-on-concrete",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]},{name:"up",type:"string",default:"wood-ceiling",enum:[{transparent:"transparent"},{"acoustic-ceiling-tiles":"acoustic-ceiling-tiles"},{"brick-bare":"brick-bare"},{"brick-painted":"brick-painted"},{"concrete-block-coarse":"concrete-block-coarse"},{"concrete-block-painted":"concrete-block-painted"},{"curtain-heavy":"curtain-heavy"},{"fiber-glass-insulation":"fiber-glass-insulation"},{"glass-thin":"glass-thin"},{"glass-thick":"glass-thick"},{grass:"grass"},{"linoleum-on-concrete":"linoleum-on-concrete"},{marble:"marble"},{metal:"metal"},{"parquet-on-concrete":"parquet-on-concrete"},{"plaster-smooth":"plaster-smooth"},{"plywood-panel":"plywood-panel"},{"polished-concrete-or-tile":"polished-concrete-or-tile"},{sheetrock:"sheetrock"},{"water-or-ice-surface":"water-or-ice-surface"},{"wood-ceiling":"wood-ceiling"},{"wood-panel":"wood-panel"},{uniform:"uniform"}]}]}),SpatialAudioListener.prototype.initialize=function(){this.audioContext=this.app.systems.sound.context,this.resonanceAudioScene=new ResonanceAudio(this.audioContext),this.resonanceAudioScene.output.connect(this.audioContext.destination),this.setRoom()},SpatialAudioListener.prototype.update=function(e){var t=this.entity.getPosition(),o=this.entity.up,i=this.entity.forward;this.resonanceAudioScene.setListenerPosition(t.x,t.y,t.z),this.resonanceAudioScene.setListenerOrientation(i.x,i.y,i.z,o.x,o.y,o.z)},SpatialAudioListener.prototype.setRoom=function(){let e={width:this.roomDimensions.width,height:this.roomDimensions.height,depth:this.roomDimensions.depth},t={left:this.roomMaterials.left,right:this.roomMaterials.right,front:this.roomMaterials.front,back:this.roomMaterials.back,down:this.roomMaterials.down,up:this.roomMaterials.up};this.resonanceAudioScene.setRoomProperties(e,t)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=0===this.duration?1:this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();var AnimationHandler=pc.createScript("animationHandler");AnimationHandler.attributes.add("workerFileName",{title:"Hand Pose Worker",description:"Hand Pose Worker Script Name",type:"string",default:"tfjs-handPose-worker.js"}),AnimationHandler.attributes.add("useHandPose",{title:"Use Hand Pose",description:"Use Hand Pose Detection",type:"boolean",default:!1}),AnimationHandler.prototype.initialize=function(){this.useHandPose&&this.initTFJS(),this.app.on("player:move",this.onPlayerMove,this),this.on("destroy",(function(){this.app.off("player:move",this.onPlayerMove)})),this.app.on("player:stop",this.onPlayerStop,this),this.on("destroy",(function(){this.app.off("player:stop",this.onPlayerStop)}))},AnimationHandler.prototype.onKeyDown=function(e){e.event.preventDefault()},AnimationHandler.prototype.onKeyUp=function(e){},AnimationHandler.prototype.onPlayerMove=function(){this.entity.anim.setBoolean("Forward",!0)},AnimationHandler.prototype.onPlayerStop=function(){this.entity.anim.setBoolean("Forward",!1)},AnimationHandler.prototype.initTFJS=function(){console.log("Initializing Hand Pose tracking");var e=this;e.state="idle",e.video=document.querySelector("video"),e.videoPlaying=!1,e.canvas=document.createElement("canvas"),e.ctx=e.canvas.getContext("2d"),e.workerScript=this.app.assets.find(e.workerFileName),e.worker=new Worker(e.workerScript.getFileUrl()),e.video.addEventListener("play",(function(){videoPlaying=!0,e.worker.addEventListener("message",(t=>{const a=t.data;e.state,console.log(a),e.processFrame()})),e.processFrame()}),!1)},AnimationHandler.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_UP)?(console.log("Walk forward"),this.entity.anim.setBoolean("Forward",!0)):this.app.keyboard.wasReleased(pc.KEY_UP)&&this.entity.anim.setBoolean("Forward",!1),this.app.keyboard.wasPressed(pc.KEY_DOWN)?(console.log("Walk backward"),this.entity.anim.setBoolean("Backwards",!0)):this.app.keyboard.wasReleased(pc.KEY_DOWN)&&this.entity.anim.setBoolean("Backwards",!1)},AnimationHandler.prototype.processFrame=function(){if(videoPlaying){this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height);var e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data;this.worker.postMessage({data:e,width:this.canvas.width,height:this.canvas.height})}};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("playerSpeed",{type:"number",default:2,title:"Player Speed"}),PlayerController.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PlayerController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,.5,0),this.rayStart=new pc.Vec3,this.rayEnd=new pc.Vec3,this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.app.on("player:target",this.onNewTarget,this),this.on("destroy",(function(){this.app.off("player:target",this.onNewTarget)})),this.angle=0,this.targetAngle=0},PlayerController.newPosition=new pc.Vec3,PlayerController.prototype.update=function(t){},PlayerController.prototype.onNewTarget=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.playerEntity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.playerEntity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.angle=0,this.targetAngle=this.entity.forward.angle(this.direction)):this.direction.set(0,0,0)};var InputHandler=pc.createScript("inputHandler");InputHandler.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),InputHandler.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),InputHandler.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),InputHandler.prototype.initialize=function(){this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(4,.001,4)),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this)},InputHandler.newPosition=new pc.Vec3,InputHandler.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},InputHandler.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())},InputHandler.ray=new pc.Ray,InputHandler.hitPosition=new pc.Vec3,InputHandler.prototype.doRayCast=function(t){var e=this.cameraEntity.getPosition(),n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),a=this.app.systems.rigidbody.raycastFirst(e,n);if(console.log(a),a&&a.entity.tags.has(["Raycast","Movement"])){var i=this.app.root.findByName("Crowd"),o=this.app.root.findByName("Player");i.fire("OrestisPathfinding:moveAgentsTo",[o],a.point,!0)}};var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),CameraFollow.attributes.add("targetEntity",{type:"entity",title:"Target Entity"}),CameraFollow.prototype.initialize=function(){},CameraFollow.prototype.update=function(t){this.cameraEntity.setPosition(this.targetEntity.getPosition())};!function(){for(var t=[],o=[],r=0,a=0,c=0;c<256;c++)o.push(new pc.Vec3),t.push(new pc.Quat);function Q(o){var a=t[255&r++];return!1!==o&&a.copy(o||pc.Quat.IDENTITY),a}function V(t,r,c){var n=o[255&a++];if(void 0!==r&&void 0!==c){var e=n.data;return e[0]=t,e[1]=r,e[2]=c,n}if(void 0!==t){var p=n.data,i=t.data;p[0]=i[0],p[1]=i[1],p[2]=i[2]}return n}function orthogonal(t){var o=Math.abs(t.x),r=Math.abs(t.y),a=Math.abs(t.z),c=o<r?o<a?pc.Vec3.RIGHT:pc.Vec3.FORWARD:r<a?pc.Vec3.UP:pc.Vec3.FORWARD;return V().cross(t,c)}pc.Vec3.temp=V,pc.Quat.temp=Q,pc.Vec3.prototype.angle=function(t,o){return function angleBetween(t,o,r){return r=r||pc.Vec3.UP,Math.atan2(V().cross(t,o).dot(r),t.dot(o))*pc.math.RAD_TO_DEG}(this,t,o)},pc.Quat.prototype.fromToRotation=function(t,o){return function fromToRotation(t,o,r){var a=t.dot(o);if(r=r||Q(),a<=-.999){r.w=0;var c=orthogonal(t).normalize();return r.x=c.x,r.y=c.y,r.z=c.z,r}var n=V(t).add(o).scale(.5);r.w=t.dot(n);var e=V().cross(t,n);return r.x=e.x,r.y=e.y,r.z=e.z,r.normalize()}(t,o,this)},pc.Quat.prototype.twist=function(t){var o=orthogonal(t),r=this.transformVector(o,V()),a=V(r).sub(V(t).scale(r.dot(t))).normalize(),c=Math.acos(o.dot(a))*pc.math.RAD_TO_DEG;return V(this.x,this.y,this.z).dot(t)>0?-c:c};var n=new pc.Mat4;pc.Quat.prototype.lookAt=function(t,o,r){return n.setLookAt(t,o,r||pc.Vec3.UP),this.setFromMat4(n),this};var e=pc.Vec3.prototype.mul;pc.Vec3.prototype.mul=function(t,o,r){return t instanceof pc.Quat?t.transformVector(this,this):e.call(this,t,o,r)}}();var AnimationLooper=pc.createScript("animationLooper");AnimationLooper.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},AnimationLooper.prototype.update=function(i){},AnimationLooper.prototype.onKeyDown=function(i){i.key===pc.KEY_R?this.entity.animation.play("walk.glb",.2):i.key===pc.KEY_E?this.entity.animation.play("idle.glb",.2):i.key===pc.KEY_W&&this.entity.animation.play("Wave.glb",.2)};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://etribe.com/content/BrandLive/images/splashLogo_01.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));!function(Q){var U={};function __webpack_require__(F){if(U[F])return U[F].exports;var B=U[F]={i:F,l:!1,exports:{}};return Q[F].call(B.exports,B,B.exports,__webpack_require__),B.l=!0,B.exports}__webpack_require__.m=Q,__webpack_require__.c=U,__webpack_require__.d=function(Q,U,F){__webpack_require__.o(Q,U)||Object.defineProperty(Q,U,{enumerable:!0,get:F})},__webpack_require__.r=function(Q){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Q,"__esModule",{value:!0})},__webpack_require__.t=function(Q,U){if(1&U&&(Q=__webpack_require__(Q)),8&U)return Q;if(4&U&&"object"==typeof Q&&Q&&Q.__esModule)return Q;var F=Object.create(null);if(__webpack_require__.r(F),Object.defineProperty(F,"default",{enumerable:!0,value:Q}),2&U&&"string"!=typeof Q)for(var B in Q)__webpack_require__.d(F,B,function(U){return Q[U]}.bind(null,B));return F},__webpack_require__.n=function(Q){var U=Q&&Q.__esModule?function getDefault(){return Q.default}:function getModuleExports(){return Q};return __webpack_require__.d(U,"a",U),U},__webpack_require__.o=function(Q,U){return Object.prototype.hasOwnProperty.call(Q,U)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./src/index.ts")}({"./src/core/crowd.ts":
/*!***************************!*\
  !*** ./src/core/crowd.ts ***!
  \***************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.OrestisCrowd = void 0;\r\nclass OrestisCrowd {\r\n    constructor(script, pathfinder, maxAgents, maxAgentRadius) {\r\n        this.vec = new pc.Vec3();\r\n        this.vec2 = new pc.Vec3();\r\n        this.vec3 = new pc.Vec3();\r\n        /**\r\n         * Link to the detour crowd\r\n         */\r\n        this.recastCrowd = {};\r\n        /**\r\n         * One transform per agent\r\n         */\r\n        this.entities = new Array();\r\n        /**\r\n         * All agents created\r\n         */\r\n        this.agents = new Array();\r\n        this.agentsActive = new Array();\r\n        this.agentsTargetPoint = new Array();\r\n        this.script = script;\r\n        this.app = script.app;\r\n        this.pathfinder = pathfinder;\r\n        this.recastCrowd = new this.pathfinder.RECAST.Crowd(maxAgents, maxAgentRadius, this.pathfinder.navMesh.getNavMesh());\r\n        this.agentScriptParameters = [];\r\n        this.agentCurrentAngleY = [];\r\n        this.updateRef = this.update.bind(this);\r\n        this.app.on("update", this.updateRef);\r\n    }\r\n    destroy() {\r\n        if (this.recastCrowd) {\r\n            this.recastCrowd.destroy();\r\n        }\r\n    }\r\n    /**\r\n     * Add a new agent to the crowd with the specified parameter a corresponding transformNode.\r\n     * You can attach anything to that node. The node position is updated in the scene update tick.\r\n     * @param entity hooked to the agent that will be update by the scene\r\n     * @param parameters agent parameters\r\n     * @returns agent index\r\n     */\r\n    addAgent(entity, parameters) {\r\n        var agentParams = new this.pathfinder.RECAST.dtCrowdAgentParams();\r\n        agentParams.radius = parameters.radius;\r\n        agentParams.height = parameters.height;\r\n        agentParams.maxAcceleration = parameters.maxAcceleration;\r\n        agentParams.maxSpeed = parameters.maxSpeed;\r\n        agentParams.collisionQueryRange = parameters.collisionQueryRange;\r\n        agentParams.pathOptimizationRange = parameters.pathOptimizationRange;\r\n        agentParams.separationWeight = parameters.separationWeight;\r\n        agentParams.updateFlags = 7;\r\n        agentParams.obstacleAvoidanceType = 0;\r\n        agentParams.queryFilterType = 0;\r\n        agentParams.userData = 0;\r\n        const randomPoint = this.vec3;\r\n        this.pathfinder.getRandomPointAround(entity.getPosition(), 0.25, randomPoint);\r\n        var agentIndex = this.recastCrowd.addAgent(new this.pathfinder.RECAST.Vec3(randomPoint.x, randomPoint.y, randomPoint.z), agentParams);\r\n        this.entities.push(entity);\r\n        this.agents.push(agentIndex);\r\n        this.agentScriptParameters[agentIndex] = parameters;\r\n        this.agentCurrentAngleY[agentIndex] = entity.getEulerAngles().y;\r\n        return agentIndex;\r\n    }\r\n    /**\r\n     * Returns the agent position in world space\r\n     * @param index agent index returned by addAgent\r\n     * @returns world space position\r\n     */\r\n    getAgentPosition(index, result) {\r\n        const agentPos = this.recastCrowd.getAgentPosition(index);\r\n        const offsetY = -0.75 * this.pathfinder.parameters.cellHeight;\r\n        return result\r\n            ? result.set(agentPos.x, agentPos.y + offsetY, agentPos.z)\r\n            : new pc.Vec3(agentPos.x, agentPos.y + offsetY, agentPos.z);\r\n    }\r\n    /**\r\n     * Returns the agent velocity in world space\r\n     * @param index agent index returned by addAgent\r\n     * @returns world space velocity\r\n     */\r\n    getAgentVelocity(index, result) {\r\n        var agentVel = this.recastCrowd.getAgentVelocity(index);\r\n        return result\r\n            ? result.set(agentVel.x, agentVel.y, agentVel.z)\r\n            : new pc.Vec3(agentVel.x, agentVel.y, agentVel.z);\r\n    }\r\n    /**\r\n     * Returns the agent next target point on the path\r\n     * @param index agent index returned by addAgent\r\n     * @returns world space position\r\n     */\r\n    getAgentNextTargetPath(index, result) {\r\n        var pathTargetPos = this.recastCrowd.getAgentNextTargetPath(index);\r\n        return result\r\n            ? result.set(pathTargetPos.x, pathTargetPos.y, pathTargetPos.z)\r\n            : new pc.Vec3(pathTargetPos.x, pathTargetPos.y, pathTargetPos.z);\r\n    }\r\n    /**\r\n     * Gets the agent state\r\n     * @param index agent index returned by addAgent\r\n     * @returns agent state\r\n     */\r\n    getAgentState(index) {\r\n        return this.recastCrowd.getAgentState(index);\r\n    }\r\n    getAgentEntity(index) {\r\n        return this.entities[index];\r\n    }\r\n    getAgentIndex(entity) {\r\n        // @ts-ignore\r\n        const index = this.entities.findIndex((o) => o._guid === entity._guid);\r\n        return index;\r\n    }\r\n    /**\r\n     * returns true if the agent in over an off mesh link connection\r\n     * @param index agent index returned by addAgent\r\n     * @returns true if over an off mesh link connection\r\n     */\r\n    overOffmeshConnection(index) {\r\n        return this.recastCrowd.overOffmeshConnection(index);\r\n    }\r\n    /**\r\n     * Asks a particular agent to go to a destination. That destination is constrained by the navigation mesh\r\n     * @param index agent index returned by addAgent\r\n     * @param destination targeted world position\r\n     */\r\n    agentGoto(index, destination) {\r\n        this.recastCrowd.agentGoto(index, new this.pathfinder.RECAST.Vec3(destination.x, destination.y, destination.z));\r\n        if (!this.agentsTargetPoint[index]) {\r\n            this.agentsTargetPoint[index] = new pc.Vec3();\r\n        }\r\n        this.agentsTargetPoint[index].copy(destination);\r\n        const activeIndex = this.agentsActive.indexOf(index);\r\n        if (activeIndex === -1) {\r\n            this.agentsActive.push(index);\r\n        }\r\n    }\r\n    agentStop(index) {\r\n        const agentEntity = this.getAgentEntity(index);\r\n        const destination = agentEntity.getPosition();\r\n        this.agentTeleport(index, destination);\r\n        const activeIndex = this.agentsActive.indexOf(index);\r\n        if (activeIndex > -1) {\r\n            this.agentsActive.splice(activeIndex, 1);\r\n        }\r\n    }\r\n    isAgentActive(index) {\r\n        return this.agentsActive.indexOf(index) > -1;\r\n    }\r\n    /**\r\n     * Teleport the agent to a new position\r\n     * @param index agent index returned by addAgent\r\n     * @param destination targeted world position\r\n     */\r\n    agentTeleport(index, destination) {\r\n        this.recastCrowd.agentTeleport(index, new this.pathfinder.RECAST.Vec3(destination.x, destination.y, destination.z));\r\n    }\r\n    /**\r\n     * Update agent parameters\r\n     * @param index agent index returned by addAgent\r\n     * @param parameters agent parameters\r\n     */\r\n    updateAgentParameters(index, parameters) {\r\n        var agentParams = this.recastCrowd.getAgentParameters(index);\r\n        if (parameters.radius !== undefined) {\r\n            agentParams.radius = parameters.radius;\r\n        }\r\n        if (parameters.height !== undefined) {\r\n            agentParams.height = parameters.height;\r\n        }\r\n        if (parameters.maxAcceleration !== undefined) {\r\n            agentParams.maxAcceleration = parameters.maxAcceleration;\r\n        }\r\n        if (parameters.maxSpeed !== undefined) {\r\n            agentParams.maxSpeed = parameters.maxSpeed;\r\n        }\r\n        if (parameters.collisionQueryRange !== undefined) {\r\n            agentParams.collisionQueryRange = parameters.collisionQueryRange;\r\n        }\r\n        if (parameters.pathOptimizationRange !== undefined) {\r\n            agentParams.pathOptimizationRange = parameters.pathOptimizationRange;\r\n        }\r\n        if (parameters.separationWeight !== undefined) {\r\n            agentParams.separationWeight = parameters.separationWeight;\r\n        }\r\n        this.agentScriptParameters[index] = parameters;\r\n        this.recastCrowd.setAgentParameters(index, agentParams);\r\n    }\r\n    /**\r\n     * remove a particular agent previously created\r\n     * @param index agent index returned by addAgent\r\n     */\r\n    removeAgent(index) {\r\n        this.recastCrowd.removeAgent(index);\r\n        var item = this.agents.indexOf(index);\r\n        if (item > -1) {\r\n            this.agents.splice(item, 1);\r\n            this.entities.splice(item, 1);\r\n        }\r\n    }\r\n    /**\r\n     * get the list of all agents attached to this crowd\r\n     * @returns list of agent indices\r\n     */\r\n    getAgents() {\r\n        return this.agents;\r\n    }\r\n    /**\r\n     * Tick update done by the pc.Application. Agent position/velocity/acceleration is updated by this function\r\n     * @param dt in seconds\r\n     */\r\n    update(dt) {\r\n        // update obstacles\r\n        this.pathfinder.navMesh.update();\r\n        // update crowd\r\n        var timeStep = this.pathfinder.getTimeStep();\r\n        var maxStepCount = this.pathfinder.getMaximumSubStepCount();\r\n        if (timeStep <= 0.001) {\r\n            this.recastCrowd.update(dt);\r\n        }\r\n        else {\r\n            var iterationCount = Math.floor(dt / timeStep);\r\n            if (maxStepCount && iterationCount > maxStepCount) {\r\n                iterationCount = maxStepCount;\r\n            }\r\n            if (iterationCount < 1) {\r\n                iterationCount = 1;\r\n            }\r\n            var step = dt / iterationCount;\r\n            for (let i = 0; i < iterationCount; i++) {\r\n                this.recastCrowd.update(step);\r\n            }\r\n        }\r\n        // update transforms\r\n        for (let index = 0; index < this.agents.length; index++) {\r\n            // --- check if we have a non active agent\r\n            if (this.agentsActive.indexOf(index) === -1)\r\n                continue;\r\n            // --- check if we have a request to stop earlier\r\n            const agentParams = this.agentScriptParameters[index];\r\n            const agentEntity = this.entities[index];\r\n            const newPos = this.getAgentPosition(this.agents[index], this.vec3);\r\n            if (agentParams.stopDistance > 0) {\r\n                const distance = this.agentsTargetPoint[index].distance(newPos);\r\n                if (distance <= agentParams.stopDistance) {\r\n                    this.agentStop(index);\r\n                    continue;\r\n                }\r\n            }\r\n            agentEntity.setPosition(newPos);\r\n            // --- orient entity if requested\r\n            if (agentParams.orientAgent) {\r\n                const velocity = this.getAgentVelocity(index, this.vec2);\r\n                if (velocity.length() > 0.2) {\r\n                    const nextPos = this.vec.copy(newPos).add(velocity.scale(3));\r\n                    const lookPos = this.vec3.set(nextPos.x, newPos.y, nextPos.z);\r\n                    agentEntity.lookAt(lookPos.x, lookPos.y, lookPos.z);\r\n                    const angles = agentEntity.getEulerAngles();\r\n                    const targetAngleY = angles.y;\r\n                    this.agentCurrentAngleY[index] = pc.math.lerp(this.agentCurrentAngleY[index], targetAngleY, agentParams.orientInertia * dt);\r\n                    agentEntity.setEulerAngles(angles.x, this.agentCurrentAngleY[index], angles.z);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Set the Bounding box extent for doing spatial queries (getClosestPoint, getRandomPointAround, ...)\r\n     * The queries will try to find a solution within those bounds\r\n     * default is (1,1,1)\r\n     * @param extent x,y,z value that define the extent around the queries point of reference\r\n     */\r\n    setDefaultQueryExtent(extent) {\r\n        let ext = new this.pathfinder.RECAST.Vec3(extent.x, extent.y, extent.z);\r\n        this.recastCrowd.setDefaultQueryExtent(ext);\r\n    }\r\n    /**\r\n     * Get the Bounding box extent specified by setDefaultQueryExtent\r\n     * @returns the box extent values\r\n     */\r\n    getDefaultQueryExtent(result) {\r\n        let p = this.recastCrowd.getDefaultQueryExtent();\r\n        return result ? result.set(p.x, p.y, p.z) : new pc.Vec3(p.x, p.y, p.z);\r\n    }\r\n    /**\r\n     * Get the next corner points composing the path (max 4 points)\r\n     * @param index agent index returned by addAgent\r\n     * @returns array containing world position composing the path\r\n     */\r\n    getCorners(index) {\r\n        let pt;\r\n        const navPath = this.recastCrowd.getPath(index);\r\n        const pointCount = navPath.getPointCount();\r\n        var positions = [];\r\n        for (pt = 0; pt < pointCount; pt++) {\r\n            let p = navPath.getPoint(pt);\r\n            positions.push(new pc.Vec3(p.x, p.y, p.z));\r\n        }\r\n        return positions;\r\n    }\r\n    /**\r\n     * Release all resources\r\n     */\r\n    dispose() {\r\n        this.recastCrowd.destroy();\r\n        this.app.off("update", this.updateRef);\r\n        this.updateRef = undefined;\r\n    }\r\n}\r\nexports.OrestisCrowd = OrestisCrowd;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvd2QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29yZS9jcm93ZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxNQUFhLFlBQVk7SUE2QnZCLFlBQ0UsTUFBVyxFQUNYLFVBQTZCLEVBQzdCLFNBQWlCLEVBQ2pCLGNBQXNCO1FBOUJoQixRQUFHLEdBQVksSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDN0IsU0FBSSxHQUFZLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzlCLFNBQUksR0FBWSxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQU90Qzs7V0FFRztRQUNJLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBQzdCOztXQUVHO1FBQ0ksYUFBUSxHQUFnQixJQUFJLEtBQUssRUFBYSxDQUFDO1FBQ3REOztXQUVHO1FBQ0ksV0FBTSxHQUFhLElBQUksS0FBSyxFQUFVLENBQUM7UUFDdkMsaUJBQVksR0FBYSxJQUFJLEtBQUssRUFBVSxDQUFDO1FBQzdDLHNCQUFpQixHQUFjLElBQUksS0FBSyxFQUFXLENBQUM7UUFVekQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBRXRCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2pELFNBQVMsRUFDVCxjQUFjLEVBQ2QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQ3JDLENBQUM7UUFFRixJQUFJLENBQUMscUJBQXFCLEdBQUcsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxFQUFFLENBQUM7UUFFN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFB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\n\n//# sourceURL=webpack:///./src/core/crowd.ts?')},"./src/core/geometry.ts":
/*!******************************!*\
  !*** ./src/core/geometry.ts ***!
  \******************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.OrestisGeometry = void 0;\r\nclass OrestisGeometry {\r\n    constructor(parentEntity, excludeTags) {\r\n        this.excludeTags = excludeTags;\r\n        this.setParentEntity(parentEntity);\r\n    }\r\n    setParentEntity(parentEntity) {\r\n        if (parentEntity) {\r\n            this.parentEntity = parentEntity;\r\n        }\r\n    }\r\n    getMeshInstances(entity) {\r\n        const meshInstances = [];\r\n        const excludeTags = this.excludeTags.split(",");\r\n        const isExcluded = (node) => {\r\n            const tags = node.tags.list();\r\n            let result = false;\r\n            tags.forEach((tag) => {\r\n                if (!result && excludeTags.indexOf(tag) > -1) {\r\n                    result = true;\r\n                    return false;\r\n                }\r\n            });\r\n            return result;\r\n        };\r\n        entity.find(function (node) {\r\n            if (node.model &&\r\n                node.model.meshInstances &&\r\n                isExcluded(node) === false) {\r\n                node.model.meshInstances.forEach(function (meshInstance) {\r\n                    meshInstances.push(meshInstance);\r\n                });\r\n            }\r\n        });\r\n        if (entity.model &&\r\n            entity.model.meshInstances &&\r\n            isExcluded(entity) === false) {\r\n            entity.model.meshInstances.forEach(function (meshInstance) {\r\n                meshInstances.push(meshInstance);\r\n            });\r\n        }\r\n        return meshInstances;\r\n    }\r\n    getMeshGeometry(meshInstance) {\r\n        // get matrix beforehand, don\'t need to call it for every vertex\r\n        const matrix = meshInstance.node.getWorldTransform();\r\n        const buffer = meshInstance.mesh.vertexBuffer;\r\n        const iterator = new pc.VertexIterator(buffer);\r\n        // --- get vertices\r\n        const vertices = [];\r\n        const pos = new pc.Vec3();\r\n        for (let i = 0; i < buffer.getNumVertices(); i++) {\r\n            // Current vertex\'s position\r\n            const posSem = iterator.element[pc.SEMANTIC_POSITION];\r\n            // Get position\r\n            const posX = posSem.array[posSem.index];\r\n            const posY = posSem.array[posSem.index + 1];\r\n            const posZ = posSem.array[posSem.index + 2];\r\n            // in your loop, multiply the pos\r\n            pos.set(posX, posY, posZ);\r\n            matrix.transformPoint(pos, pos);\r\n            vertices.push(pos.x, pos.y, pos.z);\r\n            // Move to the next vertex\r\n            iterator.next();\r\n        }\r\n        iterator.end();\r\n        // --- get indexes\r\n        const ib = meshInstance.mesh.indexBuffer[pc.RENDERSTYLE_SOLID];\r\n        const indexes = new Uint16Array(ib.lock());\r\n        const indices = [];\r\n        //const format = buffer.getFormat();\r\n        const base = meshInstance.mesh.primitive[0].base;\r\n        const numIndices = meshInstance.mesh.primitive[0].count;\r\n        for (let i = 0; i < numIndices; i++) {\r\n            indices.push(indexes[i + base]);\r\n        }\r\n        return {\r\n            vertices: vertices,\r\n            indices: indices,\r\n            numIndices: numIndices,\r\n            numVertices: vertices.length / 3,\r\n        };\r\n    }\r\n    getGeometry() {\r\n        if (!this.parentEntity) {\r\n            return;\r\n        }\r\n        // --- find all uranus instaces to export\r\n        const meshInstances = this.getMeshInstances(this.parentEntity);\r\n        if (meshInstances.length === 0)\r\n            return;\r\n        const indices = [];\r\n        const positions = [];\r\n        let offset = 0;\r\n        let v = 0;\r\n        for (let instanceIndex = 0; instanceIndex < meshInstances.length; instanceIndex++) {\r\n            const meshInstance = meshInstances[instanceIndex];\r\n            const geometry = this.getMeshGeometry(meshInstance);\r\n            let curV = 0;\r\n            for (let i = 0; i < geometry.vertices.length; i += 3) {\r\n                positions.push(geometry.vertices[i], geometry.vertices[i + 1], geometry.vertices[i + 2]);\r\n                curV++;\r\n            }\r\n            for (let i = 0; i < geometry.indices.length; i += 3) {\r\n                indices.push(geometry.indices[i + 2] + v, geometry.indices[i + 1] + v, geometry.indices[i] + v);\r\n            }\r\n            offset += geometry.vertices.length / 3;\r\n            v += curV;\r\n        }\r\n        return {\r\n            positions: positions,\r\n            indices: indices,\r\n            offset: offset,\r\n        };\r\n    }\r\n}\r\nexports.OrestisGeometry = OrestisGeometry;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VvbWV0cnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29yZS9nZW9tZXRyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFhLGVBQWU7SUFJMUIsWUFBWSxZQUF1QixFQUFFLFdBQW1CO1FBQ3RELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELGVBQWUsQ0FBQyxZQUF1QjtRQUNyQyxJQUFJLFlBQVksRUFBRTtZQUNoQixJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztTQUNsQztJQUNILENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxNQUFNO1FBQ3JCLE1BQU0sYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN6QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVoRCxNQUFNLFVBQVUsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzFCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDOUIsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLE1BQU0sSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO29CQUM1QyxNQUFNLEdBQUcsSUFBSSxDQUFDO29CQUNkLE9BQU8sS0FBSyxDQUFDO2lCQUNkO1lBQ0gsQ0FBQyxDQUFDLENBQUM7WUFFSCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLENBQUM7UUFFRixNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSTtZQUN4QixJQUNFLElBQUksQ0FBQyxLQUFLO2dCQUNWLElBQUksQ0FBQyxL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\n\n//# sourceURL=webpack:///./src/core/geometry.ts?')},"./src/core/pathfinder.ts":
/*!********************************!*\
  !*** ./src/core/pathfinder.ts ***!
  \********************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.OrestisPathfinder = void 0;\r\nconst geometry_1 = __webpack_require__(/*! ./geometry */ "./src/core/geometry.ts");\r\nclass OrestisPathfinder {\r\n    constructor(script, recastInjection = Recast) {\r\n        /**\r\n         * Reference to the Recast library\r\n         */\r\n        this.RECAST = {};\r\n        this._maximumSubStepCount = 10;\r\n        this._timeStep = 1 / 60;\r\n        this.parameters = script;\r\n        this.app = script.app;\r\n        this.parentEntity = script.entity;\r\n        if (typeof recastInjection === "function") {\r\n            recastInjection(this.RECAST);\r\n        }\r\n        else {\r\n            this.RECAST = recastInjection;\r\n        }\r\n        if (!this.isSupported()) {\r\n            console.log("Orestis 3D Pathfinding, RecastJS is not available. Please make sure you included the js file.");\r\n            return;\r\n        }\r\n        this.setTimeStep();\r\n    }\r\n    onAttrUpdate() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // if (this.navMesh) {\r\n            //   this.navMesh.destroy();\r\n            // }\r\n            if (this.debugEntity) {\r\n                this.debugEntity.model.meshInstances[0].material.destroy();\r\n                this.debugEntity.model.meshInstances[0].mesh.destroy();\r\n                this.debugEntity.destroy();\r\n                this.debugEntity = undefined;\r\n            }\r\n            this.createNavMesh();\r\n        });\r\n    }\r\n    /**\r\n     * Set the time step of the navigation tick update.\r\n     * Default is 1/60.\r\n     * A value of 0 will disable fixed time update\r\n     * @param newTimeStep the new timestep to apply to this world.\r\n     */\r\n    setTimeStep(newTimeStep = 1 / 60) {\r\n        this._timeStep = newTimeStep;\r\n    }\r\n    /**\r\n     * Get the time step of the navigation tick update.\r\n     * @returns the current time step\r\n     */\r\n    getTimeStep() {\r\n        return this._timeStep;\r\n    }\r\n    /**\r\n     * If delta time in navigation tick update is greater than the time step\r\n     * a number of sub iterations are done. If more iterations are need to reach deltatime\r\n     * they will be discarded.\r\n     * A value of 0 will set to no maximum and update will use as many substeps as needed\r\n     * @param newStepCount the maximum number of iterations\r\n     */\r\n    setMaximumSubStepCount(newStepCount = 10) {\r\n        this._maximumSubStepCount = newStepCount;\r\n    }\r\n    /**\r\n     * Get the maximum number of iterations per navigation tick update\r\n     * @returns the maximum number of iterations\r\n     */\r\n    getMaximumSubStepCount() {\r\n        return this._maximumSubStepCount;\r\n    }\r\n    /**\r\n     * Creates a navigation mesh\r\n     */\r\n    createNavMesh() {\r\n        if (this.navMesh) {\r\n            const crowdEntities = this.getCrowdEntities();\r\n            crowdEntities.forEach((entity) => {\r\n                entity.script.orestisCrowd.destroyCrowd();\r\n            });\r\n            this.navMesh.destroy();\r\n        }\r\n        const rc = new this.RECAST.rcConfig();\r\n        const parameters = this.parameters;\r\n        rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\r\n        rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\r\n        rc.cs = parameters.cellSize;\r\n        rc.ch = parameters.cellHeight;\r\n        rc.walkableSlopeAngle = parameters.walkableSlopeAngle\r\n            ? parameters.walkableSlopeAngle\r\n            : 35;\r\n        rc.walkableHeight = parameters.walkableHeight;\r\n        rc.walkableClimb = parameters.walkableClimb;\r\n        rc.walkableRadius = parameters.walkableRadius;\r\n        rc.maxEdgeLen = parameters.edgeMaxLen;\r\n        rc.maxSimplificationError = parameters.edgeMaxError;\r\n        rc.minRegionArea = parameters.regionMinSize;\r\n        rc.mergeRegionArea = parameters.regionMergeSize;\r\n        rc.maxVertsPerPoly = parameters.vertsPerPoly;\r\n        rc.detailSampleDist = parameters.detailSampleDist;\r\n        rc.detailSampleMaxError = parameters.detailSampleMaxError;\r\n        const orestisGeometry = new geometry_1.OrestisGeometry(this.parentEntity, parameters.excludeTags);\r\n        const totalGeometry = orestisGeometry.getGeometry();\r\n        this.navMesh = new this.RECAST.NavMesh();\r\n        const t0 = performance.now();\r\n        this.navMesh.build(totalGeometry.positions, totalGeometry.offset, totalGeometry.indices, totalGeometry.indices.length, rc);\r\n        const t1 = performance.now();\r\n        console.log(`Orestis 3D Pathfinding, nav mesh generation for ${this.parentEntity.name} entity ${t1 - t0} milliseconds.`);\r\n        if (parameters.debugNavMesh) {\r\n            this.createDebugNavMesh();\r\n        }\r\n        this.bootCrowds();\r\n        this.setDefaultQueryExtent(this.parameters.queryExtent);\r\n    }\r\n    getCrowdEntities() {\r\n        // @ts-ignore\r\n        const parentGuid = this.parentEntity._guid;\r\n        return this.app.root.find((node) => {\r\n            return (node.script &&\r\n                node.script.orestisCrowd &&\r\n                node.script.orestisCrowd.pathfinderEntity &&\r\n                node.script.orestisCrowd.pathfinderEntity._guid === parentGuid);\r\n        });\r\n    }\r\n    bootCrowds() {\r\n        // @ts-ignore\r\n        const parentGuid = this.parentEntity._guid;\r\n        const crowdEntities = this.getCrowdEntities();\r\n        crowdEntities.forEach((entity) => {\r\n            entity.script.orestisCrowd.initializeCrowd(this);\r\n        });\r\n        const obstacles = this.app.root.find((node) => {\r\n            return (node.script &&\r\n                node.script.orestisObstacle &&\r\n                node.script.orestisObstacle.pathfinderEntity &&\r\n                node.script.orestisObstacle.pathfinderEntity._guid === parentGuid);\r\n        });\r\n        obstacles.forEach((entity) => {\r\n            entity.script.orestisObstacle.initializeObstacle(this);\r\n        });\r\n    }\r\n    /**\r\n     * Create a navigation mesh debug mesh\r\n     * @param scene is where the mesh will be added\r\n     * @returns debug display mesh\r\n     */\r\n    createDebugNavMesh(geometry) {\r\n        var indices = geometry ? geometry.indices : null;\r\n        var positions = geometry ? geometry.positions : null;\r\n        if (!geometry) {\r\n            indices = [];\r\n            positions = [];\r\n            var debugNavMesh = this.navMesh.getDebugNavMesh();\r\n            let triangleCount = debugNavMesh.getTriangleCount();\r\n            var tri;\r\n            var pt;\r\n            for (tri = 0; tri < triangleCount * 3; tri++) {\r\n                indices.push(tri);\r\n            }\r\n            for (tri = 0; tri < triangleCount; tri++) {\r\n                for (pt = 0; pt < 3; pt++) {\r\n                    let point = debugNavMesh.getTriangle(tri).getPoint(pt);\r\n                    positions.push(point.x, point.y, point.z);\r\n                }\r\n            }\r\n        }\r\n        // Create Entity and add it to the scene\r\n        const entity = new pc.Entity();\r\n        const material = new pc.StandardMaterial();\r\n        material.emissive.set(0.8, 0.8, 0.8, 1);\r\n        material.cull = pc.CULLFACE_FRONT;\r\n        material.update();\r\n        // --- create a mesh instance from a mesh and a material\r\n        const node = new pc.GraphNode();\r\n        const mesh = new pc.Mesh(this.app.graphicsDevice);\r\n        mesh.setPositions(positions);\r\n        // @ts-ignore\r\n        mesh.setNormals(pc.calculateNormals(positions, indices));\r\n        mesh.setIndices(indices);\r\n        mesh.update();\r\n        const meshInstance = new pc.MeshInstance(node, mesh, material);\r\n        // --- create a model and assign it to a model component\r\n        const model = new pc.Model();\r\n        model.graph = node;\r\n        model.meshInstances.push(meshInstance);\r\n        entity.addComponent("model", {\r\n            layers: [this.app.scene.layers.getLayerByName("World").id],\r\n            castShadows: false,\r\n            receiveShadows: false,\r\n        });\r\n        entity.model.model = model;\r\n        this.app.root.addChild(entity);\r\n        this.debugEntity = entity;\r\n    }\r\n    isSupported() {\r\n        return this.RECAST !== undefined;\r\n    }\r\n    /**\r\n     * Get a navigation mesh constrained position, closest to the parameter position\r\n     * @param position world position\r\n     * @returns the closest point to position constrained by the navigation mesh\r\n     */\r\n    getClosestPoint(position, result) {\r\n        var p = new this.RECAST.Vec3(position.x, position.y, position.z);\r\n        var ret = this.navMesh.getClosestPoint(p);\r\n        var pr = result\r\n            ? result.set(ret.x, ret.y, ret.z)\r\n            : new pc.Vec3(ret.x, ret.y, ret.z);\r\n        return pr;\r\n    }\r\n    /**\r\n     * Get a navigation mesh constrained position, within a particular radius\r\n     * @param position world position\r\n     * @param maxRadius the maximum distance to the constrained world position\r\n     * @returns the closest point to position constrained by the navigation mesh\r\n     */\r\n    getRandomPointAround(position, maxRadius, result) {\r\n        var p = new this.RECAST.Vec3(position.x, position.y, position.z);\r\n        var ret = this.navMesh.getRandomPointAround(p, maxRadius);\r\n        var pr = result\r\n            ? result.set(ret.x, ret.y, ret.z)\r\n            : new pc.Vec3(ret.x, ret.y, ret.z);\r\n        return pr;\r\n    }\r\n    /**\r\n     * Compute the final position from a segment made of destination-position\r\n     * @param position world position\r\n     * @param destination world position\r\n     * @returns the resulting point along the navmesh\r\n     */\r\n    moveAlong(position, destination, result) {\r\n        var p = new this.RECAST.Vec3(position.x, position.y, position.z);\r\n        var d = new this.RECAST.Vec3(destination.x, destination.y, destination.z);\r\n        var ret = this.navMesh.moveAlong(p, d);\r\n        var pr = result\r\n            ? result.set(ret.x, ret.y, ret.z)\r\n            : new pc.Vec3(ret.x, ret.y, ret.z);\r\n        return pr;\r\n    }\r\n    /**\r\n     * Compute a navigation path from start to end. Returns an empty array if no path can be computed\r\n     * @param start world position\r\n     * @param end world position\r\n     * @returns array containing world position composing the path\r\n     */\r\n    computePath(start, end) {\r\n        var pt;\r\n        let startPos = new this.RECAST.Vec3(start.x, start.y, start.z);\r\n        let endPos = new this.RECAST.Vec3(end.x, end.y, end.z);\r\n        let navPath = this.navMesh.computePath(startPos, endPos);\r\n        let pointCount = navPath.getPointCount();\r\n        var positions = [];\r\n        for (pt = 0; pt < pointCount; pt++) {\r\n            let p = navPath.getPoint(pt);\r\n            positions.push(new pc.Vec3(p.x, p.y, p.z));\r\n        }\r\n        return positions;\r\n    }\r\n    /**\r\n     * Set the Bounding box extent for doing spatial queries (getClosestPoint, getRandomPointAround, ...)\r\n     * The queries will try to find a solution within those bounds\r\n     * default is (1,1,1)\r\n     * @param extent x,y,z value that define the extent around the queries point of reference\r\n     */\r\n    setDefaultQueryExtent(extent) {\r\n        let ext = new this.RECAST.Vec3(extent.x, extent.y, extent.z);\r\n        this.navMesh.setDefaultQueryExtent(ext);\r\n    }\r\n    /**\r\n     * Get the Bounding box extent specified by setDefaultQueryExtent\r\n     * @returns the box extent values\r\n     */\r\n    getDefaultQueryExtent(result) {\r\n        let p = this.navMesh.getDefaultQueryExtent();\r\n        return result ? result.set(p.x, p.y, p.z) : new pc.Vec3(p.x, p.y, p.z);\r\n    }\r\n    /**\r\n     * build the navmesh from a previously saved state using getNavmeshData\r\n     * @param data the Uint8Array returned by getNavmeshData\r\n     */\r\n    buildFromNavmeshData(data) {\r\n        var nDataBytes = data.length * data.BYTES_PER_ELEMENT;\r\n        var dataPtr = this.RECAST._malloc(nDataBytes);\r\n        var dataHeap = new Uint8Array(this.RECAST.HEAPU8.buffer, dataPtr, nDataBytes);\r\n        dataHeap.set(data);\r\n        let buf = new this.RECAST.NavmeshData();\r\n        buf.dataPointer = dataHeap.byteOffset;\r\n        buf.size = data.length;\r\n        this.navMesh = new this.RECAST.NavMesh();\r\n        this.navMesh.buildFromNavmeshData(buf);\r\n        // Free memory\r\n        this.RECAST._free(dataHeap.byteOffset);\r\n    }\r\n    /**\r\n     * returns the navmesh data that can be used later. The navmesh must be built before retrieving the data\r\n     * @returns data the Uint8Array that can be saved and reused\r\n     */\r\n    getNavmeshData() {\r\n        let navmeshData = this.navMesh.getNavmeshData();\r\n        var arrView = new Uint8Array(this.RECAST.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\r\n        var ret = new Uint8Array(navmeshData.size);\r\n        ret.set(arrView);\r\n        this.navMesh.freeNavmeshData(navmeshData);\r\n        return ret;\r\n    }\r\n    /**\r\n     * Creates a cylinder obstacle and add it to the navigation\r\n     * @param position world position\r\n     * @param radius cylinder radius\r\n     * @param height cylinder height\r\n     * @returns the obstacle freshly created\r\n     */\r\n    addCylinderObstacle(position, radius, height) {\r\n        return this.navMesh.addCylinderObstacle(new this.RECAST.Vec3(position.x, position.y, position.z), radius, height);\r\n    }\r\n    /**\r\n     * Creates an oriented box obstacle and add it to the navigation\r\n     * @param position world position\r\n     * @param extent box size\r\n     * @param angle angle in radians of the box orientation on Y axis\r\n     * @returns the obstacle freshly created\r\n     */\r\n    addBoxObstacle(position, extent, angle) {\r\n        const ref = this.navMesh.addBoxObstacle(new this.RECAST.Vec3(position.x, position.y, position.z), new this.RECAST.Vec3(extent.x, extent.y, extent.z), angle);\r\n        return ref;\r\n    }\r\n    /**\r\n     * Removes an obstacle created by addCylinderObstacle or addBoxObstacle\r\n     * @param obstacle obstacle to remove from the navigation\r\n     */\r\n    removeObstacle(obstacle) {\r\n        this.navMesh.removeObstacle(obstacle);\r\n    }\r\n}\r\nexports.OrestisPathfinder = OrestisPathfinder;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aGZpbmRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlL3BhdGhmaW5kZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEseUNBQTZDO0FBSTdDLE1BQWEsaUJBQWlCO0lBbUI1QixZQUFZLE1BQVcsRUFBRSxrQkFBdUIsTUFBTTtRQWJ0RDs7V0FFRztRQUNJLFdBQU0sR0FBUSxFQUFFLENBQUM7UUFPaEIseUJBQW9CLEdBQVcsRUFBRSxDQUFDO1FBQ2xDLGNBQVMsR0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBR2pDLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUN0QixJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFFbEMsSUFBSSxPQUFPLGVBQWUsS0FBSyxVQUFVLEVBQUU7WUFDekMsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM5QjthQUFNO1lBQ0wsSUFBSSxDQUFDLE1BQU0sR0FBRyxlQUFlLENBQUM7U0FDL0I7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQ1QsK0ZBQStGLENBQ2hHLENBQUM7WUFDRixPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVLLFlBQVk7O1lBQ2hCLHNCQUFzQjtZQUN0Qiw0QkFBNEI7WUFDNUIsSUFBSTtZQUVKLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDcEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDM0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDdkQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFFM0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7YUFDOUI7WUFDRCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDdkIsQ0FBQztLQUFBO0lBRUQ7Ozs7O09BS0c7SUFDSCxXQUFXLENBQUMsY0FBc0IsQ0FBQyxHQUFHLEVBQUU7UUFDdEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7SUFDL0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILHNCQUFzQixDQUFDLGVBQXVCLEVBQUU7UUFDOUMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLFlBQVksQ0FBQztJQUMzQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsc0JBQXNCO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILGFBQWE7UUFDWCxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDaEIsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFOUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQVcsRUFBRSxFQUFFO2dCQUNwQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUM1QyxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDeEI7UUFFRCxNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDdEMsTUFBTSxVQUFVLEdBQVEsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUV4QyxFQUFFLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRSxFQUFFLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1RCxFQUFFLENBQUMsRUFBRSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDNUIsRUFBRSxDQUFDLEVBQUUsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDO1FBQzlCLEVBQUUsQ0FBQyxrQkFBa0IsR0FBRyxVQUFVLENBQUMsa0JBQWtCO1lBQ25ELENBQUMsQ0FBQyxVQUFVLENBQUMsa0JBQWtCO1lBQy9CLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDUCxFQUFFLENBQUMsY0FBYyxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUM7UUFDOUMsRUFBRSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQzVDLEVBQUUsQ0FBQyxjQUFjLEdBQUcsVUFBVSxDQUFDLGNBQWMsQ0FBQztRQUM5QyxFQUFFLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUM7UUFDdEMsRUFBRSxDQUFDLHNCQUFzQixHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUM7UUFDcEQsRUFBRSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQzVDLEVBQUUsQ0FBQyxlQUFlLEdBQUcsVUFBVSxDQUFDLGVBQWUsQ0FBQztRQUNoRCxFQUFFLENBQUMsZUFBZSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUM7UUFDN0MsRUFBRSxDQUFDLGdCQUFnQixHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQztRQUNsRCxFQUFFLENBQUMsb0JBQW9CLEdBQUcsVUFBVSxDQUFDLG9CQUFvQixDQUFDO1FBRTFELE1BQU0sZUFBZSxHQUFHLElBQUksMEJBQWUsQ0FDekMsSUFBSSxDQUFDLFlBQVksRUFDakIsVUFBVSxDQUFDLFdBQVcsQ0FDdkIsQ0FBQztRQUNGLE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUVwRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUV6QyxNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQ2hCLGFBQWEsQ0FBQyxTQUFTLEVBQ3ZCLGFBQWEsQ0FBQyxNQUFNLEVBQ3BCLGFBQWEsQ0FBQyxPQUFPLEVBQ3JCLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUM1QixFQUFFLENBQ0gsQ0FBQztRQUNGLE1BQU0sRUFBRSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM3QixPQUFPLENBQUMsR0FBRyxDQUNULG1EQUNFLElBQUksQ0FBQyxZQUFZLENBQUMsSUFDcEIsV0FBVyxFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsQ0FDbkMsQ0FBQztRQUVGLElBQUksVUFBVSxDQUFDLFlBQVksRUFBRTtZQUMzQixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztTQUMzQjtRQUVELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUVsQixJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQsZ0JBQWdCO1FBQ2QsYUFBYTtRQUNiLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDO1FBRTNDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDdEMsT0FBTyxDQUNMLElBQUksQ0FBQyxNQUFNO2dCQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWTtnQkFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsZ0JBQWdCO2dCQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUMvRCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsVUFBVTtRQUNSLGFBQWE7UUFDYixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQztRQUUzQyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUU5QyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDakQsT0FBTyxDQUNMLElBQUksQ0FBQyxNQUFNO2dCQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZTtnQkFDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsZ0JBQWdCO2dCQUM1QyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUNsRSxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGtCQUFrQixDQUFDLFFBQWM7UUFDL0IsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDakQsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFckQsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDYixTQUFTLEdBQUcsRUFBRSxDQUFDO1lBRWYsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNsRCxJQUFJLGFBQWEsR0FBRyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUVwRCxJQUFJLEdBQVcsQ0FBQztZQUNoQixJQUFJLEVBQVUsQ0FBQztZQUVmLEtBQUssR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsYUFBYSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRTtnQkFDNUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNuQjtZQUNELEtBQUssR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsYUFBYSxFQUFFLEdBQUcsRUFBRSxFQUFFO2dCQUN4QyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRTtvQkFDekIsSUFBSSxLQUFLLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQ3ZELFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDM0M7YUFDRjtTQUNGO1FBRUQsd0NBQXdDO1FBQ3hDLE1BQU0sTUFBTSxHQUFHLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQy9CLE1BQU0sUUFBUSxHQUFHLElBQUksRUFBRSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDM0MsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEMsUUFBUSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDO1FBQ2xDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUVsQix3REFBd0Q7UUFDeEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFaEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QixhQUFhO1FBQ2IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFFZCxNQUFNLFlBQVksR0FBRyxJQUFJLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUUvRCx3REFBd0Q7UUFDeEQsTUFBTSxLQUFLLEdBQUcsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDN0IsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbkIsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFdkMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUU7WUFDM0IsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDMUQsV0FBVyxFQUFFLEtBQUs7WUFDbEIsY0FBYyxFQUFFLEtBQUs7U0FDdEIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBRTNCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQztJQUM1QixDQUFDO0lBRU0sV0FBVztRQUNoQixPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDO0lBQ25DLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsZUFBZSxDQUFDLFFBQWlCLEVBQUUsTUFBZ0I7UUFDakQsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksRUFBRSxHQUFHLE1BQU07WUFDYixDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNqQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxvQkFBb0IsQ0FDbEIsUUFBaUIsRUFDakIsU0FBaUIsRUFDakIsTUFBZ0I7UUFFaEIsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQzFELElBQUksRUFBRSxHQUFHLE1BQU07WUFDYixDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNqQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxTQUFTLENBQ1AsUUFBaUIsRUFDakIsV0FBb0IsRUFDcEIsTUFBZ0I7UUFFaEIsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkMsSUFBSSxFQUFFLEdBQUcsTUFBTTtZQUNiLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQyxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFdBQVcsQ0FBQyxLQUFjLEVBQUUsR0FBWTtRQUN0QyxJQUFJLEVBQVUsQ0FBQztRQUNmLElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRCxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3pELElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QyxJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDbkIsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxVQUFVLEVBQUUsRUFBRSxFQUFFLEVBQUU7WUFDbEMsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM3QixTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxxQkFBcUIsQ0FBQyxNQUFlO1FBQ25DLElBQUksR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxJQUFJLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxxQkFBcUIsQ0FBQyxNQUFnQjtRQUNwQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDN0MsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVEOzs7T0FHRztJQUNILG9CQUFvQixDQUFDLElBQWdCO1FBQ25DLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1FBQ3RELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTlDLElBQUksUUFBUSxHQUFHLElBQUksVUFBVSxDQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQ3pCLE9BQU8sRUFDUCxVQUFVLENBQ1gsQ0FBQztRQUNGLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkIsSUFBSSxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3hDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQztRQUN0QyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV2QyxjQUFjO1FBQ2QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxjQUFjO1FBQ1osSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNoRCxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUN6QixXQUFXLENBQUMsV0FBVyxFQUN2QixXQUFXLENBQUMsSUFBSSxDQUNqQixDQUFDO1FBQ0YsSUFBSSxHQUFHLEdBQUcsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNDLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDMUMsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsbUJBQW1CLENBQUMsUUFBaUIsRUFBRSxNQUFjLEVBQUUsTUFBYztRQUNuRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQ3JDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFDeEQsTUFBTSxFQUNOLE1BQU0sQ0FDUCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILGNBQWMsQ0FBQyxRQUFpQixFQUFFLE1BQWUsRUFBRSxLQUFhO1FBQzlELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUNyQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQ3hELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFDbEQsS0FBSyxDQUNOLENBQUM7UUFFRixPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRDs7O09BR0c7SUFDSCxjQUFjLENBQUMsUUFBYTtRQUMxQixJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN4QyxDQUFDO0NBQ0Y7QUF2YkQsOENBdWJDIn0=\n\n//# sourceURL=webpack:///./src/core/pathfinder.ts?')},"./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { "default": mod };\r\n};\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nconst script_agent_1 = __importDefault(__webpack_require__(/*! ./scripts/script-agent */ "./src/scripts/script-agent.ts"));\r\nconst script_obstacle_1 = __importDefault(__webpack_require__(/*! ./scripts/script-obstacle */ "./src/scripts/script-obstacle.ts"));\r\nconst script_crowd_1 = __importDefault(__webpack_require__(/*! ./scripts/script-crowd */ "./src/scripts/script-crowd.ts"));\r\nconst script_1 = __importDefault(__webpack_require__(/*! ./scripts/script */ "./src/scripts/script.ts"));\r\nnew script_agent_1.default();\r\nnew script_obstacle_1.default();\r\nnew script_crowd_1.default();\r\nnew script_1.default();\r\nconsole.log("Orestis 3D Pathfinding v2.0.5");\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwwRUFBaUQ7QUFDakQsZ0ZBQXVEO0FBQ3ZELDBFQUFpRDtBQUNqRCw4REFBc0M7QUFFdEMsSUFBSSxzQkFBVyxFQUFFLENBQUM7QUFDbEIsSUFBSSx5QkFBYyxFQUFFLENBQUM7QUFDckIsSUFBSSxzQkFBVyxFQUFFLENBQUM7QUFDbEIsSUFBSSxnQkFBTSxFQUFFLENBQUM7QUFFYixPQUFPLENBQUMsR0FBRyxDQUFDLCtCQUErQixDQUFDLENBQUMifQ==\n\n//# sourceURL=webpack:///./src/index.ts?')},"./src/scripts/script-agent.ts":
/*!*************************************!*\
  !*** ./src/scripts/script-agent.ts ***!
  \*************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nclass ScriptAgent {\r\n    constructor() {\r\n        // --- execute\r\n        this.createPcScript();\r\n    }\r\n    createPcScript() {\r\n        const script = pc.createScript("orestisAgent");\r\n        // --- attach attributes\r\n        this.attachAttributes(script);\r\n        // --- attach PC event handlers\r\n        script.prototype.initialize = function () {\r\n            this.agentId = undefined;\r\n            this.crowd = undefined;\r\n            let timeout;\r\n            // @ts-ignore\r\n            pc.events.attach(this.entity);\r\n            this.on("attr", () => {\r\n                window.clearTimeout(timeout);\r\n                timeout = window.setTimeout(this.updateAgentAttributes.bind(this), 300);\r\n            });\r\n            this.entity.on("OrestisPathfinding:updateAgentAttributes", this.updateAgentAttributes, this);\r\n        };\r\n        script.prototype.onAddAgent = function (agentId, crowd) {\r\n            this.agentId = agentId;\r\n            this.crowd = crowd;\r\n        };\r\n        script.prototype.updateAgentAttributes = function () {\r\n            const crowd = this.crowd;\r\n            const orionAgent = this;\r\n            crowd.updateAgentParameters(this.agentId, {\r\n                radius: orionAgent.radius,\r\n                height: orionAgent.height,\r\n                maxAcceleration: orionAgent.maxAcceleration,\r\n                maxSpeed: orionAgent.maxSpeed,\r\n                collisionQueryRange: orionAgent.collisionQueryRange,\r\n                pathOptimizationRange: orionAgent.pathOptimizationRange,\r\n                separationWeight: orionAgent.separationWeight,\r\n                stopDistance: orionAgent.stopDistance,\r\n                orientAgent: orionAgent.orientAgent,\r\n                orientInertia: orionAgent.orientInertia,\r\n            });\r\n        };\r\n    }\r\n    attachAttributes(script) {\r\n        script.attributes.add("radius", {\r\n            type: "number",\r\n            default: 0.5,\r\n            min: 0,\r\n            title: "Radius",\r\n            description: "Agent radius. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("height", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Height",\r\n            description: "Agent height. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("maxAcceleration", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Max Acceleration",\r\n            description: "Maximum allowed acceleration. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("maxSpeed", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Max Speed",\r\n            description: "Maximum allowed speed. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("collisionQueryRange", {\r\n            type: "number",\r\n            default: 0.5,\r\n            min: 0,\r\n            title: "Collision Query Range",\r\n            description: "Defines how close a collision element must be before it is considered for steering behaviors. [Limits: > 0]",\r\n        });\r\n        script.attributes.add("pathOptimizationRange", {\r\n            type: "number",\r\n            default: 0.0,\r\n            min: 0,\r\n            title: "Path Optimization Range",\r\n            description: "The path visibility optimization range. [Limit: > 0]",\r\n        });\r\n        script.attributes.add("separationWeight", {\r\n            type: "number",\r\n            default: 1.0,\r\n            min: 0,\r\n            title: "Separation Weight",\r\n            description: "How aggressive the agent manager should be at avoiding collisions with this agent. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("stopDistance", {\r\n            type: "number",\r\n            default: 0.0,\r\n            title: "Stop Distance",\r\n            description: "The distance from the path end point this agent should stop at. If 0.0 is provided the agent will reach as close as possible to the end point.",\r\n        });\r\n        script.attributes.add("orientInertia", {\r\n            type: "number",\r\n            default: 0.1,\r\n            title: "Orient Inertia",\r\n            description: "How smoothly the agent entity will rotate to orient itself.",\r\n        });\r\n        script.attributes.add("orientAgent", {\r\n            type: "boolean",\r\n            default: true,\r\n            title: "Orient Agent",\r\n            description: "If selected the agent entity will automatically orient itself on the Y axis to look at the next point on the path.",\r\n        });\r\n    }\r\n}\r\nexports.default = ScriptAgent;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LWFnZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjcmlwdHMvc2NyaXB0LWFnZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsTUFBcUIsV0FBVztJQUM5QjtRQUNFLGNBQWM7UUFDZCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVPLGNBQWM7UUFDcEIsTUFBTSxNQUFNLEdBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVwRCx3QkFBd0I7UUFDeEIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTlCLCtCQUErQjtRQUMvQixNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRztZQUM1QixJQUFJLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQztZQUN6QixJQUFJLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztZQUV2QixJQUFJLE9BQU8sQ0FBQztZQUVaLGFBQWE7WUFDYixFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFOUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFO2dCQUNuQixNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM3QixPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzFFLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQ1osMENBQTBDLEVBQzFDLElBQUksQ0FBQyxxQkFBcUIsRUFDMUIsSUFBSSxDQUNMLENBQUM7UUFDSixDQUFDLENBQUM7UUFFRixNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxVQUFVLE9BQU8sRUFBRSxLQUFtQjtZQUNsRSxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNyQixDQUFDLENBQUM7UUFFRixNQUFNLENBQUMsU0FBUyxDQUFDLHFCQUFxQixHQUFHO1lBQ3ZDLE1BQU0sS0FBSyxHQUFpQixJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ3ZDLE1BQU0sVUFBVSxHQUFRLElBQUksQ0FBQztZQUU3QixLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDeEMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxNQUFNO2dCQUN6QixNQUFNLEVBQUUsVUFBVSxDQUFDLE1BQU07Z0JBQ3pCLGVBQWUsRUFBRSxVQUFVLENBQUMsZUFBZTtnQkFDM0MsUUFBUSxFQUFFLFVBQVUsQ0FBQyxRQUFRO2dCQUM3QixtQkFBbUIsRUFBRSxVQUFVLENBQUMsbUJBQW1CO2dCQUNuRCxxQkFBcUIsRUFBRSxVQUFVLENBQUMscUJBQXFCO2dCQUN2RCxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsZ0JBQWdCO2dCQUM3QyxZQUFZLEVBQUUsVUFBVSxDQUFDLFlBQVk7Z0JBQ3JDLFdBQVcsRUFBRSxVQUFVLENBQUMsV0FBVztnQkFDbkMsYUFBYSxFQUFFLFVBQVUsQ0FBQyxhQUFhO2FBQ3hDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFTyxnQkFBZ0IsQ0FBQyxNQUFXO1FBQ2xDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRTtZQUM5QixJQUFJLEVBQUUsUUFBUTtZQUNkLE9BQU8sRUFBRSxHQUFHO1lBQ1osR0FBRyxFQUFFLENBQUM7WUFDTixLQUFLLEVBQUUsUUFBUTtZQUNmLFdBQVcsRUFBRSw2QkFBNkI7U0FDM0MsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFO1lBQzlCLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLENBQUM7WUFDVixHQUFHLEVBQUUsQ0FBQztZQUNOLEtBQUssRUFBRSxRQUFRO1lBQ2YsV0FBVyxFQUFFLDZCQUE2QjtTQUMzQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRTtZQUN2QyxJQUFJLEVBQUUsUUFBUTtZQUNkLE9BQU8sRUFBRSxDQUFDO1lBQ1YsR0FBRyxFQUFFLENBQUM7WUFDTixLQUFLLEVBQUUsa0JBQWtCO1lBQ3pCLFdBQVcsRUFBRSw2Q0FBNkM7U0FDM0QsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO1lBQ2hDLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLENBQUM7WUFDVixHQUFHLEVBQUUsQ0FBQztZQUNOLEtBQUssRUFBRSxXQUFXO1lBQ2xCLFdBQVcsRUFBRSxzQ0FBc0M7U0FDcEQsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUU7WUFDM0MsSUFBSSxFQUFFLFFBQVE7WUFDZCxPQUFPLEVBQUUsR0FBRztZQUNaLEdBQUcsRUFBRSxDQUFDO1lBQ04sS0FBSyxFQUFFLHVCQUF1QjtZQUM5QixXQUFXLEVBQ1QsNkdBQTZHO1NBQ2hILENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFO1lBQzdDLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLEdBQUc7WUFDWixHQUFHLEVBQUUsQ0FBQztZQUNOLEtBQUssRUFBRSx5QkFBeUI7WUFDaEMsV0FBVyxFQUFFLHNEQUFzRDtTQUNwRSxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRTtZQUN4QyxJQUFJLEVBQUUsUUFBUTtZQUNkLE9BQU8sRUFBRSxHQUFHO1lBQ1osR0FBRyxFQUFFLENBQUM7WUFDTixLQUFLLEVBQUUsbUJBQW1CO1lBQzFCLFdBQVcsRUFDVCxrR0FBa0c7U0FDckcsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFO1lBQ3BDLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLEdBQUc7WUFDWixLQUFLLEVBQUUsZUFBZTtZQUN0QixXQUFXLEVBQ1QsZ0pBQWdKO1NBQ25KLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRTtZQUNyQyxJQUFJLEVBQUUsUUFBUTtZQUNkLE9BQU8sRUFBRSxHQUFHO1lBQ1osS0FBSyxFQUFFLGdCQUFnQjtZQUN2QixXQUFXLEVBQ1QsNkRBQTZEO1NBQ2hFLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRTtZQUNuQyxJQUFJLEVBQUUsU0FBUztZQUNmLE9BQU8sRUFBRSxJQUFJO1lBQ2IsS0FBSyxFQUFFLGNBQWM7WUFDckIsV0FBVyxFQUNULG9IQUFvSDtTQUN2SCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFwSUQsOEJBb0lDIn0=\n\n//# sourceURL=webpack:///./src/scripts/script-agent.ts?')},"./src/scripts/script-crowd.ts":
/*!*************************************!*\
  !*** ./src/scripts/script-crowd.ts ***!
  \*************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nconst crowd_1 = __webpack_require__(/*! ../core/crowd */ "./src/core/crowd.ts");\r\nclass ScriptCrowd {\r\n    constructor() {\r\n        // --- execute\r\n        this.createPcScript();\r\n    }\r\n    createPcScript() {\r\n        const script = pc.createScript("orestisCrowd");\r\n        // --- attach attributes\r\n        this.attachAttributes(script);\r\n        // --- attach PC event handlers\r\n        script.prototype.initialize = function () {\r\n            this.pathfinder = undefined;\r\n            this.crowd = undefined;\r\n            this.agentsList = undefined;\r\n            this.activeAgents = undefined;\r\n            this.debugPath = undefined;\r\n            this.debugColors = undefined;\r\n            this.debugDestination = undefined;\r\n            this.debugLineColor = new pc.Color(1, 1, 1, 0.5);\r\n            // @ts-ignore\r\n            pc.events.attach(this.entity);\r\n            // --- events\r\n            this.entity.on("OrestisPathfinding:moveCrowdTo", function (point, renderPath) {\r\n                this.moveCrowdTo(null, point, renderPath);\r\n            }, this);\r\n            this.entity.on("OrestisPathfinding:moveAgentsTo", function (agentEntities, point, renderPath) {\r\n                this.moveCrowdTo(agentEntities, point, renderPath);\r\n            }, this);\r\n            this.entity.on("OrestisPathfinding:stopCrowd", function () {\r\n                this.stopCrowd(null);\r\n            }, this);\r\n            this.entity.on("OrestisPathfinding:stopAgents", function (agentEntities) {\r\n                this.stopCrowd(agentEntities);\r\n            }, this);\r\n            this.entity.on("OrestisPathfinding:teleportAgentsTo", function (agentEntities, point, renderPath) {\r\n                this.teleportAgentsTo(agentEntities, point);\r\n            }, this);\r\n            this.on("attr", function (property, value) {\r\n                this.initializeCrowd();\r\n            });\r\n        };\r\n        script.prototype.initializeCrowd = function (pathfinder) {\r\n            if (pathfinder) {\r\n                this.pathfinder = pathfinder;\r\n            }\r\n            if (this.crowd) {\r\n                this.crowd.destroy();\r\n            }\r\n            this.crowd = new crowd_1.OrestisCrowd(this, this.pathfinder, this.maxAgents, this.maxAgentRadius);\r\n            this.assignAgents();\r\n        };\r\n        script.prototype.destroyCrowd = function () {\r\n            if (this.crowd) {\r\n                this.crowd.destroy();\r\n            }\r\n            this.crowd = undefined;\r\n        };\r\n        script.prototype.assignAgents = function () {\r\n            this.agentsList = {};\r\n            this.agents.forEach((agentEntity) => {\r\n                var _a;\r\n                const orionAgent = (_a = agentEntity === null || agentEntity === void 0 ? void 0 : agentEntity.script) === null || _a === void 0 ? void 0 : _a.orestisAgent;\r\n                if (!orionAgent || !orionAgent.enabled)\r\n                    return true;\r\n                const agentId = this.crowd.addAgent(agentEntity, {\r\n                    radius: orionAgent.radius,\r\n                    height: orionAgent.height,\r\n                    maxAcceleration: orionAgent.maxAcceleration,\r\n                    maxSpeed: orionAgent.maxSpeed,\r\n                    collisionQueryRange: orionAgent.collisionQueryRange,\r\n                    pathOptimizationRange: orionAgent.pathOptimizationRange,\r\n                    separationWeight: orionAgent.separationWeight,\r\n                    stopDistance: orionAgent.stopDistance,\r\n                    orientAgent: orionAgent.orientAgent,\r\n                    orientInertia: orionAgent.orientInertia,\r\n                });\r\n                orionAgent.onAddAgent(agentId, this.crowd);\r\n                this.agentsList[agentEntity._guid] = agentId;\r\n            });\r\n        };\r\n        script.prototype.moveCrowdTo = function (agentEntities, point, debugLines) {\r\n     console.log(\'moving\');       if (!this.crowd)\r\n                return;\r\n            let navMeshPoint;\r\n            let agents;\r\n            // --- check if we are moving individual agents only\r\n            if (agentEntities) {\r\n                agents = [];\r\n                agentEntities.forEach((agentEntity) => {\r\n                    agents.push(this.agentsList[agentEntity._guid]);\r\n                });\r\n            }\r\n            else {\r\n                agents = this.crowd.getAgents();\r\n            }\r\n            agents.forEach((agent) => {\r\n                navMeshPoint = this.pathfinder.getClosestPoint(point);\r\n                if (this.isPointCloseToSelected(navMeshPoint, point) === true) {\r\n                    this.crowd.agentGoto(agent, navMeshPoint);\r\n                }\r\n            });\r\n            this.activeAgents = agents;\r\n            this.debugDestination = debugLines ? navMeshPoint.clone() : undefined;\r\n        };\r\n        script.prototype.stopCrowd = function (agentEntities) {\r\n            if (!this.crowd)\r\n                return;\r\n            let agents;\r\n            // --- check if we are moving individual agents only\r\n            if (agentEntities) {\r\n                agents = [];\r\n                agentEntities.forEach((agentEntity) => {\r\n                    agents.push(this.agentsList[agentEntity._guid]);\r\n                });\r\n            }\r\n            else {\r\n                agents = this.crowd.getAgents();\r\n            }\r\n            agents.forEach((agent) => {\r\n                this.crowd.agentStop(agent);\r\n            });\r\n            this.activeAgents = undefined;\r\n            this.debugDestination = undefined;\r\n        };\r\n        script.prototype.isPointCloseToSelected = function (point, selectedPoint) {\r\n            let valid = true;\r\n            const extents = this.pathfinder.parameters.queryExtent;\r\n            if (Math.abs(point.x - selectedPoint.x) > extents.x)\r\n                valid = false;\r\n            if (valid && Math.abs(point.y - selectedPoint.y) > extents.y)\r\n                valid = false;\r\n            if (valid && Math.abs(point.z - selectedPoint.z) > extents.z)\r\n                valid = false;\r\n            return valid;\r\n        };\r\n        script.prototype.teleportAgentsTo = function (agentEntities, point) {\r\n            if (!this.crowd)\r\n                return;\r\n            let navMeshPoint;\r\n            let agents;\r\n            // --- check if we are moving individual agents only\r\n            if (agentEntities) {\r\n                agents = [];\r\n                agentEntities.forEach((agentEntity) => {\r\n                    agents.push(this.agentsList[agentEntity._guid]);\r\n                });\r\n            }\r\n            else {\r\n                agents = this.crowd.getAgents();\r\n            }\r\n            agents.forEach((agent) => {\r\n                navMeshPoint = this.pathfinder.getClosestPoint(point);\r\n                if (this.isPointCloseToSelected(navMeshPoint, point) === true) {\r\n                    this.crowd.agentTeleport(agent, navMeshPoint);\r\n                    if (this.crowd.isAgentActive(agent) === false) {\r\n                        this.crowd.getAgentEntity(agent).setPosition(navMeshPoint);\r\n                    }\r\n                }\r\n            });\r\n            this.activeAgents = undefined;\r\n            this.debugDestination = undefined;\r\n        };\r\n        script.prototype.calculateDebugLines = function () {\r\n            const pathfinder = this.pathfinder;\r\n            const agents = this.activeAgents;\r\n            this.debugPath = [];\r\n            this.debugColors = [];\r\n            agents.forEach((agent) => {\r\n                const agentEntity = this.crowd.getAgentEntity(agent);\r\n                if (!agentEntity)\r\n                    return true;\r\n                const path = pathfinder.computePath(pathfinder.getClosestPoint(agentEntity.getPosition()), this.debugDestination);\r\n                path.forEach((end, index) => {\r\n                    if (index === 0)\r\n                        return true;\r\n                    const start = path[index - 1];\r\n                    this.debugPath.push(start);\r\n                    this.debugPath.push(end);\r\n                    this.debugColors.push(this.debugLineColor);\r\n                    this.debugColors.push(this.debugLineColor);\r\n                });\r\n            });\r\n        };\r\n        script.prototype.update = function () {\r\n            if (this.debugDestination) {\r\n                this.calculateDebugLines();\r\n                this.app.renderLines(this.debugPath, this.debugColors);\r\n            }\r\n        };\r\n    }\r\n    attachAttributes(script) {\r\n        script.attributes.add("pathfinderEntity", {\r\n            type: "entity",\r\n            title: "Pathfinder",\r\n            description: "Drag and drop the pathfinder entity this crowd should interact with. Updating this requires regenerating the navmesh or reloading your app",\r\n        });\r\n        script.attributes.add("agents", {\r\n            type: "entity",\r\n            array: true,\r\n            title: "Agents",\r\n            description: "Assigns agents to this crowd.",\r\n        });\r\n        script.attributes.add("maxAgents", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 1,\r\n            title: "Max Agents",\r\n            description: "The maximum number of agents allowed on this crowd.",\r\n        });\r\n        script.attributes.add("maxAgentRadius", {\r\n            type: "number",\r\n            default: 0.1,\r\n            min: 0,\r\n            title: "Max Agent Radius",\r\n            description: "The maximum radius an agent can have.",\r\n        });\r\n    }\r\n}\r\nexports.default = ScriptCrowd;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LWNyb3dkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjcmlwdHMvc2NyaXB0LWNyb3dkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EseUNBQTZDO0FBRTdDLE1BQXFCLFdBQVc7SUFDOUI7UUFDRSxjQUFjO1FBQ2QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFTyxjQUFjO1FBQ3BCLE1BQU0sTUFBTSxHQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFcEQsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU5QiwrQkFBK0I7UUFDL0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUc7WUFDNUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7WUFDNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7WUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7WUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxTQUFTLENBQUM7WUFFOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDM0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7WUFDN0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLFNBQVMsQ0FBQztZQUNsQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUVqRCxhQUFhO1lBQ2IsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRTlCLGFBQWE7WUFDYixJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FDWixnQ0FBZ0MsRUFDaEMsVUFBVSxLQUFLLEVBQUUsVUFBVTtnQkFDekIsSUFBSSxDQUFD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\n\n//# sourceURL=webpack:///./src/scripts/script-crowd.ts?')},"./src/scripts/script-obstacle.ts":
/*!****************************************!*\
  !*** ./src/scripts/script-obstacle.ts ***!
  \****************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nclass ScriptObstacle {\r\n    constructor() {\r\n        // --- execute\r\n        this.createPcScript();\r\n    }\r\n    createPcScript() {\r\n        const script = pc.createScript("orestisObstacle");\r\n        // --- attach attributes\r\n        this.attachAttributes(script);\r\n        // --- attach PC event handlers\r\n        script.prototype.initialize = function () {\r\n            this.pathfinder = undefined;\r\n            this.obstacleRef = undefined;\r\n            this.state = this.initialState;\r\n            this.obstaclePos = this.entity.getPosition().clone();\r\n            // --- events\r\n            this.entity.on("OrestisPathfinding:initializeObstacle", this.initializeObstacle, this);\r\n            this.on("state", function (state) {\r\n                this.updateObstacle(state);\r\n            }, this);\r\n        };\r\n        script.prototype.initializeObstacle = function (pathfinder) {\r\n            var _a, _b, _c;\r\n            if (pathfinder) {\r\n                this.pathfinder = pathfinder;\r\n            }\r\n            else if (this.pathfinderEntity) {\r\n                this.pathfinder = (_c = (_b = (_a = this.pathfinderEntity) === null || _a === void 0 ? void 0 : _a.script) === null || _b === void 0 ? void 0 : _b.orestisPathfinding) === null || _c === void 0 ? void 0 : _c.pathfinder;\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n            this.updateObstacle(this.state);\r\n        };\r\n        script.prototype.updateObstacle = function (state) {\r\n            this.state = state === true ? true : false;\r\n            const pathfinder = this.pathfinder;\r\n            if (state === true) {\r\n                let obstacle;\r\n                switch (this.obstacleType) {\r\n                    case "box":\r\n                        obstacle = pathfinder.addBoxObstacle(this.obstaclePos, this.boxExtents, this.boxYAngle * pc.math.DEG_TO_RAD);\r\n                        break;\r\n                    case "cylinder":\r\n                        obstacle = pathfinder.addCylinderObstacle(this.obstaclePos, this.cylinderRadius, this.cylinderHeight);\r\n                        break;\r\n                }\r\n                this.obstacleRef = obstacle;\r\n            }\r\n            else {\r\n                pathfinder.removeObstacle(this.obstacleRef);\r\n                this.obstacleRef = undefined;\r\n                pathfinder.navMesh.update();\r\n            }\r\n        };\r\n    }\r\n    attachAttributes(script) {\r\n        script.attributes.add("pathfinderEntity", {\r\n            type: "entity",\r\n            title: "Pathfinder",\r\n            description: "Drag and drop the pathfinder entity this obstacle should interact with. Updating this requires regenerating the navmesh or reloading your app",\r\n        });\r\n        script.attributes.add("obstacleType", {\r\n            type: "string",\r\n            default: "box",\r\n            title: "Obstacle Type",\r\n            description: "Set the type of the obstacle shape.",\r\n            enum: [{ Box: "box" }, { Cylinder: "cylinder" }],\r\n        });\r\n        script.attributes.add("boxExtents", {\r\n            type: "vec3",\r\n            default: [1, 1, 1],\r\n            title: "Box Extents",\r\n            description: "The box extents on each axis.",\r\n        });\r\n        script.attributes.add("boxYAngle", {\r\n            type: "number",\r\n            default: 0,\r\n            min: 0,\r\n            max: 360,\r\n            title: "Box Y Angle",\r\n            description: "The angle of the box orientation on the Y axis.",\r\n        });\r\n        script.attributes.add("cylinderRadius", {\r\n            type: "number",\r\n            default: 1.0,\r\n            min: 0,\r\n            title: "Cylinder Radius",\r\n            description: "The cylinder radius.",\r\n        });\r\n        script.attributes.add("cylinderHeight", {\r\n            type: "number",\r\n            default: 2,\r\n            min: 0,\r\n            title: "Cylinder Height",\r\n            description: "The cylinder height.",\r\n        });\r\n        script.attributes.add("initialState", {\r\n            type: "boolean",\r\n            default: true,\r\n            title: "Initial State",\r\n            description: "If the obstacle will be enabled or disabled when the navmesh is generated.",\r\n        });\r\n    }\r\n}\r\nexports.default = ScriptObstacle;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LW9ic3RhY2xlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjcmlwdHMvc2NyaXB0LW9ic3RhY2xlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsTUFBcUIsY0FBYztJQUNqQztRQUNFLGNBQWM7UUFDZCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVPLGNBQWM7UUFDcEIsTUFBTSxNQUFNLEdBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRXZELHdCQUF3QjtRQUN4QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFOUIsK0JBQStCO1FBQy9CLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxHQUFHO1lBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1lBQzVCLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUMvQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFckQsYUFBYTtZQUNiLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUNaLHVDQUF1QyxFQUN2QyxJQUFJLENBQUMsa0JBQWtCLEVBQ3ZCLElBQUksQ0FDTCxDQUFDO1lBRUYsSUFBSSxDQUFDLEVBQUUsQ0FDTCxPQUFPLEVBQ1AsVUFBVSxLQUFLO2dCQUNiLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0IsQ0FBQyxFQUNELElBQUksQ0FDTCxDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUYsTUFBTSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsR0FBRyxVQUNwQyxVQUE2Qjs7WUFFN0IsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLFVBQVUsR0FBRyxV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\n\n//# sourceURL=webpack:///./src/scripts/script-obstacle.ts?')},"./src/scripts/script.ts":
/*!*******************************!*\
  !*** ./src/scripts/script.ts ***!
  \*******************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nconst pathfinder_1 = __webpack_require__(/*! ../core/pathfinder */ "./src/core/pathfinder.ts");\r\nclass Script {\r\n    constructor() {\r\n        // --- execute\r\n        this.createPcScript();\r\n    }\r\n    createPcScript() {\r\n        const script = pc.createScript("orestisPathfinding");\r\n        // --- attach attributes\r\n        this.attachAttributes(script);\r\n        // --- attach PC event handlers\r\n        script.prototype.postInitialize = function () {\r\n            this.pathfinder = new pathfinder_1.OrestisPathfinder(this);\r\n            // @ts-ignore\r\n            pc.events.attach(this.entity);\r\n            // --- editor events\r\n            let timeout;\r\n            this.on("attr", () => {\r\n                window.clearTimeout(timeout);\r\n                timeout = window.setTimeout(() => {\r\n                    this.pathfinder.onAttrUpdate();\r\n                }, 300);\r\n            });\r\n            // --- events\r\n            this.entity.on("OrestisPathfinding:findPath", this.findPath, this);\r\n            if (this.onEventStart) {\r\n                this.app.once(this.onEventStart, function () {\r\n                    this.pathfinder.createNavMesh();\r\n                }, this);\r\n            }\r\n            else {\r\n                this.pathfinder.createNavMesh();\r\n            }\r\n        };\r\n        script.prototype.findPath = function (start, end, callback) {\r\n            callback(this.pathfinder.computePath(start, end));\r\n        };\r\n    }\r\n    attachAttributes(script) {\r\n        script.attributes.add("cellSize", {\r\n            type: "number",\r\n            default: 0.25,\r\n            min: 0,\r\n            title: "Cell Size",\r\n            description: "XZ plane cell size, used to calculate the grid size based on the bounding box of the selected scene. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("cellHeight", {\r\n            type: "number",\r\n            default: 0.25,\r\n            min: 0,\r\n            title: "Cell Height",\r\n            description: "Y-axis cell size, used to calculate the grid size based on the bounding box of the selected scene. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("walkableHeight", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Walkable Height",\r\n            description: "Minimum floor to ceiling height that will still allow the floor area to be considered walkable. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("walkableRadius", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Walkable Radius",\r\n            description: "The distance to erode/shrink the walkable area of the heightfield away from obstructions. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("walkableClimb", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Walkable Climb",\r\n            description: "Maximum ledge height that is considered to still be traversable. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("walkableSlopeAngle", {\r\n            type: "number",\r\n            default: 35,\r\n            min: 0,\r\n            max: 90,\r\n            title: "Walkable Slope Angle",\r\n            description: "The maximum slope that is considered walkable. [Limits: 0 <= value < 90]",\r\n        });\r\n        script.attributes.add("regionMinSize", {\r\n            type: "number",\r\n            default: 8,\r\n            min: 0,\r\n            title: "Region Min Size",\r\n            description: "The minimum number of cells allowed to form isolated island areas. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("regionMergeSize", {\r\n            type: "number",\r\n            default: 20,\r\n            min: 0,\r\n            title: "Region Merge Size",\r\n            description: "Any regions with a span count smaller than this value will, if possible, be merged with larger regions. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("edgeMaxLen", {\r\n            type: "number",\r\n            default: 12,\r\n            min: 0,\r\n            title: "Edge Max Length",\r\n            description: "The maximum allowed length for contour edges along the border of the mesh. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("edgeMaxError", {\r\n            type: "number",\r\n            default: 1.3,\r\n            min: 0,\r\n            title: "Edge Max Error",\r\n            description: "The maximum distance a simplfied contour\'s border edges should deviate the original raw contour. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("vertsPerPoly", {\r\n            type: "number",\r\n            default: 6,\r\n            min: 3,\r\n            title: "Max Verts Per Poly",\r\n            description: "The maximum number of vertices allowed for polygons generated during the contour to polygon conversion process. [Limit: >= 3]",\r\n        });\r\n        script.attributes.add("detailSampleDist", {\r\n            type: "number",\r\n            default: 6,\r\n            min: 0.9,\r\n            title: "Detail Sample Dist",\r\n            description: "Sets the sampling distance to use when generating the detail mesh, for height detail only. [Limits: >= 0.9]",\r\n        });\r\n        script.attributes.add("detailSampleMaxError", {\r\n            type: "number",\r\n            default: 1,\r\n            min: 0,\r\n            title: "Detail Sample Max Error",\r\n            description: "The maximum distance the detail mesh surface should deviate from heightfield data, for height detail only. [Limit: >=0]",\r\n        });\r\n        script.attributes.add("tileSize", {\r\n            type: "number",\r\n            default: 0,\r\n            min: 0,\r\n            title: "Tile Size",\r\n            description: "The width/height size of tile\'s on the xz-plane. If you plan to use obstacles the tileSize should be > 0. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("borderSize", {\r\n            type: "number",\r\n            default: 0,\r\n            min: 0,\r\n            title: "Border Size",\r\n            description: "The size of the non-navigable border around the heightfield. [Limit: >= 0]",\r\n        });\r\n        script.attributes.add("debugNavMesh", {\r\n            type: "boolean",\r\n            default: false,\r\n            title: "Debug Nav Mesh",\r\n            description: "If enabled the generated nav mesh will be rendered.",\r\n        });\r\n        script.attributes.add("queryExtent", {\r\n            type: "vec3",\r\n            default: [1, 1, 1],\r\n            title: "Query Extent",\r\n            description: "Set the Bounding box extent for doing spatial queries (getClosestPoint, getRandomPointAround etc.).",\r\n        });\r\n        script.attributes.add("excludeTags", {\r\n            type: "string",\r\n            default: "navmesh-exclude",\r\n            title: "Exclude Tags",\r\n            description: "A comma separated list of entity tags to exclude from the navmesh.",\r\n        });\r\n        script.attributes.add("onEventStart", {\r\n            type: "string",\r\n            title: "On Event Start",\r\n            description: "Run the navmesh generator when this app wide event fires, if empty the navmesh will be generated on initialize.",\r\n        });\r\n        script.attributes.add("onEventReady", {\r\n            type: "string",\r\n            title: "On Event Ready",\r\n            description: "Fire a custom event when the navmesh generation finished.",\r\n        });\r\n    }\r\n}\r\nexports.default = Script;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjcmlwdHMvc2NyaXB0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbURBQXVEO0FBRXZELE1BQXFCLE1BQU07SUFDekI7UUFDRSxjQUFjO1FBQ2QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFTyxjQUFjO1FBQ3BCLE1BQU0sTUFBTSxHQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUUxRCx3QkFBd0I7UUFDeEIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTlCLCtCQUErQjtRQUMvQixNQUFNLENBQUMsU0FBUyxDQUFDLGNBQWMsR0FBRztZQUNoQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksOEJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFOUMsYUFBYTtZQUNiLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUU5QixvQkFBb0I7WUFDcEIsSUFBSSxPQUFPLENBQUM7WUFFWixJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUU7Z0JBQ25CLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzdCLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDL0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDakMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ1YsQ0FBQyxDQUFDLENBQUM7WUFFSCxhQUFhO1lBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsNkJBQTZCLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVuRSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ3JCLElBQUks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\n\n//# sourceURL=webpack:///./src/scripts/script.ts?')}});var DragOrbit=pc.createScript("dragOrbit");DragOrbit.attributes.add("dragSpeed",{type:"number",default:.1,title:"Drag Speed"}),DragOrbit.prototype.initialize=function(){this.mouseDown=!1,this.touchDown=!1,this.touchStart=[0,0],this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,(()=>{this.mouseDown=!0}),this),this.app.mouse.on(pc.EVENT_MOUSEUP,(()=>{this.mouseDown=!1}),this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.ENVET_TOUCHEND,this.onTouchEnd,this))},DragOrbit.prototype.update=function(t){},DragOrbit.prototype.onMouseMove=function(t){this.mouseDown&&this.entity.rotate(0,-t.dx*this.dragSpeed,0)},DragOrbit.prototype.onTouchMove=function(t){this.touchDown&&1===t.touches.length&&(this.entity.rotate(0,(this.lastTouch?this.lastTouch.x-t.touches[0].x:0)*this.dragSpeed,0),this.lastTouch=t.touches[0])},DragOrbit.prototype.onTouchStart=function(t){1===t.touches.length&&(this.touchDown=!0,this.lastTouch=t.touches[0])},DragOrbit.prototype.onTouchEnd=function(t){this.touchDown=!1,this.lastTouch=null};