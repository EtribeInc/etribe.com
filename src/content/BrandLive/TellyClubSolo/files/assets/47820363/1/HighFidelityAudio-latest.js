var HighFidelityAudio;HighFidelityAudio=(()=>{"use strict";var __webpack_modules__={300:(e,t)=>{var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i)return i;throw new Error("unable to locate global object")}();e.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response},946:(e,t,i)=>{i.r(t),i.d(t,{AudioAPIData:()=>c,AvailableUserDataSubscriptionComponents:()=>mn,Communicator:()=>Cn,ConnectionStates:()=>vn,Constants:()=>u,Handedness:()=>_,HiFiAudioAPIData:()=>c,HiFiCommunicator:()=>Cn,HiFiConnectionStates:()=>vn,HiFiConstants:()=>u,HiFiHandedness:()=>_,HiFiLogLevel:()=>m.D,HiFiLogger:()=>m.M,HiFiUserDataStreamingScopes:()=>Sn,HiFiUtilities:()=>n.H,LogLevel:()=>m.D,Logger:()=>m.M,MuteChangedEvent:()=>gn,MuteReason:()=>_n,Point3D:()=>r,Quaternion:()=>l,ReceivedAudioAPIData:()=>h,ReceivedHiFiAudioAPIData:()=>h,UserDataStreamingScopes:()=>Sn,UserDataSubscription:()=>pn,Utilities:()=>n.H,WorldFrameConfiguration:()=>f,apiVersion:()=>wn,getBestAudioConstraints:()=>yn,hiFiAPIVersion:()=>wn,preciseInterval:()=>An});var n=i(24);const a=1e-15,o=180/Math.PI,s=Math.PI/180;class r{constructor({x:e=0,y:t=0,z:i=0}={}){this.x=e,this.y=t,this.z=i}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}length2(){return this.x*this.x+this.y*this.y+this.z*this.z}static add(e,t){return new r({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z})}static subtract(e,t){return new r({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z})}static scale(e,t){return new r({x:e*t.x,y:e*t.y,z:e*t.z})}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static cross(e,t){return new r({x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x})}static distance(e,t){let i=t.x-e.x,n=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+n*n+a*a)}static distance2(e,t){let i=t.x-e.x,n=t.y-e.y,a=t.z-e.z;return i*i+n*n+a*a}}class l{constructor({w:e=1,x:t=0,y:i=0,z:n=0}={}){this.w=e,this.x=t,this.y=i,this.z=n}static fromAngleAxis(e,t){let i=new l,n=t.length2();if(n>a){let a=Math.cos(.5*e),o=Math.sin(.5*e)/Math.sqrt(n);i.w=a,i.x=t.x*o,i.y=t.y*o,i.z=t.z*o}return i}getAngle(){let e=0,t=l.dot(this,this);return t>a&&(e=Math.abs(2*Math.acos(this.w/Math.sqrt(t)))),e}getAxis(){let e=new r,t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>a){let i=Math.sqrt(t);e.x=this.x/i,e.y=this.y/i,e.z=this.z/i;let n=Math.sqrt(t+this.w*this.w);2*Math.acos(this.w/n)<0&&e.negate()}return e}getEulerAngles(){let e=new r({x:0,y:0,z:-1}),t=this.rotateVector(e),i=0,n=t.x*t.x+t.z*t.z,s=new r({x:1,y:0,z:0});if(n>a)i=Math.acos(r.dot(e,t)/Math.sqrt(n)),r.dot(t,s)>0&&(i*=-1);else{let t=this.rotateVector(s);n=t.x*t.x+t.z*t.z,i=Math.acos(r.dot(t,s)/Math.sqrt(n)),r.dot(t,e)<0&&(i*=-1)}let l=Math.asin(t.y),d=new r({x:0,y:1,z:0}),c=this.rotateVector(d),h=new r({x:Math.cos(i),y:0,z:-Math.sin(i)}),u=r.cross(h,t),_=Math.atan2(r.dot(c,h),r.dot(c,u));return i*=o,l*=o,_*=o,{yawDegrees:i,pitchDegrees:l,rollDegrees:_}}getAzimuth(){let e=new r({x:0,y:0,z:-1}),t=this.rotateVector(e),i=0,n=t.x*t.x+t.z*t.z,s=new r({x:1,y:0,z:0});if(n>a)i=Math.acos(r.dot(e,t)/Math.sqrt(n)),r.dot(t,s)>0&&(i*=-1);else{let t=this.rotateVector(s);n=t.x*t.x+t.z*t.z,i=Math.acos(r.dot(t,s)/Math.sqrt(n)),r.dot(t,e)<0&&(i*=-1)}return i*o}getElevation(){let e=new r({x:0,y:0,z:-1}),t=this.rotateVector(e);return o*Math.asin(t.y)}static fromEulerAngles({yawDegrees:e=0,pitchDegrees:t=0,rollDegrees:i=0}={}){let n=new r({x:0,y:1,z:0}),a=new r({x:1,y:0,z:0}),o=new r({x:0,y:0,z:-1}),d=l.fromAngleAxis(e*s,n),c=d.rotateVector(a),h=l.fromAngleAxis(t*s,c),u=h.rotateVector(d.rotateVector(o)),_=l.fromAngleAxis(i*s,u);return l.multiply(_,l.multiply(h,d))}getYaw(){return this.getAzimuth()}getPitch(){return this.getElevation()}static dot(e,t){return e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z}normalize(){let e=this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z;if(e>a){let t=1/Math.sqrt(e);this.w*=t,this.x*=t,this.y*=t,this.z*=t}}rotateVector(e){return d.fromQuaternion(this).transformVector(e)}static multiply(e,t){return new l({w:e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,x:e.w*t.x+e.x*t.w+e.y*t.z-e.z*t.y,y:e.w*t.y+e.y*t.w+e.z*t.x-e.x*t.z,z:e.w*t.z+e.z*t.w+e.x*t.y-e.y*t.x})}}class d{constructor(e,t,i){this.a=new r({x:e.x,y:e.y,z:e.z}),this.b=new r({x:t.x,y:t.y,z:t.z}),this.c=new r({x:i.x,y:i.y,z:i.z})}transformVector(e){let t=new r;return t.x=r.dot(this.a,e),t.y=r.dot(this.b,e),t.z=r.dot(this.c,e),t}transpose(){var e=this.a.y;this.a.y=this.b.x,this.b.x=e,e=this.a.z,this.a.z=this.c.x,this.c.x=e,e=this.b.z,this.b.z=this.c.y,this.c.y=e}static multiply(e,t){let i=new r({x:e.a.x*t.a.x+e.a.y*t.b.x+e.a.z*t.c.x,y:e.a.x*t.a.y+e.a.y*t.b.y+e.a.z*t.c.y,z:e.a.x*t.a.z+e.a.y*t.b.z+e.a.z*t.c.z}),n=new r({x:e.b.x*t.a.x+e.b.y*t.b.x+e.b.z*t.c.x,y:e.b.x*t.a.y+e.b.y*t.b.y+e.b.z*t.c.y,z:e.b.x*t.a.z+e.b.y*t.b.z+e.b.z*t.c.z}),a=new r({x:e.c.x*t.a.x+e.c.y*t.b.x+e.c.z*t.c.x,y:e.c.x*t.a.y+e.c.y*t.b.y+e.c.z*t.c.y,z:e.c.x*t.a.z+e.c.y*t.b.z+e.c.z*t.c.z});return new d(i,n,a)}static fromQuaternion(e){let t=e.w*e.w,i=e.x*e.x,n=e.y*e.y,a=e.z*e.z,o=1/(i+n+a+t),s=new r,l=new r,c=new r;s.x=(i-n-a+t)*o,l.y=(-i+n-a+t)*o,c.z=(-i-n+a+t)*o;let h=e.x*e.y,u=e.z*e.w;return l.x=2*(h+u)*o,s.y=2*(h-u)*o,h=e.x*e.z,u=e.y*e.w,c.x=2*(h-u)*o,s.z=2*(h+u)*o,h=e.y*e.z,u=e.x*e.w,c.y=2*(h+u)*o,l.z=2*(h-u)*o,new d(s,l,c)}static toQuaternion(e){let t=new l;return t.w=Math.sqrt(Math.max(0,1+e.a.x+e.b.y+e.c.z))/2,t.x=Math.sqrt(Math.max(0,1+e.a.x-e.b.y-e.c.z))/2,t.y=Math.sqrt(Math.max(0,1-e.a.x+e.b.y-e.c.z))/2,t.z=Math.sqrt(Math.max(0,1-e.a.x-e.b.y+e.c.z))/2,e.c.y-e.b.z<0&&(t.x*=-1),e.a.z-e.c.x<0&&(t.y*=-1),e.b.x-e.a.y<0&&(t.z*=-1),t}}class c{constructor({position:e=null,orientation:t=null,volumeThreshold:i=null,hiFiGain:n=null,userAttenuation:a=null,userRolloff:o=null}={}){this.position=e,this.orientation=t,this.volumeThreshold=i,this.hiFiGain=n,this.userAttenuation=a,this.userRolloff=o,this._otherUserGainQueue={}}}class h extends c{constructor(e={}){super(e),this.providedUserID=e.providedUserID,this.hashedVisitID=e.hashedVisitID,this.volumeDecibels=e.volumeDecibels,this.isStereo=e.isStereo}}class u{constructor(){}}u.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=10,u.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=50,u.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT="api.highfidelity.com",u.DEFAULT_PROD_HIGH_FIDELITY_PORT=443,u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT={autoRetryInitialConnection:!1,maxSecondsToSpendRetryingInitialConnection:15,autoRetryOnDisconnect:!1,maxSecondsToSpendRetryingOnDisconnect:60,pauseBetweenRetriesMS:500,timeoutPerConnectionAttemptMS:5e3},u.MIN_PAUSE_BETWEEN_RETRIES=100;var _,m=i(649);class g{constructor(e,t,i=!0){let n=r.cross(e,t);i||n.negate();let a=new d(e,t,n),o=new d(new r({x:0,y:0,z:-1}),new r({x:0,y:1,z:0}),new r({x:1,y:0,z:0}));o.transpose(),this._worldToHifi=d.multiply(o,a),this._hifiToWorld=new d(this._worldToHifi.a,this._worldToHifi.b,this._worldToHifi.c),this._hifiToWorld.transpose()}WorldPositionToHiFi(e){return this._worldToHifi.transformVector(e)}HiFiPositionToWorld(e){return this._hifiToWorld.transformVector(e)}WorldOrientationToHiFi(e){let t=d.fromQuaternion(e);return t=d.multiply(t,this._hifiToWorld),t=d.multiply(this._worldToHifi,t),d.toQuaternion(t)}HiFiOrientationToWorld(e){let t=d.fromQuaternion(e);return t=d.multiply(t,this._worldToHifi),t=d.multiply(this._hifiToWorld,t),d.toQuaternion(t)}WorldIsCompatibleWithHifi(){let e=new r({x:0,y:1,z:0}),t=this._worldToHifi.transformVector(e);if(Math.abs(1-Math.abs(r.dot(e,t)))>.001)return!1;let i=new r({x:1,y:0,z:0}),n=new r({x:0,y:0,z:1}),a=this._worldToHifi.transformVector(i),o=this._worldToHifi.transformVector(n),s=r.cross(o,a);return Math.abs(1-r.dot(s,t))<.001}}!function(e){e.RightHand="Right Hand",e.LeftHand="Left Hand"}(_||(_={}));class f{constructor(e,t,i){this.forward=e,this.up=t,this.handedness=i}static isValid(e){let t=!0;return 1!=r.dot(e.forward,e.forward)&&(m.M.error("Invalid axis configuration: forward direction is not unitary"),t=!1),1!=r.dot(e.forward,e.forward)&&(m.M.error("Invalid axis configuration: up direction is not unitary"),t=!1),0!=r.dot(e.forward,e.up)&&(m.M.error("Invalid axis configuration: forward and up directions are not orthogonal"),t=!1),t}}var p,v=!0;class S{static createUUID(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}static log(e,t){if(void 0!==t&&(e=t+": "+e),v&&console.log(e),"undefined"!=typeof document&&v)try{document.dispatchEvent(new CustomEvent("logger",{detail:e}))}catch(t){console.log(e),console.log("Additionally, an error was encountered trying to log that."),console.log(t)}}static err(e,t){void 0!==t&&(e=t+": "+e),console.log("%c %s","color: #FB0A1C",e),"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("errlogger",{detail:e}))}static safelyPrintable(e){try{return JSON.stringify(e)}catch(t){return e}}static getElementCSSSize(e){if(getComputedStyle){var t=getComputedStyle(e);return{width:parseInt(t.getPropertyValue("width"),10),height:parseInt(t.getPropertyValue("height"),10)}}}static setDebug(e){v=e}}!function(e){e.CONNECTING="connecting",e.OPEN="open",e.ERROR="error",e.CLOSING="closing",e.CLOSED="closed",e.UNAVAILABLE="unavailable"}(p||(p={}));class b{constructor(){S.log("Constructor","RaviSignalingConnection"),this._stateChangeHandlers=new Set,this._messageHandlers=new Set,this._state=p.CLOSED,this._signalingImplementation=new w(this)}getState(){return this._state}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return S.err("Error adding a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return S.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}addMessageHandler(e){try{return this._messageHandlers.add(e),!0}catch(e){return S.err("Error adding a message handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeMessageHandler(e){try{return this._messageHandlers.delete(e),!0}catch(e){return S.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}openRAVISignalingConnection(e){var t=this;return this._state===p.OPEN?Promise.resolve("There is already an open WebSocket connection. To reconnect, first close the existing WebSocket and then attempt to open again."):new Promise(((i,n)=>{t._resolveOpen=i,t._rejectOpen=n,S.log("Opening signaling connection to "+e,"RaviSignalingController");let a={state:p.CONNECTING};this._handleStateChange(a,p.CONNECTING),this._signalingImplementation._open(e)}))}send(e){this._signalingImplementation._send(e)}closeRAVISignalingConnection(){var e=this;return this._state===p.CLOSED?Promise.resolve("Signaling connection is already closed."):new Promise(((t,i)=>{e._resolveClose=t,e._rejectClose=i,S.log("Closing signaling connection","RaviSignalingController");let n={state:p.CLOSING};this._handleStateChange(n,p.CLOSING),this._signalingImplementation._close()}))}_handleStateChange(e={},t){this._fulfillPromises(e,t),t!==this._state&&(this._state=t,e.state=t,S.log("_handleStateChange: "+S.safelyPrintable(e),"RaviSignalingConnection"),this._stateChangeHandlers.forEach((function(t){t&&t(e)})))}_fulfillPromises(e={},t){let i=e.reason||e.message||t;switch(S.log("_fulfillPromises: Handling state "+t,"RaviSignalingConnection"),t){case p.OPEN:this._resolveOpen&&this._resolveOpen(),this._rejectClose&&this._rejectClose(i);break;case p.CLOSED:this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;case p.ERROR:this._rejectOpen&&this._rejectOpen(i),this._rejectClose&&this._rejectClose(i);break;case p.UNAVAILABLE:this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;default:S.log("_fulfillPromises: Skipping in-progress state "+t,"RaviSignalingConnection")}}_handleMessage(e){if(S.log("_doOnmessage: "+S.safelyPrintable(e),"RaviSignalingConnection"),e.data)try{let t=JSON.parse(e.data);t.error&&"service-unavailable"===t.error&&this._handleStateChange({},p.UNAVAILABLE)}catch(e){}this._messageHandlers.forEach((function(t){t&&t(e)}))}}let C=null;C="undefined"==typeof self?i(26):WebSocket;class w{constructor(e){this._onWebSocketOpen=function(e){this._raviSignalingConnection._handleStateChange(e,p.OPEN)}.bind(this),this._onWebSocketError=function(e){this._raviSignalingConnection._handleStateChange(e,p.ERROR)}.bind(this),this._onWebSocketClose=function(e){e&&e.code&&e.code>4e3?(S.err("_handleStateChange: signaling error code "+e.code+":  "+e.reason,"RaviSignalingConnection"),this._raviSignalingConnection._handleStateChange(e,p.ERROR)):this._raviSignalingConnection._handleStateChange(e,p.CLOSED)}.bind(this),S.log("constructor","RaviSignalingWebSocketImplementation"),this._raviSignalingConnection=e}_open(e){var t=this._raviSignalingConnection;this._webSocket&&this._webSocket.readyState===C.OPEN?t._handleStateChange({},p.OPEN):(this._webSocket=new C(e),this._webSocket.addEventListener("open",this._onWebSocketOpen),this._webSocket.addEventListener("error",this._onWebSocketError),this._webSocket.addEventListener("close",this._onWebSocketClose),this._webSocket.addEventListener("message",(function(e){t._handleMessage(e)})))}_send(e){this._webSocket&&this._webSocket.readyState===C.OPEN&&(S.log("Sending message to server: "+e,"RaviSignalingWebSocketImplementation"),this._webSocket.send(e))}_close(){var e=this._raviSignalingConnection;if(!this._webSocket)return void e._handleStateChange({},p.CLOSED);let t=this._webSocket;this._webSocket=null,t.removeEventListener("open",this._onWebSocketOpen),t.removeEventListener("error",this._onWebSocketError),t.removeEventListener("close",this._onWebSocketClose),t.close(),e._handleStateChange({},p.CLOSED)}}class y{constructor(e){S.log("constructor","RaviStreamController"),this._commandController=e,this._audioStream=null,this._videoStream=null,this._onVideoStreamStateChanged=function(e){S.log("onvideostreamstatechanged "+e,"RaviStreamController")},this._onInputAudioChanged=null,this._onInputVideoChanged=null}getVideoStream(){return this._videoStream}_setVideoStream(e){this._videoStream=e,this._videoContainer&&(this._videoContainer.srcObject=this._videoStream)}setVideoContainer(e,t){this._videoContainer=e,this._videoStream&&(this._videoContainer.srcObject=this._videoStream),this.setVideoStateChangeHandler(t)}setVideoStateChangeHandler(e){e&&(this._onVideoStreamStateChanged=e)}showVideoDashboard(e){this._commandController.queueCommand("video.showDashboard",{enabled:e},null)}showVideoCursor(e){this._commandController.queueCommand("video.showCursor",{enabled:e},null)}getAudioStream(){return this._audioStream}_setAudioStream(e){this._audioStream=e,this._audioContainer&&(this._audioContainer.srcObject=this._audioStream)}setAudioContainer(e){this._audioContainer=e,this._audioStream&&(this._audioContainer.srcObject=this._audioStream)}setInputAudio(e,t=!1){this._inputAudioStream=e,this._isStereo=t,this._onInputAudioChanged&&this._onInputAudioChanged(e)}setInputAudioChangeHandler(e){e&&(this._onInputAudioChanged=e)}setInputVideo(e){this._inputVideoStream=e,this._onInputVideoChanged&&this._onInputVideoChanged(e)}setInputVideoChangeHandler(e){e&&(this._onInputVideoChanged=e)}isStereoInput(){return this._isStereo}_stop(){S.log("stopping streams","RaviStreamController"),this._videoContainer&&this._videoContainer.srcObject&&(this._videoContainer.srcObject.getTracks().forEach((e=>e.stop())),this._videoContainer.srcObject=null,this._onVideoStreamStateChanged("over")),this._audioStream&&(this._audioStream.getTracks().forEach((e=>e.stop())),this._audioStream=null)}}const A="_BINARY";var T;!function(e){e[e.ControlLeft=0]="ControlLeft",e[e.AltLeft=1]="AltLeft",e[e.OSLeft=2]="OSLeft",e[e.Space=3]="Space",e[e.OSRight=4]="OSRight",e[e.AltRight=5]="AltRight",e[e.ControlRight=6]="ControlRight",e[e.ShiftLeft=7]="ShiftLeft",e[e.ShiftRight=8]="ShiftRight",e[e.Comma=9]="Comma",e[e.Period=10]="Period",e[e.Slash=11]="Slash",e[e.CapsLock=12]="CapsLock",e[e.Enter=13]="Enter",e[e.Semicolon=14]="Semicolon",e[e.Quote=15]="Quote",e[e.Tab=16]="Tab",e[e.BracketLeft=17]="BracketLeft",e[e.BracketRight=18]="BracketRight",e[e.Backslash=19]="Backslash",e[e.Backquote=20]="Backquote",e[e.Minus=21]="Minus",e[e.Equal=22]="Equal",e[e.Digit0=23]="Digit0",e[e.Digit1=24]="Digit1",e[e.Digit2=25]="Digit2",e[e.Digit3=26]="Digit3",e[e.Digit4=27]="Digit4",e[e.Digit5=28]="Digit5",e[e.Digit6=29]="Digit6",e[e.Digit7=30]="Digit7",e[e.Digit8=31]="Digit8",e[e.Digit9=32]="Digit9",e[e.Backspace=33]="Backspace",e[e.Escape=34]="Escape",e[e.ArrowLeft=35]="ArrowLeft",e[e.ArrowRight=36]="ArrowRight",e[e.ArrowDown=37]="ArrowDown",e[e.ArrowUp=38]="ArrowUp",e[e.PageDown=39]="PageDown",e[e.PageUp=40]="PageUp",e[e.End=41]="End",e[e.Home=42]="Home",e[e.Delete=43]="Delete",e[e.Insert=44]="Insert",e[e.Numpad0=45]="Numpad0",e[e.Numpad1=46]="Numpad1",e[e.Numpad2=47]="Numpad2",e[e.Numpad3=48]="Numpad3",e[e.Numpad4=49]="Numpad4",e[e.Numpad5=50]="Numpad5",e[e.Numpad6=51]="Numpad6",e[e.Numpad7=52]="Numpad7",e[e.Numpad8=53]="Numpad8",e[e.Numpad9=54]="Numpad9",e[e.NumpadDecimal=55]="NumpadDecimal",e[e.NumpadEnter=56]="NumpadEnter",e[e.NumpadAdd=57]="NumpadAdd",e[e.NumpadSubtract=58]="NumpadSubtract",e[e.NumLock=59]="NumLock",e[e.NumpadEqual=60]="NumpadEqual",e[e.NumpadMultiply=61]="NumpadMultiply",e[e.NumpadDivide=62]="NumpadDivide",e[e.KeyA=63]="KeyA",e[e.KeyB=64]="KeyB",e[e.KeyC=65]="KeyC",e[e.KeyD=66]="KeyD",e[e.KeyE=67]="KeyE",e[e.KeyF=68]="KeyF",e[e.KeyG=69]="KeyG",e[e.KeyH=70]="KeyH",e[e.KeyI=71]="KeyI",e[e.KeyJ=72]="KeyJ",e[e.KeyK=73]="KeyK",e[e.KeyL=74]="KeyL",e[e.KeyM=75]="KeyM",e[e.KeyN=76]="KeyN",e[e.KeyO=77]="KeyO",e[e.KeyP=78]="KeyP",e[e.KeyQ=79]="KeyQ",e[e.KeyR=80]="KeyR",e[e.KeyS=81]="KeyS",e[e.KeyT=82]="KeyT",e[e.KeyU=83]="KeyU",e[e.KeyV=84]="KeyV",e[e.KeyW=85]="KeyW",e[e.KeyX=86]="KeyX",e[e.KeyY=87]="KeyY",e[e.KeyZ=88]="KeyZ"}(T||(T={}));class R{constructor(){S.log("constructor","RaviCommandController"),this._commandQueueMap=new Map,this._numQueuedCommands=0,this._commandQueueInterval=1e3,this._commandPumpTimer=null,this._inputTarget,this._keyboardTarget,this._mouseStateBuffer=new ArrayBuffer(32),this._mouseStateUint8=new Uint8Array(this._mouseStateBuffer),this._mouseStateUint8[0]=77,this._mouseStateFloat=new Float32Array(this._mouseStateBuffer,4),this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._keyboardStateBuffer=new ArrayBuffer(13),this._keyboardState=new Uint8Array(this._keyboardStateBuffer),this._keyboardState[0]=75}setCommandQueueInterval(e){this._commandQueueInterval=e,this._commandPumpTimer&&(this.stopMonitoringQueues(),this.monitorQueues())}queueCommand(e,t,i){var n=this._commandQueueMap.get(e);n||(n={toSend:[],listener:[]},this._commandQueueMap.set(e,n));var a=null;i&&(a=new D(i,!1,!0)),n.toSend.push(new I(e,t,a)),this._numQueuedCommands++,S.log("Added command "+e,"RaviCommandController")}queueBinaryCommand(e){let t=A;var i=this._commandQueueMap.get(t);i||(i={toSend:[],listener:[]},this._commandQueueMap.set(t,i)),i.toSend.push(new I(e,null,null)),this._numQueuedCommands++,S.log("Added binary command","RaviCommandController")}addMessageHandler(e,t,i){var n=this._commandQueueMap.get(e);n||(n={toSend:[],listener:[]},this._commandQueueMap.set(e,n));var a=new D(t,i,!1);n.listener.push(a)}addBinaryHandler(e,t){this.addMessageHandler(A,e,t)}sendInput(e){this._inputDataChannel&&"open"===this._inputDataChannel.readyState&&this._inputDataChannel.send(e)}monitorQueues(){S.log("Begin monitoring for queued commands","RaviCommandController"),this._commandPumpTimer=setInterval(this._processSendingQueuedCommands.bind(this),this._commandQueueInterval)}stopMonitoringQueues(){S.log("Stop monitoring for queued commands","RaviCommandController"),clearInterval(this._commandPumpTimer),this._commandPumpTimer=null}_processSendingQueuedCommands(){this._numQueuedCommands<=0||this._commandQueueMap.forEach(function(e,t,i){if(e.toSend.length){var n=e.toSend.shift();n._handler&&e.listener.push(n._handler),this._sendCommandInstance(n)?this._numQueuedCommands--:S.log("Send failed. CommandDataChannel may have been disconnected. Will not retry.","RaviCommandController")}}.bind(this))}_serializeJsonCommandMessageToSend(e,t){return JSON.stringify({c:e,p:t})}_unserializeJsonCommandMessageFromReceived(e){let t;try{t=JSON.parse(e)}catch(t){return void S.err(`Couldn't parse command message! Error:\n${t}\n Full message contents:\n${e}`,"RaviCommandController")}return t&&t.c&&t.p?{command:t.c,payload:t.p}:(S.err("Message cannot be unserialized into a CommandMessage: "+e,"RaviCommandController"),null)}_sendCommandInstance(e){try{let t=e._command;return"string"==typeof t?(t=this._serializeJsonCommandMessageToSend(e._command,e._param),S.log("Sending command "+t,"RaviCommandController")):S.log("Sending binary command","RaviCommandController"),this._commandDataChannel.send(t),!0}catch(e){return S.err("Received error while sending: "+e.message,"RaviCommandController"),!1}}_processListeningCommand(e){let t=e.data,i=null;t&&("string"==typeof t?(i=this._unserializeJsonCommandMessageFromReceived(t),this._continueProcessingListeningCommand(i)):t instanceof ArrayBuffer?(i={command:A,payload:new Uint8Array(t)},this._continueProcessingListeningCommand(i)):t instanceof Blob&&t.arrayBuffer().then((e=>{i={command:A,payload:new Uint8Array(e)},this._continueProcessingListeningCommand(i)})))}_continueProcessingListeningCommand(e){if(e){var t=this._commandQueueMap.get(e.command);if(t){var i=t.listener.length;if(i>0)if(t.listener[0]&&t.listener[0]._hasMatchingSentCommand){var n=t.listener.shift();if(n&&n._handler)return void n._handler(e.payload);S.err("Undefined command handler: "+e,"RaviCommandController")}else{for(var a=[],o=0;o<i;o++){var s=t.listener[o];s&&s._handler?s._handler(e.payload):S.err("Undefined message handler: "+e,"RaviCommandController"),s&&s._isSticky&&a.push(s)}t.listener=a}}}else S.err("Received invalid command message, ignoring: "+JSON.stringify(e),"RaviCommandController")}_setInputDataChannel(e){this._inputDataChannel=e,S.log("Received new input data channel with id "+this._inputDataChannel.id,"RaviCommandController"),this._inputDataChannel.onopen=function(){S.log("_inputDataChannel onopen, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onclose=function(){S.log("_inputDataChannel onclose, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onmessage=function(e){S.log("_inputDataChannel got message: "+e.data,"RaviCommandController")}.bind(this)}_setCommandDataChannel(e){this._commandDataChannel=e,S.log("Received new data channel with id "+this._commandDataChannel.id,"RaviCommandController"),this._commandDataChannel.onopen=function(){S.log("_commandDataChannel ononpen, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.monitorQueues()}.bind(this),this._commandDataChannel.onclose=function(){S.log("_commandDataChannel onclose, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.stopMonitoringQueues()}.bind(this),this._commandDataChannel.onmessage=function(e){this._processListeningCommand(e)}.bind(this)}setInputTarget(e){if(this._inputTarget&&(this._inputTarget.onmousemove=null,this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=null,this._inputTarget.onmouseup=null,this._inputTarget.onwheel=null),this._inputTarget=e,this._inputTarget){var t=this;this._inputTarget.onmousemove=function(e){t._trackMouse(e)},this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=function(e){t._captureMouseDown(e)},this._inputTarget.onmouseup=function(e){t._resetMouseDown(e)},this._inputTarget.onwheel=function(e){t._wheelMouse(e)}}}setKeyboardTarget(e){if(this._keyboardTarget&&(this._keyboardTarget.onkeydown=null,this._keyboardTarget.onkeyup=null),this._keyboardTarget=e,this._keyboardTarget){var t=this;this._keyboardTarget.onkeydown=function(e){t._onKeyboardDown(e)},this._keyboardTarget.onkeyup=function(e){t._onKeyboardUp(e)}}}_captureMouseDown(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[2]=e.offsetX,this._mouseStateFloat[3]=e.offsetY,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_resetMouseDown(e){this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_trackMouse(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[4]=this._inputTarget.offsetWidth,this._mouseStateFloat[5]=this._inputTarget.offsetHeight,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_wheelMouse(e){this._mouseStateFloat[6]=e.deltaY,this._sendMouseState(),this._mouseStateFloat[6]=0}_sendMouseState(){this.sendInput(this._mouseStateBuffer)}_keyByteNum(e){return e>>3}_keyBitMask(e){return 1<<e%8}_onKeyboardDown(e){let t=T[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0==(this._keyboardState[i]&n)&&(this._keyboardState[i]|=n,this._sendKeyboardState())}_onKeyboardUp(e){let t=T[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0!=(this._keyboardState[i]&n)&&(this._keyboardState[i]^=n,this._sendKeyboardState())}_sendKeyboardState(){this.sendInput(this._keyboardStateBuffer)}}class I{constructor(e,t,i){S.log("constructor","RaviCommandInstance"),this._command=e,this._param=t,this._handler=i}}class D{constructor(e,t,i){S.log("constructor","RaviCommandHandlerInstance"),this._handler=e,this._isSticky=t,this._hasMatchingSentCommand=i}}var k,x=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.NEW="new",e.CONNECTING="checking",e.CONNECTED="connected",e.COMPLETED="completed",e.DISCONNECTED="disconnected",e.FAILED="failed",e.CLOSED="closed"}(k||(k={}));class E{constructor(){this._stateChangeHandlers=new Set,this._uuid=S.createUUID(),this._commandController=new R,this._streamController=new y(this._commandController),this._state=k.CLOSED,this._raviImplementation=new N(this);const e=this._raviImplementation;this._streamController.setInputAudioChangeHandler(e._addAudioInputStream.bind(e)),this._streamController.setInputVideoChangeHandler(e._addVideoInputStream.bind(e))}getState(){return this._state}getUUID(){return this._uuid}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return S.err("Error adding a state change handler: "+e.message,"RaviSession"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return S.err("Error removing a state change handler: "+e.message,"RaviSession"),!1}return!1}getCommandController(){return this._commandController}getStreamController(){return this._streamController}openRAVISession({signalingConnection:e,timeout:t=5e3,params:i=null,customStunAndTurn:n=null}){if(this._state===k.CONNECTED||this._state===k.COMPLETED)return Promise.resolve("There is already an open RAVI session. To reconnect, first close the existing connection, and then attempt to open again.");var a=this;return this._raviImplementation._assignSignalingConnection(e),this._openingTimeout=setTimeout((()=>{let e="RaviSession.open timed out after "+t+" ms";S.log(e,"RaviSession"),a._fulfillPromises({message:e},k.FAILED),a.closeRAVISession()}),t),new Promise(((e,t)=>{a._resolveOpen=e,a._rejectOpen=t,S.log("Opening RAVI session","RaviSession"),this._state=k.NEW,a._raviImplementation._open(i,n)}))}closeRAVISession(){var e=this;return this._state===k.CLOSED?Promise.resolve("RAVI session is already closed."):(this._streamController._stop(),this._commandController.stopMonitoringQueues(),new Promise(((t,i)=>{e._resolveClose=t,e._rejectClose=i,S.log("Closing RAVI session","RaviSession"),e._raviImplementation._close()})))}_fulfillPromises(e={},t){let i=e.reason||e.message||t;switch(t){case k.CONNECTED:case k.COMPLETED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._resolveOpen&&this._resolveOpen(),this._rejectClose&&this._rejectClose(i);break;case k.DISCONNECTED:S.log("_fulfillPromises: Possible transitory state DISCONNECTED; leaving promises pending","RaviSession");break;case k.FAILED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._rejectOpen&&this._rejectOpen(i),this._rejectClose&&this._rejectClose(i);let e=this;setTimeout((()=>{e._raviImplementation._close()}),0);break;case k.CLOSED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;default:S.log("_fulfillPromises: Skipping in-progress state "+t,"RaviSession")}}_doOntrack(e){S.log("Received new track: ","RaviSession"),S.log(e,"RaviSession"),e&&e.track&&"video"===e.track.kind&&(S.log("Adding remote video track to stream controller","RaviSession"),this._streamController._setVideoStream(e.streams[0]),this._streamController._onVideoStreamStateChanged("ready")),e&&e.track&&"audio"===e.track.kind&&(S.log("Adding remote audio track to stream controller","RaviSession"),this._streamController._setAudioStream(e.streams[0]))}_doOndatachannel(e){switch(S.log("Received new channel: ","RaviSession"),S.log(e,"RaviSession"),e.channel.label){case"ravi.input":this._commandController._setInputDataChannel(e.channel);break;case"ravi.command":this._commandController._setCommandDataChannel(e.channel);break;default:S.log("Received unknown data channel named "+e.channel.label,"RaviSession")}}_handleStateChange(e={},t){e.state=t,this._fulfillPromises(e,t),t!==this._state&&(this._state=t,e.state=t,S.log("_handleStateChange: "+S.safelyPrintable(e),"RaviSession"),this._stateChangeHandlers.forEach((function(t){t&&t(e)})))}addStatsObserver(e){return this._raviImplementation._addStatsObserver(e)}removeStatsObserver(e){return this._raviImplementation._removeStatsObserver(e)}}const M=new Map([["remote-inbound-rtp",["id","type","timestamp","roundTripTime","jitter"]],["inbound-rtp",["id","type","timestamp","jitterBufferDelay","jitterBufferEmittedCount","bytesReceived"]]]);class F{constructor(e){S.log("constructor","RaviStatsWatcher"),this._raviImplementation=e,this._observers=new Set,this._filter=M,this._interval=0,this._prevStats=[]}stop(){this._interval&&(clearInterval(this._interval),this._interval=0)}addObserver(e){try{return this._observers.add(e),this._onObserverChange(),!0}catch(e){return S.err("Error adding a stats observer: "+e.message,"RaviStatsWatcher"),!1}return!1}removeObserver(e){try{return this._observers.delete(e),this._onObserverChange(),!0}catch(e){return S.err("Error removing a stats observer handler: "+e.message,"RaviSession"),!1}return!1}_onObserverChange(){this._prevStats=[],this._observers.size>0?this._interval||setInterval(((e,t)=>x(this,void 0,void 0,(function*(){const e=yield this._raviImplementation._getStats();let t=[];e&&e.forEach((e=>{if(this._filter.has(e.type)){let i=this._filter.get(e.type),n={};i.forEach((t=>{n[t]=e[t]})),t.push(n)}})),t.length&&this._observers.forEach((e=>{e(t,this._prevStats)})),this._prevStats=t}))),1e3):this._interval&&(clearInterval(this._interval),this._interval=0)}}let O=null,U=null;"undefined"==typeof self?(O=i(326).I$,U=i(326).Ao):(O=RTCPeerConnection,U=RTCSessionDescription);const z={urls:["stun:stun.l.google.com:19302"]};let P={iceServers:[z,{urls:["turn:turn.highfidelity.com:3478"],username:"clouduser",credential:"chariot-travesty-hook"}]};class N{constructor(e){S.log("constructor","RaviWebRTCImplementation"),this._raviSession=e,this._negotiator=this._setupConnection.bind(this),this._statsWatcher=new F(this),this._raviAudioSenders=[],this._raviVideoSenders=[]}_initRtcConnection(){const e=this._raviSession,t=this;this._rtcConnection=new O(P);const i=this._rtcConnection;i.getSenders().forEach((e=>{e.replaceTrack(null)})),this._raviAudioSenders=[],this._raviVideoSenders=[],i.addEventListener("iceconnectionstatechange",(function(n){"connected"!==i.iceConnectionState&&"completed"!=i.iceConnectionState||(S.log("Session has fully connected; removing short-circuit handler","RaviWebRTCImplementation"),t._signalingConnection.removeStateChangeHandler(t._shortCircuitHandler)),e._handleStateChange(n,i.iceConnectionState)})),i.addEventListener("datachannel",(function(t){e._doOndatachannel(t)})),i.addEventListener("track",(function(t){e._doOntrack(t)})),i.addEventListener("icecandidate",(function(e){t._doOnicecandidate(e)})),i.addEventListener("negotiationneeded",(function(e){t._doOnnegotiationneeded(e)})),i.addEventListener("signalingstatechange",(function(e){t._doOnsignalingstatechanged(e)}))}_assignSignalingConnection(e){this._signalingConnection=e}_addAudioInputStream(e){const t=this._rtcConnection;if(e){if(this._audioInputStream=e,!t)return S.log("Setting audio input stream without available RTC connection; will store it until ready","RaviWebRTCImplementation"),!0;const i=this._raviAudioSenders,n=e.getAudioTracks(),a=n.length;let o=0;for(;o<i.length;o++)o<a?(S.log("Replacing audio track #"+o+"  in rtcConnection","RaviWebRTCImplementation"),i[o].replaceTrack(n[o])):(S.log("Setting audio sender #"+o+" to null","RaviWebRTCImplementation"),i[o].replaceTrack(null));for(;o<a;o++)S.log("Adding local audio track #"+o+" to rtcConnection","RaviWebRTCImplementation"),i.push(t.addTrack(n[o],e))}else{const e=this._raviAudioSenders;let t=0;for(;t<e.length;t++)S.log("Setting audio sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return!1}_addVideoInputStream(e){const t=this._rtcConnection;var i=!1;if(e){if(this._videoInputStream=e,!t)return S.log("Setting video input stream without available RTC connection; will store it until ready","RaviWebRTCImplementation"),!0;const n=this._raviVideoSenders,a=e.getVideoTracks();a.length>0?(n.length>0?(S.log("Replacing video track #0 in rtcConnection","RaviWebRTCImplementation"),n[0].replaceTrack(a[0])):(S.log("Adding video track #0 to rtcConnection","RaviWebRTCImplementation"),n.push(t.addTrack(a[0]))),i=!0):S.log("Assigned video stream doesn't contain vidoe track","RaviWebRTCImplementation")}else{const e=this._raviVideoSenders;let t=0;for(;t<e.length;t++)S.log("Setting video sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return i}_open(e,t){if(S.log("Attempting to open connection...","RaviWebRTCImplementation"),this._customStunAndTurn=t,this._rtcConnection&&("connecting"==this._rtcConnection.connectionState||"connected"==this._rtcConnection.connectionState))return S.log("We already have a connection in progress. Will not attempt a new one.","RaviWebRTCImplementation"),void this._raviSession._handleStateChange({state:this._rtcConnection.connectionState},this._rtcConnection.connectionState);if(this._signalingConnection){this._signalingConnection.addMessageHandler(this._negotiator),this._shortCircuitHandler=this._cancelOpeningProcessOnSignalingDisconnect.bind(this),this._signalingConnection.addStateChangeHandler(this._shortCircuitHandler);let t={};e?(t=e,t.sessionID=this._raviSession.getUUID()):t=this._raviSession.getUUID(),this._signalingConnection.send(JSON.stringify({request:t}))}}_cancelOpeningProcessOnSignalingDisconnect(e){let t=e.state||"unknown";const i=this._raviSession;switch(t){case p.CLOSED:S.log("Signaling state closed before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,k.CLOSED),this._close();break;case p.ERROR:S.log("Signaling state errored out before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,k.FAILED),this._close();break;case p.UNAVAILABLE:S.log("Signaling state reached 'unavailable' before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,k.FAILED),this._close();break;default:S.log("Signaling state has changed during opening of RAVI session, but is an OK change. New state: "+t,"RaviWebRTCImplementation")}}_close(){this._statsWatcher.stop();const e=this._raviSession;S.log("closing","RaviWebRTCImplementation"),this._rtcConnection&&this._rtcConnection.close(),this._signalingConnection.removeMessageHandler(this._negotiator),this._signalingConnection.removeStateChangeHandler(this._shortCircuitHandler),this._rtcConnection=null,e._handleStateChange({},k.CLOSED)}_doOnicecandidate(e){e.candidate&&""!=e.candidate?(S.log("Sending local ICE candidate: "+JSON.stringify(e.candidate),"RaviWebRTCImplementation"),this._signalingConnection.send(JSON.stringify({ice:e.candidate,uuid:this._raviSession.getUUID()}))):S.log("End of local ICE candidates","RaviSession")}_doOnnegotiationneeded(e){S.log("need renegotiation please","RaviWebRTCImplementation");const t={renegotiate:"please",uuid:this._raviSession.getUUID()},i=JSON.stringify(t);this._signalingConnection&&this._rtcConnection&&"stable"===this._rtcConnection.signalingState&&this._signalingConnection.send(i)}_doOnsignalingstatechanged(e){this._rtcConnection&&S.log("SignalingState changed: "+this._rtcConnection.signalingState,"RaviWebRTCImplementation")}_forceBitrateUp(e){const t=this._raviSession._streamController.isStereoInput()?128e3:64e3;return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate="+t+";")}_forceStereoDown(e){return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate=128000;sprop-stereo=1;stereo=1;")}_setupConnection(e){let t="",i="";const n=this._raviSession,a=this._signalingConnection,o=this;if(n&&a)if(e&&e.data){if(S.log("Message from server: "+e.data,"RaviWebRTCImplementation"),t=JSON.parse(e.data),i=t[n.getUUID()],i)if(i.sdp){if(S.log("Received sdp type="+i.type,"RaviWebRTCImplementation"),o._customStunAndTurn){const e={urls:o._customStunAndTurn.turnUrls,username:o._customStunAndTurn.turnUsername,credential:o._customStunAndTurn.turnCredential},t={urls:o._customStunAndTurn.stunUrls};P={iceServers:[t,e]}}else if(i.turn&&i.turn.urls&&i.turn.username&&i.turn.credential){const e={urls:i.turn.urls,username:i.turn.username,credential:i.turn.credential};P={iceServers:[z,e]}}this._rtcConnection||(this._initRtcConnection(),this._audioInputStream&&this._addAudioInputStream(this._audioInputStream),this._videoInputStream&&this._addVideoInputStream(this._videoInputStream));let e=this._rtcConnection;i.sdp=o._forceBitrateUp(i.sdp);const t=new U(i);e.setRemoteDescription(t).then((function(){return e.createAnswer()})).then((function(t){return t.sdp=o._forceStereoDown(t.sdp),S.log("Answer:","RaviWebRTCImplementation"),S.log(t,"RaviWebRTCImplementation"),e.setLocalDescription(t)})).then((function(){const t={type:"answer",sdp:e.localDescription,uuid:n.getUUID()},i=JSON.stringify(t);S.log("Sending answer to server","RaviWebRTCImplementation"),a.send(i)}))}else i.ice?(S.log("Received remote ICE candidate: "+JSON.stringify(i.ice),"RaviWebRTCImplementation"),this._rtcConnection?this._rtcConnection.addIceCandidate(i.ice).then((function(){S.log("Added remote candidate","RaviWebRTCImplementation")})).catch((function(e){S.err("Error attempting to add remote ICE candidate: "+e.message,"RaviWebRTCImplementation")})):S.log("Ignore ice candidate until we have an rtcConnection, ice='"+JSON.stringify(i)+"'","RaviWebRTCImplementation")):S.log("Unknown message "+JSON.stringify(i),"RaviWebRTCImplementation")}else S.log("No message received by onMessage handler","RaviWebRTCImplementation");else S.err("Missing one of raviSession or signalingConnection! Can't set up connection.","RaviWebRTCImplementation")}_addStatsObserver(e){return this._statsWatcher.addObserver(e)}_removeStatsObserver(e){return this._statsWatcher.removeObserver(e)}_getStats(e=null){return x(this,void 0,void 0,(function*(){return this._rtcConnection?this._rtcConnection.getStats(e):[]}))}}var H=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))};const L="undefined"!=typeof window,B=e=>{},V=L?window.localStorage:{getItem:B,setItem:B,removeItem:B},W=L?window.addEventListener:B,j=L?window.removeEventListener:B,K=L?window.document:{visibilityState:!0,addEventListener:B,removeEventListener:B},Z=L?window.navigator:{onLine:!0,userAgent:`NodeJS ${process.report.getReport().header.nodejsVersion}`};let $=L&&window.fetch;if(!L)try{$=i(300)}catch(e){}const q="non-operative";M.set("remote-inbound-rtp",M.get("remote-inbound-rtp").concat(["packetsLost","totalRoundTripTime"])),M.set("inbound-rtp",M.get("inbound-rtp").concat(["packetsLost","packetsReceived","jitter"])),M.set("outbound-rtp",["type","retransmittedPacketsSent","packetsSent"]),M.set("candidate-pair",["writable","state","nominated","localCandidateId","remoteCandidateId"]),M.set("remote-candidate",["id","address","ip","candidateType","protocol"]),M.set("local-candidate",["id","address","ip","candidateType","protocol"]);let Q=0,G={},J={},Y={"outbound-rtp":{},"inbound-rtp":{},"remote-inbound-rtp":{}};const X="directSend";class ee{constructor({url:e="https://webrtc-diag.highfidelity.com/api/v1/logs/post_logs",label:t,session:i,ravi:n,fireOn:a=[]}){Object.assign(this,{url:e,label:t,session:i,ravi:n,fireOn:a}),this.checkPersisted(),this.reset(),this.fireListener=()=>this.fire(),this.onlineListener=()=>this.checkPersisted()}prime(e){this.isPrimed()||(this.checkPersisted(),this.identifier=e,this.grabRTCInternals(),ee.startStats(this.session),this.fireOn.forEach((e=>K.addEventListener(e,this.fireListener))))}fire(){return H(this,void 0,void 0,(function*(){if(!this.isPrimed())return;const e=this.toString();this.reset(),this.persist(e,"preemptive",!1),(yield this.report(e))?V.removeItem(this.label):this.persist(e,"failed")}))}noteExplicitApplicationClose(){this.explicitApplicationClose=!0}reset(){ee.stopStats(this.session),this.identifier=q,this.explicitApplicationClose=!1,this.webSocket=this.rtc={},this.fireOn.forEach((e=>K.removeEventListener(e,this.fireListener)))}isPrimed(){return this.identifier!==q}toString(){return`${(new Date).toISOString()} ${this.identifier} `+this.s("logReason","sessionEND")+this.connectionStats("browserStats")+this.connectionStats("mixerStats")+this.rtpStats()+this.rtcStates()+this.s("NUM_CONNECTED",this.session.concurrency,"\n")+this.s("APPSTATE",this.session.getCurrentHiFiConnectionState(),"\n")+this.s("RAVISTATE",this.ravi.getState())+this.s("ONLINE",Z.onLine?"yes":"no")+this.s("XPLICITCLOSED",this.explicitApplicationClose?"yes":"no")+this.visibilityInfo()+this.connectionInfo()+this.s("PERSISTENCE",X)+` [${Z.userAgent}]`}s(e,t,i=""){let n=isNaN(t)?"_":":";return` ${this.label}${e}${n}${t}`}connectionInfo(){const e=Z.connection||Z.mozConnection||Z.webkitConnection||{};return this.s("DEVICE",e.type,"\n")+this.s("RATING",e.effectiveType)+this.s("DL",e.downlink)+this.s("RTT",e.rtt)}visibilityInfo(){return this.s("VISIBLITY",K.visibilityState)}grabRTCInternals(){let e=this.ravi._raviImplementation,t=e._signalingConnection._signalingImplementation;this.webSocket=t._webSocket,this.rtc=e._rtcConnection}rtcStates(){let e={},t=(t,i=this.rtc)=>{try{e[t]=i[t]}catch(i){e[t]=i.name}};return t("readyState",this.webSocket),["connectionState","signalingState","iceConnectionState","iceGatheringState"].forEach((e=>t(e))),this.s("WebSocket",e.readyState,"\n")+this.s("RTC",e.connectionState)+this.s("SIGNALING",e.signalingState)+this.s("ICE",e.iceConnectionState)+this.s("GATHERING",e.iceGatheringState)}connectionStats(e){let t="browserStats"===e?G:J;return t?this.s(e+"IP",t.ip||t.address,"\n")+this.s(e+"TYPE",t.candidateType)+this.s(e+"PROTOCOL",t.protocol):""}rtpStats(){let e="";return Object.keys(Y).forEach((t=>{let i=Y[t],n=!0;Object.keys(i).forEach((a=>{e+=this.s(`${t}_${a}`,i[a],n?"\n":""),n=!1}))})),e}report(e){return!!Z.onLine&&!!$&&(console.log(e),$(this.url,{method:"POST",headers:{"Content-Type":"text/plain"},body:e}).then((e=>e.ok)))}persist(e,t,i=!0){let n=V.getItem(this.label)||"";n&&(n+="\n"),e=e.replace(X,t),V.setItem(this.label,n+e),i&&W("online",this.onlineListener)}checkPersisted(){return H(this,void 0,void 0,(function*(){j("online",this.onlineListener);let e=V.getItem(this.label);e&&(yield this.report(e))&&V.removeItem(this.label)}))}static startStats(e){Q++>0||e.startCollectingWebRTCStats(((e,t)=>{let i=e.find((e=>e.writable||e.nominated));if(!i)return;let n=e.find((e=>e.id===i.localCandidateId)),a=e.find((e=>e.id===i.remoteCandidateId));function o(i,n,a=[]){function o(e){return e.find((e=>e.type==i))}let s=o(t),r=o(e);n.forEach((e=>Y[i][e]=r&&r[e]-(s?s[e]:0))),a.forEach((e=>Y[i][e]=r&&r[e]))}n&&(G=n),a&&(J=a),o("outbound-rtp",["retransmittedPacketsSent","packetsSent"]),o("inbound-rtp",["packetsLost","packetsReceived"],["jitter"]),o("remote-inbound-rtp",["packetsLost"],["roundTripTime","totalRoundTripTime","jitter"])}))}static stopStats(e){if(Q&&!(--Q>0)){e.stopCollectingWebRTCStats(),G=J={};for(let e in Y)Y[e]={}}}}function te(e){let t=e.length;for(;--t>=0;)e[t]=0}const ie=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ne=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ae=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),oe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),se=new Array(576);te(se);const re=new Array(60);te(re);const le=new Array(512);te(le);const de=new Array(256);te(de);const ce=new Array(29);te(ce);const he=new Array(30);function ue(e,t,i,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let _e,me,ge;function fe(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}te(he);const pe=e=>e<256?le[e]:le[256+(e>>>7)],ve=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Se=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,ve(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},be=(e,t,i)=>{Se(e,i[2*t],i[2*t+1])},Ce=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},we=(e,t,i)=>{const n=new Array(16);let a,o,s=0;for(a=1;a<=15;a++)n[a]=s=s+i[a-1]<<1;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=Ce(n[t]++,t))}},ye=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Ae=e=>{e.bi_valid>8?ve(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Te=(e,t,i,n)=>{const a=2*t,o=2*i;return e[a]<e[o]||e[a]===e[o]&&n[t]<=n[i]},Re=(e,t,i)=>{const n=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&Te(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Te(t,n,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=n},Ie=(e,t,i)=>{let n,a,o,s,r=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],a=e.pending_buf[e.l_buf+r],r++,0===n?be(e,a,t):(o=de[a],be(e,o+256+1,t),s=ie[o],0!==s&&(a-=ce[o],Se(e,a,s)),n--,o=pe(n),be(e,o,i),s=ne[o],0!==s&&(n-=he[o],Se(e,n,s)))}while(r<e.last_lit);be(e,256,t)},De=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,r,l,d=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==i[2*s]?(e.heap[++e.heap_len]=d=s,e.depth[s]=0):i[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=n[2*l+1]);for(t.max_code=d,s=e.heap_len>>1;s>=1;s--)Re(e,i,s);l=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Re(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=r,i[2*l]=i[2*s]+i[2*r],e.depth[l]=(e.depth[s]>=e.depth[r]?e.depth[s]:e.depth[r])+1,i[2*s+1]=i[2*r+1]=l,e.heap[1]=l++,Re(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,r=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,c,h,u,_,m,g=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(i[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],u=i[2*i[2*c+1]+1]+1,u>l&&(u=l,g++),i[2*c+1]=u,c>n||(e.bl_count[u]++,_=0,c>=r&&(_=s[c-r]),m=i[2*c],e.opt_len+=m*(u+_),o&&(e.static_len+=m*(a[2*c+1]+_)));if(0!==g){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(u=l;0!==u;u--)for(c=e.bl_count[u];0!==c;)h=e.heap[--d],h>n||(i[2*h+1]!==u&&(e.opt_len+=(u-i[2*h+1])*i[2*h],i[2*h+1]=u),c--)}})(e,t),we(i,d,e.bl_count)},ke=(e,t,i)=>{let n,a,o=-1,s=t[1],r=0,l=7,d=4;for(0===s&&(l=138,d=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)a=s,s=t[2*(n+1)+1],++r<l&&a===s||(r<d?e.bl_tree[2*a]+=r:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,o=a,0===s?(l=138,d=3):a===s?(l=6,d=3):(l=7,d=4))},xe=(e,t,i)=>{let n,a,o=-1,s=t[1],r=0,l=7,d=4;for(0===s&&(l=138,d=3),n=0;n<=i;n++)if(a=s,s=t[2*(n+1)+1],!(++r<l&&a===s)){if(r<d)do{be(e,a,e.bl_tree)}while(0!=--r);else 0!==a?(a!==o&&(be(e,a,e.bl_tree),r--),be(e,16,e.bl_tree),Se(e,r-3,2)):r<=10?(be(e,17,e.bl_tree),Se(e,r-3,3)):(be(e,18,e.bl_tree),Se(e,r-11,7));r=0,o=a,0===s?(l=138,d=3):a===s?(l=6,d=3):(l=7,d=4)}};let Ee=!1;const Me=(e,t,i,n)=>{Se(e,0+(n?1:0),3),((e,t,i,n)=>{Ae(e),ve(e,i),ve(e,~i),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i)};var Fe={_tr_init:e=>{Ee||((()=>{let e,t,i,n,a;const o=new Array(16);for(i=0,n=0;n<28;n++)for(ce[n]=i,e=0;e<1<<ie[n];e++)de[i++]=n;for(de[i-1]=n,a=0,n=0;n<16;n++)for(he[n]=a,e=0;e<1<<ne[n];e++)le[a++]=n;for(a>>=7;n<30;n++)for(he[n]=a<<7,e=0;e<1<<ne[n]-7;e++)le[256+a++]=n;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)se[2*e+1]=8,e++,o[8]++;for(;e<=255;)se[2*e+1]=9,e++,o[9]++;for(;e<=279;)se[2*e+1]=7,e++,o[7]++;for(;e<=287;)se[2*e+1]=8,e++,o[8]++;for(we(se,287,o),e=0;e<30;e++)re[2*e+1]=5,re[2*e]=Ce(e,5);_e=new ue(se,ie,257,286,15),me=new ue(re,ne,0,30,15),ge=new ue(new Array(0),ae,0,19,7)})(),Ee=!0),e.l_desc=new fe(e.dyn_ltree,_e),e.d_desc=new fe(e.dyn_dtree,me),e.bl_desc=new fe(e.bl_tree,ge),e.bi_buf=0,e.bi_valid=0,ye(e)},_tr_stored_block:Me,_tr_flush_block:(e,t,i,n)=>{let a,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),De(e,e.l_desc),De(e,e.d_desc),s=(e=>{let t;for(ke(e,e.dyn_ltree,e.l_desc.max_code),ke(e,e.dyn_dtree,e.d_desc.max_code),De(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*oe[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=a&&(a=o)):a=o=i+5,i+4<=a&&-1!==t?Me(e,t,i,n):4===e.strategy||o===a?(Se(e,2+(n?1:0),3),Ie(e,se,re)):(Se(e,4+(n?1:0),3),((e,t,i,n)=>{let a;for(Se(e,t-257,5),Se(e,i-1,5),Se(e,n-4,4),a=0;a<n;a++)Se(e,e.bl_tree[2*oe[a]+1],3);xe(e,e.dyn_ltree,t-1),xe(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Ie(e,e.dyn_ltree,e.dyn_dtree)),ye(e),n&&Ae(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(de[i]+256+1)]++,e.dyn_dtree[2*pe(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{Se(e,2,3),be(e,256,se),(e=>{16===e.bi_valid?(ve(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},Oe=(e,t,i,n)=>{let a=65535&e|0,o=e>>>16&65535|0,s=0;for(;0!==i;){s=i>2e3?2e3:i,i-=s;do{a=a+t[n++]|0,o=o+a|0}while(--s);a%=65521,o%=65521}return a|o<<16|0};const Ue=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var ze=(e,t,i,n)=>{const a=Ue,o=n+i;e^=-1;for(let i=n;i<o;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},Pe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ne={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:He,_tr_stored_block:Le,_tr_flush_block:Be,_tr_tally:Ve,_tr_align:We}=Fe,{Z_NO_FLUSH:je,Z_PARTIAL_FLUSH:Ke,Z_FULL_FLUSH:Ze,Z_FINISH:$e,Z_BLOCK:qe,Z_OK:Qe,Z_STREAM_END:Ge,Z_STREAM_ERROR:Je,Z_DATA_ERROR:Ye,Z_BUF_ERROR:Xe,Z_DEFAULT_COMPRESSION:et,Z_FILTERED:tt,Z_HUFFMAN_ONLY:it,Z_RLE:nt,Z_FIXED:at,Z_DEFAULT_STRATEGY:ot,Z_UNKNOWN:st,Z_DEFLATED:rt}=Ne,lt=258,dt=262,ct=103,ht=113,ut=666,_t=(e,t)=>(e.msg=Pe[t],t),mt=e=>(e<<1)-(e>4?9:0),gt=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let ft=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const pt=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},vt=(e,t)=>{Be(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,pt(e.strm)},St=(e,t)=>{e.pending_buf[e.pending++]=t},bt=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ct=(e,t,i,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=Oe(e.adler,t,a,i):2===e.state.wrap&&(e.adler=ze(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},wt=(e,t)=>{let i,n,a=e.max_chain_length,o=e.strstart,s=e.prev_length,r=e.nice_match;const l=e.strstart>e.w_size-dt?e.strstart-(e.w_size-dt):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+lt;let _=d[o+s-1],m=d[o+s];e.prev_length>=e.good_match&&(a>>=2),r>e.lookahead&&(r=e.lookahead);do{if(i=t,d[i+s]===m&&d[i+s-1]===_&&d[i]===d[o]&&d[++i]===d[o+1]){o+=2,i++;do{}while(d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&o<u);if(n=lt-(u-o),o=u-lt,n>s){if(e.match_start=t,s=n,n>=r)break;_=d[o+s-1],m=d[o+s]}}}while((t=h[t&c])>l&&0!=--a);return s<=e.lookahead?s:e.lookahead},yt=e=>{const t=e.w_size;let i,n,a,o,s;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-dt)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,n=e.hash_size,i=n;do{a=e.head[--i],e.head[i]=a>=t?a-t:0}while(--n);n=t,i=n;do{a=e.prev[--i],e.prev[i]=a>=t?a-t:0}while(--n);o+=t}if(0===e.strm.avail_in)break;if(n=Ct(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=ft(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=ft(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<dt&&0!==e.strm.avail_in)},At=(e,t)=>{let i,n;for(;;){if(e.lookahead<dt){if(yt(e),e.lookahead<dt&&t===je)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-dt&&(e.match_length=wt(e,i)),e.match_length>=3)if(n=Ve(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ft(e,e.ins_h,e.window[e.strstart+1]);else n=Ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(vt(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$e?(vt(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(vt(e,!1),0===e.strm.avail_out)?1:2},Tt=(e,t)=>{let i,n,a;for(;;){if(e.lookahead<dt){if(yt(e),e.lookahead<dt&&t===je)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-dt&&(e.match_length=wt(e,i),e.match_length<=5&&(e.strategy===tt||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=Ve(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(vt(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Ve(e,0,e.window[e.strstart-1]),n&&vt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Ve(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$e?(vt(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(vt(e,!1),0===e.strm.avail_out)?1:2};function Rt(e,t,i,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=a}const It=[new Rt(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(yt(e),0===e.lookahead&&t===je)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,vt(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-dt&&(vt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$e?(vt(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(vt(e,!1),e.strm.avail_out),1)})),new Rt(4,4,8,4,At),new Rt(4,5,16,8,At),new Rt(4,6,32,32,At),new Rt(4,4,16,16,Tt),new Rt(8,16,32,32,Tt),new Rt(8,16,128,128,Tt),new Rt(8,32,128,256,Tt),new Rt(32,128,258,1024,Tt),new Rt(32,258,258,4096,Tt)];function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),gt(this.dyn_ltree),gt(this.dyn_dtree),gt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),gt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),gt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const kt=e=>{if(!e||!e.state)return _t(e,Je);e.total_in=e.total_out=0,e.data_type=st;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:ht,e.adler=2===t.wrap?0:1,t.last_flush=je,He(t),Qe},xt=e=>{const t=kt(e);var i;return t===Qe&&((i=e.state).window_size=2*i.w_size,gt(i.head),i.max_lazy_match=It[i.level].max_lazy,i.good_match=It[i.level].good_length,i.nice_match=It[i.level].nice_length,i.max_chain_length=It[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},Et=(e,t,i,n,a,o)=>{if(!e)return Je;let s=1;if(t===et&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||i!==rt||n<8||n>15||t<0||t>9||o<0||o>at)return _t(e,Je);8===n&&(n=9);const r=new Dt;return e.state=r,r.strm=e,r.wrap=s,r.gzhead=null,r.w_bits=n,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=a+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<a+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=o,r.method=i,xt(e)};var Mt=Et,Ft=(e,t)=>e&&e.state?2!==e.state.wrap?Je:(e.state.gzhead=t,Qe):Je,Ot=(e,t)=>{let i,n;if(!e||!e.state||t>qe||t<0)return e?_t(e,Je):Je;const a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===ut&&t!==$e)return _t(e,0===e.avail_out?Xe:Je);a.strm=e;const o=a.last_flush;if(a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,St(a,31),St(a,139),St(a,8),a.gzhead?(St(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),St(a,255&a.gzhead.time),St(a,a.gzhead.time>>8&255),St(a,a.gzhead.time>>16&255),St(a,a.gzhead.time>>24&255),St(a,9===a.level?2:a.strategy>=it||a.level<2?4:0),St(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(St(a,255&a.gzhead.extra.length),St(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=ze(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(St(a,0),St(a,0),St(a,0),St(a,0),St(a,0),St(a,9===a.level?2:a.strategy>=it||a.level<2?4:0),St(a,3),a.status=ht);else{let t=rt+(a.w_bits-8<<4)<<8,i=-1;i=a.strategy>=it||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,a.status=ht,bt(a,t),0!==a.strstart&&(bt(a,e.adler>>>16),bt(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(i=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),pt(e),i=a.pending,a.pending!==a.pending_buf_size));)St(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),pt(e),i=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,St(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),0===n&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),pt(e),i=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,St(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>i&&(e.adler=ze(e.adler,a.pending_buf,a.pending-i,i)),0===n&&(a.status=ct)}else a.status=ct;if(a.status===ct&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&pt(e),a.pending+2<=a.pending_buf_size&&(St(a,255&e.adler),St(a,e.adler>>8&255),e.adler=0,a.status=ht)):a.status=ht),0!==a.pending){if(pt(e),0===e.avail_out)return a.last_flush=-1,Qe}else if(0===e.avail_in&&mt(t)<=mt(o)&&t!==$e)return _t(e,Xe);if(a.status===ut&&0!==e.avail_in)return _t(e,Xe);if(0!==e.avail_in||0!==a.lookahead||t!==je&&a.status!==ut){let i=a.strategy===it?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(yt(e),0===e.lookahead)){if(t===je)return 1;break}if(e.match_length=0,i=Ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(vt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$e?(vt(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(vt(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===nt?((e,t)=>{let i,n,a,o;const s=e.window;for(;;){if(e.lookahead<=lt){if(yt(e),e.lookahead<=lt&&t===je)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){o=e.strstart+lt;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<o);e.match_length=lt-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=Ve(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(vt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$e?(vt(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(vt(e,!1),0===e.strm.avail_out)?1:2})(a,t):It[a.level].func(a,t);if(3!==i&&4!==i||(a.status=ut),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Qe;if(2===i&&(t===Ke?We(a):t!==qe&&(Le(a,0,0,!1),t===Ze&&(gt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),pt(e),0===e.avail_out))return a.last_flush=-1,Qe}return t!==$e?Qe:a.wrap<=0?Ge:(2===a.wrap?(St(a,255&e.adler),St(a,e.adler>>8&255),St(a,e.adler>>16&255),St(a,e.adler>>24&255),St(a,255&e.total_in),St(a,e.total_in>>8&255),St(a,e.total_in>>16&255),St(a,e.total_in>>24&255)):(bt(a,e.adler>>>16),bt(a,65535&e.adler)),pt(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Qe:Ge)},Ut=e=>{if(!e||!e.state)return Je;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==ct&&t!==ht&&t!==ut?_t(e,Je):(e.state=null,t===ht?_t(e,Ye):Qe)},zt=(e,t)=>{let i=t.length;if(!e||!e.state)return Je;const n=e.state,a=n.wrap;if(2===a||1===a&&42!==n.status||n.lookahead)return Je;if(1===a&&(e.adler=Oe(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===a&&(gt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const o=e.avail_in,s=e.next_in,r=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,yt(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=ft(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,yt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=r,e.avail_in=o,n.wrap=a,Qe};const Pt=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Nt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Pt(i,t)&&(e[t]=i[t])}}return e},Ht=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];i.set(a,n),n+=a.length}return i};let Lt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Lt=!1}const Bt=new Uint8Array(256);for(let e=0;e<256;e++)Bt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Bt[254]=Bt[254]=1;var Vt=e=>{let t,i,n,a,o,s=e.length,r=0;for(a=0;a<s;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),r+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(r),o=0,a=0;o<r;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},Wt=(e,t)=>{let i,n;const a=t||e.length,o=new Array(2*a);for(n=0,i=0;i<a;){let t=e[i++];if(t<128){o[n++]=t;continue}let s=Bt[t];if(s>4)o[n++]=65533,i+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&i<a;)t=t<<6|63&e[i++],s--;s>1?o[n++]=65533:t<65536?o[n++]=t:(t-=65536,o[n++]=55296|t>>10&1023,o[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Lt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i})(o,n)},jt=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Bt[e[i]]>t?i:t},Kt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Zt=Object.prototype.toString,{Z_NO_FLUSH:$t,Z_SYNC_FLUSH:qt,Z_FULL_FLUSH:Qt,Z_FINISH:Gt,Z_OK:Jt,Z_STREAM_END:Yt,Z_DEFAULT_COMPRESSION:Xt,Z_DEFAULT_STRATEGY:ei,Z_DEFLATED:ti}=Ne;function ii(e){this.options=Nt({level:Xt,method:ti,chunkSize:16384,windowBits:15,memLevel:8,strategy:ei},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Kt,this.strm.avail_out=0;let i=Mt(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Jt)throw new Error(Pe[i]);if(t.header&&Ft(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Vt(t.dictionary):"[object ArrayBuffer]"===Zt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=zt(this.strm,e),i!==Jt)throw new Error(Pe[i]);this._dict_set=!0}}function ni(e,t){const i=new ii(t);if(i.push(e,!0),i.err)throw i.msg||Pe[i.err];return i.result}ii.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize;let a,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Gt:$t,"string"==typeof e?i.input=Vt(e):"[object ArrayBuffer]"===Zt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(o===qt||o===Qt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=Ot(i,o),a===Yt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=Ut(this.strm),this.onEnd(a),this.ended=!0,a===Jt;if(0!==i.avail_out){if(o>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ii.prototype.onData=function(e){this.chunks.push(e)},ii.prototype.onEnd=function(e){e===Jt&&(this.result=Ht(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ai={Deflate:ii,deflate:ni,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ni(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ni(e,t)},constants:Ne},oi=function(e,t){let i,n,a,o,s,r,l,d,c,h,u,_,m,g,f,p,v,S,b,C,w,y,A,T;const R=e.state;i=e.next_in,A=e.input,n=i+(e.avail_in-5),a=e.next_out,T=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),r=R.dmax,l=R.wsize,d=R.whave,c=R.wnext,h=R.window,u=R.hold,_=R.bits,m=R.lencode,g=R.distcode,f=(1<<R.lenbits)-1,p=(1<<R.distbits)-1;e:do{_<15&&(u+=A[i++]<<_,_+=8,u+=A[i++]<<_,_+=8),v=m[u&f];t:for(;;){if(S=v>>>24,u>>>=S,_-=S,S=v>>>16&255,0===S)T[a++]=65535&v;else{if(!(16&S)){if(0==(64&S)){v=m[(65535&v)+(u&(1<<S)-1)];continue t}if(32&S){R.mode=12;break e}e.msg="invalid literal/length code",R.mode=30;break e}b=65535&v,S&=15,S&&(_<S&&(u+=A[i++]<<_,_+=8),b+=u&(1<<S)-1,u>>>=S,_-=S),_<15&&(u+=A[i++]<<_,_+=8,u+=A[i++]<<_,_+=8),v=g[u&p];i:for(;;){if(S=v>>>24,u>>>=S,_-=S,S=v>>>16&255,!(16&S)){if(0==(64&S)){v=g[(65535&v)+(u&(1<<S)-1)];continue i}e.msg="invalid distance code",R.mode=30;break e}if(C=65535&v,S&=15,_<S&&(u+=A[i++]<<_,_+=8,_<S&&(u+=A[i++]<<_,_+=8)),C+=u&(1<<S)-1,C>r){e.msg="invalid distance too far back",R.mode=30;break e}if(u>>>=S,_-=S,S=a-o,C>S){if(S=C-S,S>d&&R.sane){e.msg="invalid distance too far back",R.mode=30;break e}if(w=0,y=h,0===c){if(w+=l-S,S<b){b-=S;do{T[a++]=h[w++]}while(--S);w=a-C,y=T}}else if(c<S){if(w+=l+c-S,S-=c,S<b){b-=S;do{T[a++]=h[w++]}while(--S);if(w=0,c<b){S=c,b-=S;do{T[a++]=h[w++]}while(--S);w=a-C,y=T}}}else if(w+=c-S,S<b){b-=S;do{T[a++]=h[w++]}while(--S);w=a-C,y=T}for(;b>2;)T[a++]=y[w++],T[a++]=y[w++],T[a++]=y[w++],b-=3;b&&(T[a++]=y[w++],b>1&&(T[a++]=y[w++]))}else{w=a-C;do{T[a++]=T[w++],T[a++]=T[w++],T[a++]=T[w++],b-=3}while(b>2);b&&(T[a++]=T[w++],b>1&&(T[a++]=T[w++]))}break}}break}}while(i<n&&a<s);b=_>>3,i-=b,_-=b<<3,u&=(1<<_)-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=a<s?s-a+257:257-(a-s),R.hold=u,R.bits=_};const si=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ri=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),li=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),di=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ci=(e,t,i,n,a,o,s,r)=>{const l=r.bits;let d,c,h,u,_,m,g=0,f=0,p=0,v=0,S=0,b=0,C=0,w=0,y=0,A=0,T=null,R=0;const I=new Uint16Array(16),D=new Uint16Array(16);let k,x,E,M=null,F=0;for(g=0;g<=15;g++)I[g]=0;for(f=0;f<n;f++)I[t[i+f]]++;for(S=l,v=15;v>=1&&0===I[v];v--);if(S>v&&(S=v),0===v)return a[o++]=20971520,a[o++]=20971520,r.bits=1,0;for(p=1;p<v&&0===I[p];p++);for(S<p&&(S=p),w=1,g=1;g<=15;g++)if(w<<=1,w-=I[g],w<0)return-1;if(w>0&&(0===e||1!==v))return-1;for(D[1]=0,g=1;g<15;g++)D[g+1]=D[g]+I[g];for(f=0;f<n;f++)0!==t[i+f]&&(s[D[t[i+f]]++]=f);if(0===e?(T=M=s,m=19):1===e?(T=si,R-=257,M=ri,F-=257,m=256):(T=li,M=di,m=-1),A=0,f=0,g=p,_=o,b=S,C=0,h=-1,y=1<<S,u=y-1,1===e&&y>852||2===e&&y>592)return 1;for(;;){k=g-C,s[f]<m?(x=0,E=s[f]):s[f]>m?(x=M[F+s[f]],E=T[R+s[f]]):(x=96,E=0),d=1<<g-C,c=1<<b,p=c;do{c-=d,a[_+(A>>C)+c]=k<<24|x<<16|E|0}while(0!==c);for(d=1<<g-1;A&d;)d>>=1;if(0!==d?(A&=d-1,A+=d):A=0,f++,0==--I[g]){if(g===v)break;g=t[i+s[f]]}if(g>S&&(A&u)!==h){for(0===C&&(C=S),_+=p,b=g-C,w=1<<b;b+C<v&&(w-=I[b+C],!(w<=0));)b++,w<<=1;if(y+=1<<b,1===e&&y>852||2===e&&y>592)return 1;h=A&u,a[h]=S<<24|b<<16|_-o|0}}return 0!==A&&(a[_+A]=g-C<<24|64<<16|0),r.bits=S,0};const{Z_FINISH:hi,Z_BLOCK:ui,Z_TREES:_i,Z_OK:mi,Z_STREAM_END:gi,Z_NEED_DICT:fi,Z_STREAM_ERROR:pi,Z_DATA_ERROR:vi,Z_MEM_ERROR:Si,Z_BUF_ERROR:bi,Z_DEFLATED:Ci}=Ne,wi=12,yi=30,Ai=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ti(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ri=e=>{if(!e||!e.state)return pi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,mi},Ii=e=>{if(!e||!e.state)return pi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ri(e)},Di=(e,t)=>{let i;if(!e||!e.state)return pi;const n=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?pi:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,Ii(e))},ki=(e,t)=>{if(!e)return pi;const i=new Ti;e.state=i,i.window=null;const n=Di(e,t);return n!==mi&&(e.state=null),n};let xi,Ei,Mi=!0;const Fi=e=>{if(Mi){xi=new Int32Array(512),Ei=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ci(1,e.lens,0,288,xi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ci(2,e.lens,0,32,Ei,0,e.work,{bits:5}),Mi=!1}e.lencode=xi,e.lenbits=9,e.distcode=Ei,e.distbits=5},Oi=(e,t,i,n)=>{let a;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(i-o.wsize,i),0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>n&&(a=n),o.window.set(t.subarray(i-n,i-n+a),o.wnext),(n-=a)?(o.window.set(t.subarray(i-n,i),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0};var Ui=Ii,zi=ki,Pi=(e,t)=>{let i,n,a,o,s,r,l,d,c,h,u,_,m,g,f,p,v,S,b,C,w,y,A=0;const T=new Uint8Array(4);let R,I;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return pi;i=e.state,i.mode===wi&&(i.mode=13),s=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,n=e.input,r=e.avail_in,d=i.hold,c=i.bits,h=r,u=l,y=mi;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;c<16;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(2&i.wrap&&35615===d){i.check=0,T[0]=255&d,T[1]=d>>>8&255,i.check=ze(i.check,T,2,0),d=0,c=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",i.mode=yi;break}if((15&d)!==Ci){e.msg="unknown compression method",i.mode=yi;break}if(d>>>=4,c-=4,w=8+(15&d),0===i.wbits)i.wbits=w;else if(w>i.wbits){e.msg="invalid window size",i.mode=yi;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&d?10:wi,d=0,c=0;break;case 2:for(;c<16;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(i.flags=d,(255&i.flags)!==Ci){e.msg="unknown compression method",i.mode=yi;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=yi;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&(T[0]=255&d,T[1]=d>>>8&255,i.check=ze(i.check,T,2,0)),d=0,c=0,i.mode=3;case 3:for(;c<32;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.head&&(i.head.time=d),512&i.flags&&(T[0]=255&d,T[1]=d>>>8&255,T[2]=d>>>16&255,T[3]=d>>>24&255,i.check=ze(i.check,T,4,0)),d=0,c=0,i.mode=4;case 4:for(;c<16;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&(T[0]=255&d,T[1]=d>>>8&255,i.check=ze(i.check,T,2,0)),d=0,c=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&(T[0]=255&d,T[1]=d>>>8&255,i.check=ze(i.check,T,2,0)),d=0,c=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(_=i.length,_>r&&(_=r),_&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(o,o+_),w)),512&i.flags&&(i.check=ze(i.check,n,_,o)),r-=_,o+=_,i.length-=_),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===r)break e;_=0;do{w=n[o+_++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&_<r);if(512&i.flags&&(i.check=ze(i.check,n,_,o)),r-=_,o+=_,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===r)break e;_=0;do{w=n[o+_++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&_<r);if(512&i.flags&&(i.check=ze(i.check,n,_,o)),r-=_,o+=_,w)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=yi;break}d=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=wi;break;case 10:for(;c<32;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}e.adler=i.check=Ai(d),d=0,c=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=r,i.hold=d,i.bits=c,fi;e.adler=i.check=1,i.mode=wi;case wi:if(t===ui||t===_i)break e;case 13:if(i.last){d>>>=7&c,c-=7&c,i.mode=27;break}for(;c<3;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}switch(i.last=1&d,d>>>=1,c-=1,3&d){case 0:i.mode=14;break;case 1:if(Fi(i),i.mode=20,t===_i){d>>>=2,c-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=yi}d>>>=2,c-=2;break;case 14:for(d>>>=7&c,c-=7&c;c<32;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=yi;break}if(i.length=65535&d,d=0,c=0,i.mode=15,t===_i)break e;case 15:i.mode=16;case 16:if(_=i.length,_){if(_>r&&(_=r),_>l&&(_=l),0===_)break e;a.set(n.subarray(o,o+_),s),r-=_,o+=_,l-=_,s+=_,i.length-=_;break}i.mode=wi;break;case 17:for(;c<14;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(i.nlen=257+(31&d),d>>>=5,c-=5,i.ndist=1+(31&d),d>>>=5,c-=5,i.ncode=4+(15&d),d>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=yi;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.lens[D[i.have++]]=7&d,d>>>=3,c-=3}for(;i.have<19;)i.lens[D[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,R={bits:i.lenbits},y=ci(0,i.lens,0,19,i.lencode,0,i.work,R),i.lenbits=R.bits,y){e.msg="invalid code lengths set",i.mode=yi;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;A=i.lencode[d&(1<<i.lenbits)-1],f=A>>>24,p=A>>>16&255,v=65535&A,!(f<=c);){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(v<16)d>>>=f,c-=f,i.lens[i.have++]=v;else{if(16===v){for(I=f+2;c<I;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(d>>>=f,c-=f,0===i.have){e.msg="invalid bit length repeat",i.mode=yi;break}w=i.lens[i.have-1],_=3+(3&d),d>>>=2,c-=2}else if(17===v){for(I=f+3;c<I;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}d>>>=f,c-=f,w=0,_=3+(7&d),d>>>=3,c-=3}else{for(I=f+7;c<I;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}d>>>=f,c-=f,w=0,_=11+(127&d),d>>>=7,c-=7}if(i.have+_>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=yi;break}for(;_--;)i.lens[i.have++]=w}}if(i.mode===yi)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=yi;break}if(i.lenbits=9,R={bits:i.lenbits},y=ci(1,i.lens,0,i.nlen,i.lencode,0,i.work,R),i.lenbits=R.bits,y){e.msg="invalid literal/lengths set",i.mode=yi;break}if(i.distbits=6,i.distcode=i.distdyn,R={bits:i.distbits},y=ci(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,R),i.distbits=R.bits,y){e.msg="invalid distances set",i.mode=yi;break}if(i.mode=20,t===_i)break e;case 20:i.mode=21;case 21:if(r>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=r,i.hold=d,i.bits=c,oi(e,u),s=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,n=e.input,r=e.avail_in,d=i.hold,c=i.bits,i.mode===wi&&(i.back=-1);break}for(i.back=0;A=i.lencode[d&(1<<i.lenbits)-1],f=A>>>24,p=A>>>16&255,v=65535&A,!(f<=c);){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(p&&0==(240&p)){for(S=f,b=p,C=v;A=i.lencode[C+((d&(1<<S+b)-1)>>S)],f=A>>>24,p=A>>>16&255,v=65535&A,!(S+f<=c);){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}d>>>=S,c-=S,i.back+=S}if(d>>>=f,c-=f,i.back+=f,i.length=v,0===p){i.mode=26;break}if(32&p){i.back=-1,i.mode=wi;break}if(64&p){e.msg="invalid literal/length code",i.mode=yi;break}i.extra=15&p,i.mode=22;case 22:if(i.extra){for(I=i.extra;c<I;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;A=i.distcode[d&(1<<i.distbits)-1],f=A>>>24,p=A>>>16&255,v=65535&A,!(f<=c);){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(0==(240&p)){for(S=f,b=p,C=v;A=i.distcode[C+((d&(1<<S+b)-1)>>S)],f=A>>>24,p=A>>>16&255,v=65535&A,!(S+f<=c);){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}d>>>=S,c-=S,i.back+=S}if(d>>>=f,c-=f,i.back+=f,64&p){e.msg="invalid distance code",i.mode=yi;break}i.offset=v,i.extra=15&p,i.mode=24;case 24:if(i.extra){for(I=i.extra;c<I;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=yi;break}i.mode=25;case 25:if(0===l)break e;if(_=u-l,i.offset>_){if(_=i.offset-_,_>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=yi;break}_>i.wnext?(_-=i.wnext,m=i.wsize-_):m=i.wnext-_,_>i.length&&(_=i.length),g=i.window}else g=a,m=s-i.offset,_=i.length;_>l&&(_=l),l-=_,i.length-=_;do{a[s++]=g[m++]}while(--_);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;a[s++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===r)break e;r--,d|=n[o++]<<c,c+=8}if(u-=l,e.total_out+=u,i.total+=u,u&&(e.adler=i.check=i.flags?ze(i.check,a,u,s-u):Oe(i.check,a,u,s-u)),u=l,(i.flags?d:Ai(d))!==i.check){e.msg="incorrect data check",i.mode=yi;break}d=0,c=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===r)break e;r--,d+=n[o++]<<c,c+=8}if(d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=yi;break}d=0,c=0}i.mode=29;case 29:y=gi;break e;case yi:y=vi;break e;case 31:return Si;case 32:default:return pi}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=r,i.hold=d,i.bits=c,(i.wsize||u!==e.avail_out&&i.mode<yi&&(i.mode<27||t!==hi))&&Oi(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,i.total+=u,i.wrap&&u&&(e.adler=i.check=i.flags?ze(i.check,a,u,e.next_out-u):Oe(i.check,a,u,e.next_out-u)),e.data_type=i.bits+(i.last?64:0)+(i.mode===wi?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===u||t===hi)&&y===mi&&(y=bi),y},Ni=e=>{if(!e||!e.state)return pi;let t=e.state;return t.window&&(t.window=null),e.state=null,mi},Hi=(e,t)=>{if(!e||!e.state)return pi;const i=e.state;return 0==(2&i.wrap)?pi:(i.head=t,t.done=!1,mi)},Li=(e,t)=>{const i=t.length;let n,a,o;return e&&e.state?(n=e.state,0!==n.wrap&&11!==n.mode?pi:11===n.mode&&(a=1,a=Oe(a,t,i,0),a!==n.check)?vi:(o=Oi(e,t,i,i),o?(n.mode=31,Si):(n.havedict=1,mi))):pi},Bi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Vi=Object.prototype.toString,{Z_NO_FLUSH:Wi,Z_FINISH:ji,Z_OK:Ki,Z_STREAM_END:Zi,Z_NEED_DICT:$i,Z_STREAM_ERROR:qi,Z_DATA_ERROR:Qi,Z_MEM_ERROR:Gi}=Ne;function Ji(e){this.options=Nt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Kt,this.strm.avail_out=0;let i=zi(this.strm,t.windowBits);if(i!==Ki)throw new Error(Pe[i]);if(this.header=new Bi,Hi(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Vt(t.dictionary):"[object ArrayBuffer]"===Vi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Li(this.strm,t.dictionary),i!==Ki)))throw new Error(Pe[i])}function Yi(e,t){const i=new Ji(t);if(i.push(e),i.err)throw i.msg||Pe[i.err];return i.result}Ji.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let o,s,r;if(this.ended)return!1;for(s=t===~~t?t:!0===t?ji:Wi,"[object ArrayBuffer]"===Vi.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),o=Pi(i,s),o===$i&&a&&(o=Li(i,a),o===Ki?o=Pi(i,s):o===Qi&&(o=$i));i.avail_in>0&&o===Zi&&i.state.wrap>0&&0!==e[i.next_in];)Ui(i),o=Pi(i,s);switch(o){case qi:case Qi:case $i:case Gi:return this.onEnd(o),this.ended=!0,!1}if(r=i.avail_out,i.next_out&&(0===i.avail_out||o===Zi))if("string"===this.options.to){let e=jt(i.output,i.next_out),t=i.next_out-e,a=Wt(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(o!==Ki||0!==r){if(o===Zi)return o=Ni(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Ji.prototype.onData=function(e){this.chunks.push(e)},Ji.prototype.onEnd=function(e){e===Ki&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ht(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xi={Inflate:Ji,inflate:Yi,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Yi(e,t)},ungzip:Yi,constants:Ne};const{Deflate:en,deflate:tn,deflateRaw:nn,gzip:an}=ai,{Inflate:on,inflate:sn,inflateRaw:rn,ungzip:ln}=Xi,dn={Deflate:en,deflate:tn,deflateRaw:nn,gzip:an,Inflate:on,inflate:sn,inflateRaw:rn,ungzip:ln,constants:Ne};var cn=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))};const hn="undefined"!=typeof window;let un=hn&&window.MediaStream;if(!hn)try{un=i(326).cL}catch(e){}var _n,mn;!function(e){e.CLIENT="client",e.ADMIN="admin",e.INTERNAL="internal"}(_n||(_n={}));class gn{constructor({success:e,targetInputAudioMutedValue:t,currentInputAudioMutedValue:i,adminPreventsInputAudioUnmuting:n,muteReason:a}){this.success=e,this.targetInputAudioMutedValue=t,this.currentInputAudioMutedValue=i,this.adminPreventsInputAudioUnmuting=n,this.muteReason=a}}class fn{constructor({userDataStreamingScope:e=Sn.All,onUserDataUpdated:t,onUsersDisconnected:i,onConnectionStateChanged:n,onMuteChanged:a,getUserFacingConnectionState:o,coordFrameUtil:s}){this.concurrency=0,this.onRAVISignalingStateChanged=function(e){return cn(this,void 0,void 0,(function*(){switch(m.M.log(`New RAVI signaling state: \`${e.state}\``),e.state){case p.UNAVAILABLE:this._disableReconnect=!0,this._onConnectionStateChange(vn.Unavailable,{success:!1,error:"High Fidelity server is at capacity; service is unavailable.",disableReconnect:this._disableReconnect});try{yield this._disconnectFromHiFiMixer()}catch(e){m.M.log(`Error encountered while trying to close the connection. Error:\n${S.safelyPrintable(e)}`)}}}))}.bind(this),this.onRAVISessionStateChanged=function(e){return cn(this,void 0,void 0,(function*(){let t;switch(m.M.log(`New RAVI session state: \`${e.state}\``),this._raviDiagnostics.fire(),e.state){case k.CONNECTED:m.M.log("RaviSession connected; waiting for results of audionet.init"),this._copyAudioTracksFromRavi();break;case k.CLOSED:t="RaviSession has been closed; connection to High Fidelity servers has been disconnected",this._onConnectionStateChange(vn.Disconnected,{success:!0,error:t,disableReconnect:this._disableReconnect});break;case k.DISCONNECTED:case k.FAILED:t="RaviSession has disconnected unexpectedly",this._onConnectionStateChange(vn.Failed,{success:!1,error:t,disableReconnect:this._disableReconnect});try{yield this._disconnectFromHiFiMixer()}catch(e){m.M.log(`Error encountered while trying to close the connection. Error:\n${S.safelyPrintable(e)}`)}}}))}.bind(this),this.webRTCAddress=void 0,this.userDataStreamingScope=e,this.onUserDataUpdated=t,this.onUsersDisconnected=i,this._mixerPeerKeyToStateCacheDict={},this._lastSuccessfulInputAudioMutedValue=!1,this.onMuteChanged=a,this._getUserFacingConnectionState=o,this._disableReconnect=!1,this._coordFrameUtil=s,S.setDebug(!1),this._raviSignalingConnection=new b,this._raviSession=new E,this._raviSession.getCommandController().addBinaryHandler((e=>{this.handleRAVISessionBinaryData(e)}),!0),this.onConnectionStateChanged=n,this._outputAudioMediaStream=new un,this._tryingToConnect=!1,this._resetMixerInfo(),this._raviDiagnostics=new ee({label:"ravi",session:this,ravi:this._raviSession}),this._hifiDiagnostics=new ee({label:"app",session:this,ravi:this._raviSession,fireOn:["visibilitychange","pagehide","beforeunload"]})}promiseToRunAudioInit(e){return cn(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{let n={primary:!0,visit_id:this._raviSession.getUUID(),session:this._raviSession.getUUID(),streaming_scope:this.userDataStreamingScope,is_input_stream_stereo:this._inputAudioMediaStreamIsStereo};if(e){let t=this._getDataToTransmitToMixer(e);n=Object.assign(Object.assign({},n),t)}let a=this._raviSession.getCommandController();if(!a)return i({success:!1,error:"Couldn't connect to mixer: no `commandController`!"});let o=setTimeout((()=>cn(this,void 0,void 0,(function*(){return i({success:!1,error:"Couldn't connect to mixer: Call to `init` timed out!",disableReconnect:this._disableReconnect})}))),5e3);a.queueCommand("audionet.init",n,(e=>cn(this,void 0,void 0,(function*(){let n;clearTimeout(o);try{return n=JSON.parse(e),this.mixerInfo.connected=!0,this.mixerInfo.build_number=n.build_number,this.mixerInfo.build_type=n.build_type,this.mixerInfo.build_version=n.build_version,this.mixerInfo.visit_id_hash=n.visit_id_hash,t({success:!0,audionetInitResponse:n,disableReconnect:this._disableReconnect})}catch(e){return i({success:!1,error:`Couldn't parse init response! Parse error:\n${e}`,disableReconnect:this._disableReconnect})}}))))}))}))}handleRAVISessionBinaryData(e){let t=dn.ungzip(e,{to:"string"}),i=JSON.parse(t);if(i.deleted_visit_ids){let e=[],t=i.deleted_visit_ids;for(const i of t){let t=i,n=new h({hashedVisitID:t}),a=Object.keys(this._mixerPeerKeyToStateCacheDict);for(const e of a)if(this._mixerPeerKeyToStateCacheDict[e].hashedVisitID===t){this._mixerPeerKeyToStateCacheDict[e].providedUserID&&(n.providedUserID=this._mixerPeerKeyToStateCacheDict[e].providedUserID);break}e.push(n)}this.concurrency-=e.length,this.onUsersDisconnected&&e.length>0&&this.onUsersDisconnected(e)}if(i.peers){let e=[],t=Object.keys(i.peers);for(let n=0;n<t.length;n++){let a,o=i.peers[t[n]];this._mixerPeerKeyToStateCacheDict[t[n]]?a=this._mixerPeerKeyToStateCacheDict[t[n]]:(a=new h,this._mixerPeerKeyToStateCacheDict[t[n]]=a,this.concurrency+=1);let s=new h;a.providedUserID?s.providedUserID=a.providedUserID:"string"==typeof o.J&&(a.providedUserID=o.J,s.providedUserID=o.J),a.hashedVisitID?s.hashedVisitID=a.hashedVisitID:"string"==typeof o.e&&(a.hashedVisitID=o.e,s.hashedVisitID=o.e);let d=!1,c=!1;"number"==typeof o.x&&(a.position||(a.position=new r),a.position.x=o.x/1e3,c=!0),"number"==typeof o.y&&(a.position||(a.position=new r),a.position.y=o.y/1e3,c=!0),"number"==typeof o.z&&(a.position||(a.position=new r),a.position.z=o.z/1e3,c=!0),c&&(null==this._coordFrameUtil?s.position=a.position:s.position=this._coordFrameUtil.HiFiPositionToWorld(a.position),d=!0);let u=!1;"number"==typeof o.W&&(a.orientation||(a.orientation=new l),a.orientation.w=o.W/1e3,u=!0),"number"==typeof o.X&&(a.orientation||(a.orientation=new l),a.orientation.x=o.X/1e3,u=!0),"number"==typeof o.Y&&(a.orientation||(a.orientation=new l),a.orientation.y=o.Y/1e3,u=!0),"number"==typeof o.Z&&(a.orientation||(a.orientation=new l),a.orientation.z=o.Z/1e3,u=!0),u&&(null==this._coordFrameUtil?s.orientation=new l({w:a.orientation.w,x:a.orientation.x,y:a.orientation.y,z:a.orientation.z}):s.orientation=this._coordFrameUtil.HiFiOrientationToWorld(a.orientation),d=!0),"number"==typeof o.v&&(a.volumeDecibels=o.v,s.volumeDecibels=o.v,d=!0),"boolean"==typeof o.s&&(a.isStereo=o.s,s.isStereo=o.s,d=!0),d&&e.push(s)}this.onUserDataUpdated&&e.length>0&&this.onUserDataUpdated(e)}if(i.instructions)for(const e of i.instructions){if(!Array.isArray(e)||!e.length)continue;let t=e[0],i=e.slice(1);if("mute"===t){let e;i.length>=1&&"boolean"==typeof i[0]&&(e=i[0]),void 0!==e&&this._setMutedByAdmin(e,_n.ADMIN)}else"terminate"===t&&(this._disableReconnect=!0,this._disconnectFromHiFiMixer())}}connectToHiFiMixer({webRTCSessionParams:e,customSTUNandTURNConfig:t,timeout:i,initData:n}){if(this._tryingToConnect)return void m.M.warn("`HiFiMixerSession.connectToHiFiMixer()` was called, but is already in the process of connecting. No action will be taken.");if(this.mixerInfo.connected){let e="Already connected! If a reconnect is needed, please hang up and try again.";return void this._onConnectionStateChange(vn.Connected,{success:!0,error:e,disableReconnect:this._disableReconnect})}if(!this.webRTCAddress){let e="Couldn't connect: `this.webRTCAddress` is falsey!";return void this._onConnectionStateChange(vn.Failed,{success:!1,error:e,disableReconnect:this._disableReconnect})}let a=!1;const o=e=>{if(e&&e.state===p.UNAVAILABLE){a=!0;let e="High Fidelity server is at capacity; service is unavailable.";this._onConnectionStateChange(vn.Unavailable,{success:!1,error:e,disableReconnect:this._disableReconnect}),this._raviSignalingConnection.removeStateChangeHandler(o),this._raviSession.closeRAVISession()}};this._raviSignalingConnection.addStateChangeHandler(o),this._raviSignalingConnection.removeStateChangeHandler(this.onRAVISignalingStateChanged),this._raviSession.removeStateChangeHandler(this.onRAVISessionStateChanged),this._tryingToConnect=!0,Promise.resolve().then((()=>(m.M.log("Opening signaling connection"),this._raviSignalingConnection.openRAVISignalingConnection(this.webRTCAddress).catch((e=>{throw`Couldn't open signaling connection to \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${S.safelyPrintable(e)}`}))))).then((n=>(m.M.log("Signaling connection open; starting RAVI session"),this._raviSession.openRAVISession({signalingConnection:this._raviSignalingConnection,timeout:i,params:e,customStunAndTurn:t}).catch((e=>{let t=`Couldn't open RAVI session associated with \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${S.safelyPrintable(e)}`;throw a&&(t="High Fidelity server is at capacity; service is unavailable.",this._onConnectionStateChange(vn.Unavailable,{success:!1,error:t,disableReconnect:this._disableReconnect})),t}))))).then((e=>(m.M.log("Session open; running audionet.init"),this.promiseToRunAudioInit(n).catch((e=>{throw`Connected, but was then unable to communicate the \`audionet.init\` message to the server. Error:\n${S.safelyPrintable(e)}`}))))).then((e=>{m.M.log("audionet.init run; calling state change handler for connected"),this._onConnectionStateChange(vn.Connected,e)})).then((e=>{this._raviSignalingConnection.addStateChangeHandler(this.onRAVISignalingStateChanged),this._raviSession.addStateChangeHandler(this.onRAVISessionStateChanged)})).catch((e=>{this._onConnectionStateChange(vn.Failed,{success:!1,error:e,disableReconnect:this._disableReconnect})})).finally((()=>{this._raviSignalingConnection.removeStateChangeHandler(o),this.concurrency=0,this._tryingToConnect=!1}))}disconnectFromHiFiMixer(){return cn(this,void 0,void 0,(function*(){return this._raviDiagnostics.noteExplicitApplicationClose(),this._hifiDiagnostics.noteExplicitApplicationClose(),this._disconnectFromHiFiMixer()}))}_disconnectFromHiFiMixer(){return cn(this,void 0,void 0,(function*(){function e(e,t,i){return cn(this,void 0,void 0,(function*(){if(e){let n=e.getState();if(e&&n!==i)try{e instanceof b?yield e.closeRAVISignalingConnection():e instanceof E&&(yield e.closeRAVISession()),m.M.log(`The RAVI ${t} closed successfully from state ${n}.`)}catch(e){m.M.warn(`The RAVI ${t} didn't close successfully from state ${n}! Error:\n${S.safelyPrintable(e)}`)}else m.M.log(`The RAVI ${t} was already closed.`)}else m.M.warn(`The RAVI ${t} was missing.`);e=null}))}return yield e(this._raviSignalingConnection,"Signaling Connection",p.CLOSED),yield e(this._raviSession,"Session",k.CLOSED),this._resetMixerInfo(),yield this._setMutedByAdmin(!1,_n.INTERNAL),this._onConnectionStateChange(vn.Disconnected,{success:!0,error:"Successfully disconnected",disableReconnect:this._disableReconnect}),Promise.resolve("Successfully disconnected.")}))}setRAVIInputAudio(e,t=!1){return cn(this,void 0,void 0,(function*(){let i=!1;if(this._raviSession){let n=this._raviSession.getStreamController();n?(n.setInputAudio(e,t),m.M.log("Successfully set input audio on _raviSession.streamController!"),i=!0):(m.M.warn("Couldn't set input audio on _raviSession.streamController: No `streamController`!"),i=!1)}else m.M.warn("Couldn't set input audio on _raviSession.streamController: No `_raviSession`!"),i=!1;if(i&&this._inputAudioMediaStreamIsStereo!=t)if(this._raviSession.getState()===k.CONNECTED){let e;m.M.warn(`Stereo status has changed from ${this._inputAudioMediaStreamIsStereo} to ${t}; attempting to re-initialize with the mixer`);try{this._inputAudioMediaStreamIsStereo=t,e=yield this.promiseToRunAudioInit()}catch(e){let t=`Attempt to call \`audionet.init\` for change in stereo status failed! Error:\n${S.safelyPrintable(e.error)}`;return Promise.reject(t)}}else this._inputAudioMediaStreamIsStereo=t;return i}))}setInputAudioMuted(e,t=!1){return cn(this,void 0,void 0,(function*(){return yield this._setMuted(e,t,_n.CLIENT)}))}_setMutedByAdmin(e,t){return cn(this,void 0,void 0,(function*(){return this._adminPreventsInputAudioUnmuting=e,yield this._setMuted(e||this._lastSuccessfulInputAudioMutedValue,!1,t)}))}_setMuted(e,t,i){return cn(this,void 0,void 0,(function*(){let n=!0;return i==_n.CLIENT&&this._adminPreventsInputAudioUnmuting&&!e&&(m.M.warn("Couldn't set mute state: Muted by admin."),n=!1),n&&(n=yield this._trySetInputAudioMuted(e,t)),n&&(this._lastSuccessfulInputAudioMutedValue=e),this.onMuteChanged&&this.onMuteChanged(new gn({success:n,targetInputAudioMutedValue:e,currentInputAudioMutedValue:this._lastSuccessfulInputAudioMutedValue,adminPreventsInputAudioUnmuting:this._adminPreventsInputAudioUnmuting,muteReason:i})),n}))}_trySetInputAudioMuted(e,t){return cn(this,void 0,void 0,(function*(){let i=this._raviSession.getStreamController();if(!this._raviSession||!i)return m.M.warn("Couldn't set mute state: No `_raviSession`, or `_raviSession.getStreamController()` returned null."),!1;{let n=!1;if("undefined"!=typeof navigator&&navigator.permissions&&navigator.permissions.query){let e;try{e=yield navigator.permissions.query({name:"microphone"})}catch(e){}e&&"granted"===e.state&&(n=!0)}if(t&&n&&"undefined"!=typeof self){let t=i._inputAudioStream;if(t&&e)return t.getTracks().forEach((e=>{this._cachedMediaTrackConstraints=e.getConstraints(),e.stop()})),i.setInputAudio(null),m.M.log("Successfully set mute state to `true` by stopping all input media tracks!"),!0;if(!t&&!e){let e=yield navigator.mediaDevices.getUserMedia({audio:this._cachedMediaTrackConstraints,video:!1});return i.setInputAudio(e),m.M.log("Successfully set mute state to `false` by getting new input media stream!"),!0}if(t&&!e)return t.getTracks().forEach((e=>{e.enabled=!0})),m.M.log("Successfully set mute state to `false` by enabling all tracks on `_raviSession.streamController._inputAudioStream`!"),!0;m.M.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}else{let t=i._inputAudioStream;if(t)return t.getTracks().forEach((t=>{t.enabled=!e})),m.M.log(`Successfully set mute state to ${e} on _raviSession.streamController._inputAudioStream`),!0;m.M.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}}}))}getOutputAudioMediaStream(){return this._outputAudioMediaStream}isConnected(){return this._raviSession.getState()===k.CONNECTED&&this._raviSignalingConnection.getState()===p.OPEN}getCurrentHiFiConnectionState(){return this._getUserFacingConnectionState?this._getUserFacingConnectionState():void 0}_onConnectionStateChange(e,t){return cn(this,void 0,void 0,(function*(){if(this.getCurrentHiFiConnectionState()!==e&&(this.onConnectionStateChanged&&this.onConnectionStateChanged(e,t),e===vn.Connected?(this._raviDiagnostics.prime(this.mixerInfo.visit_id_hash),this._hifiDiagnostics.prime(this.mixerInfo.visit_id_hash),this._copyAudioTracksFromRavi()):this._hifiDiagnostics.fire()),e===vn.Failed)try{yield this.disconnectFromHiFiMixer()}catch(e){m.M.log(`Error encountered while trying to close the connection. Error:\n${S.safelyPrintable(e)}`)}}))}_copyAudioTracksFromRavi(){let e,t=this._outputAudioMediaStream.getAudioTracks(),i=this._raviSession.getStreamController();i&&i.getAudioStream()&&(e=i.getAudioStream().getAudioTracks()),e&&(m.M.log("Resetting this._outputAudioMediaStream tracks to the current RAVI audio tracks."),t.forEach((e=>this._outputAudioMediaStream.removeTrack(e))),e.forEach((e=>this._outputAudioMediaStream.addTrack(e))))}startCollectingWebRTCStats(e){this._raviSession?(this._statsObserverCallback&&this.stopCollectingWebRTCStats(),this._statsObserverCallback=e,this._raviSession.addStatsObserver(this._statsObserverCallback)):m.M.error("Couldn't start collecting WebRTC stats: No `_raviSession`!")}stopCollectingWebRTCStats(){this._raviSession?(this._raviSession.removeStatsObserver(this._statsObserverCallback),this._statsObserverCallback=void 0):m.M.error("Couldn't stop collecting WebRTC stats: No `_raviSession`!")}_getDataToTransmitToMixer(e,t){let i={};if(e.position&&"number"==typeof e.position.x&&"number"==typeof e.position.y&&"number"==typeof e.position.z){let n={x:!1,y:!1,z:!1,changed:!1};if(t&&t.position?(e.position.x!==t.position.x&&(n.x=!0,n.changed=!0),e.position.y!==t.position.y&&(n.y=!0,n.changed=!0),e.position.z!==t.position.z&&(n.z=!0,n.changed=!0)):(n.x=!0,n.y=!0,n.z=!0,n.changed=!0),n.changed){let t=e.position;null!=this._coordFrameUtil&&(t=this._coordFrameUtil.WorldPositionToHiFi(t)),n.x&&(i.x=Math.round(1e3*t.x)),n.y&&(i.y=Math.round(1e3*t.y)),n.z&&(i.z=Math.round(1e3*t.z))}}if(e.orientation&&"number"==typeof e.orientation.w&&"number"==typeof e.orientation.x&&"number"==typeof e.orientation.y&&"number"==typeof e.orientation.z){let n={w:!1,x:!1,y:!1,z:!1,changed:!1};if(t&&t.orientation?(e.orientation.w!==t.orientation.w&&(n.w=!0,n.changed=!0),e.orientation.x!==t.orientation.x&&(n.x=!0,n.changed=!0),e.orientation.y!==t.orientation.y&&(n.y=!0,n.changed=!0),e.orientation.z!==t.orientation.z&&(n.z=!0,n.changed=!0)):(n.w=!0,n.x=!0,n.y=!0,n.z=!0,n.changed=!0),n.changed){let t=e.orientation;null!=this._coordFrameUtil&&(t=this._coordFrameUtil.WorldOrientationToHiFi(t)),n.w&&(i.W=1e3*t.w),n.x&&(i.X=1e3*t.x),n.y&&(i.Y=1e3*t.y),n.z&&(i.Z=1e3*t.z)}}if("number"!=typeof e.volumeThreshold&&null!==e.volumeThreshold||(i.T=e.volumeThreshold),"number"==typeof e.hiFiGain&&(i.g=Math.max(0,e.hiFiGain)),"number"==typeof e.userAttenuation&&(i.a=e.userAttenuation),"number"==typeof e.userRolloff&&(i.r=Math.max(0,e.userRolloff)),"object"==typeof e._otherUserGainQueue){let n={},a=Object.entries(e._otherUserGainQueue),o=t?t._otherUserGainQueue:void 0;for(const e of a){let t=e[0],i=e[1];"number"==typeof i&&(o&&o[t]===i||(n[t]=i))}Object.entries(n).length&&(i.V=n)}return i}_transmitHiFiAudioAPIDataToServer(e,t){if(!this.mixerInfo.connected||!this._raviSession)return{success:!1,error:"Can't transmit data to mixer; not connected to mixer."};let i=this._getDataToTransmitToMixer(e,t);if(0===Object.keys(i).length)return{success:!0,stringifiedDataForMixer:JSON.stringify({})};{let e=this._raviSession.getCommandController();if(e){let t=JSON.stringify(i);return e.sendInput(t),{success:!0,stringifiedDataForMixer:t}}return{success:!1,error:"Can't transmit data to mixer; no `commandController`!."}}}_resetMixerInfo(){this.mixerInfo={connected:!1},this._mixerPeerKeyToStateCacheDict={}}}!function(e){e.Position="Position",e.Orientation="Orientation (Quaternion)",e.VolumeDecibels="Volume (Decibels)",e.IsStereo="IsStereo"}(mn||(mn={}));class pn{constructor({providedUserID:e=null,components:t,callback:i}){this.providedUserID=e,this.components=t,this.callback=i}}var vn,Sn,bn=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e.Unavailable="Unavailable"}(vn||(vn={})),function(e){e.None="none",e.Peers="peers",e.All="all"}(Sn||(Sn={}));class Cn{constructor({initialHiFiAudioAPIData:e=new c,onConnectionStateChanged:t,onUsersDisconnected:i,transmitRateLimitTimeoutMS:a=u.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS,userDataStreamingScope:o=Sn.All,worldFrameConfig:s,webrtcSessionParams:r,customSTUNandTURNConfig:l,onMuteChanged:d,connectionRetryAndTimeoutConfig:h}={}){if(this._timers={transmitRateLimitTimeout:null,wantedToTransmitHiFiAudioAPIData:!0},this._currentHiFiConnectionState=vn.Disconnected,l){if(!l.hasOwnProperty("stunUrls")||!Array.isArray(l.stunUrls)||0==l.stunUrls.length)throw new Error("`customSTUNandTURNConfig.stunUrls` must be specified and must be a list containing at least one STUN server.");if(!l.hasOwnProperty("turnUrls")||!Array.isArray(l.turnUrls)||0==l.turnUrls.length)throw new Error("`customSTUNandTURNConfig.turnUrls` must be specified and must be a list containing at least one TURN server.");if(!l.hasOwnProperty("turnUsername"))throw new Error("`customSTUNandTURNConfig.turnUsername` must be specified.");if(!l.hasOwnProperty("turnCredential"))throw new Error("`customSTUNandTURNConfig.turnCredential` must be specified.")}if(this._customSTUNandTURNConfig=l,a<u.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS&&(m.M.warn(`\`transmitRateLimitTimeoutMS\` must be >= ${u.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms! Setting to ${u.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms...`),a=u.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS),this.transmitRateLimitTimeoutMS=a,i&&(this.onUsersDisconnected=i),t&&(this.onConnectionStateChanged=t),this._connectionRetryAndTimeoutConfig={},Object.assign(this._connectionRetryAndTimeoutConfig,u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT,h),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection<=0&&(m.M.warn(`\`connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection\` must be greater than 0! Setting to the default (${u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingInitialConnection}) instead.`),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection=u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingInitialConnection),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect<=0&&(m.M.warn(`\`connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect\` must be greater than 0! Setting to the default (${u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingOnDisconnect}) instead.`),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect=u.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingOnDisconnect),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS<u.MIN_PAUSE_BETWEEN_RETRIES&&(m.M.warn(`\`connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS\` must be >= ${u.MIN_PAUSE_BETWEEN_RETRIES}! Setting to ${u.MIN_PAUSE_BETWEEN_RETRIES}.`),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS=u.MIN_PAUSE_BETWEEN_RETRIES),s)if(f.isValid(s)){let e=s.handedness==_.RightHand;this._coordFrameUtil=new g(s.forward,s.up,e),this._coordFrameUtil.WorldIsCompatibleWithHifi()&&m.M.warn("The `WorldFrameConfiguration` is compatible with the HiFi-frame and is unnecessary.")}else m.M.error("There is an error with the passed `WorldFrameConfiguration`, so it was not used. There are more error details in the logs above.");this._mixerSession=new fn({userDataStreamingScope:o,onUserDataUpdated:e=>{this._handleUserDataUpdates(e)},onUsersDisconnected:e=>{this._onUsersDisconnected(e)},onConnectionStateChanged:(e,t)=>{this._manageConnection(e,t)},onMuteChanged:d,getUserFacingConnectionState:this.getConnectionState.bind(this),coordFrameUtil:this._coordFrameUtil}),this._inputAudioMediaStream=void 0,this._currentHiFiAudioAPIData=new c,this._lastTransmittedHiFiAudioAPIData=new c,this._userDataSubscriptions=[],r&&r.audioMinJitterBufferDuration&&(r.audioMinJitterBufferDuration<0||r.audioMinJitterBufferDuration>10)&&(m.M.warn(`The value of \`webrtcSessionParams.audioMinJitterBufferDuration\` (${r.audioMinJitterBufferDuration}) will be clamped to (0.0, 10.0).`),r.audioMinJitterBufferDuration=n.H.clamp(r.audioMinJitterBufferDuration,0,10)),r&&r.audioMaxJitterBufferDuration&&(r.audioMaxJitterBufferDuration<0||r.audioMaxJitterBufferDuration>10)&&(m.M.warn(`The value of \`webrtcSessionParams.audioMaxJitterBufferDuration\` (${r.audioMaxJitterBufferDuration}) will be clamped to (0.0, 10.0).`),r.audioMaxJitterBufferDuration=n.H.clamp(r.audioMaxJitterBufferDuration,0,10)),this._webRTCSessionParams=r,this._updateUserData(e)}getConnectionState(){return this._currentHiFiConnectionState}connectToHiFiAudioAPIServer(e,t,i){return bn(this,void 0,void 0,(function*(){if(!this._mixerSession){let e="`this._mixerSession` is falsey; try creating a new HiFiCommunicator and starting over.";return Promise.reject({success:!1,error:e})}if([vn.Connected,vn.Connecting,vn.Reconnecting].includes(this.getConnectionState())){let e="Session is already connected or is in the process of connecting! If you need to reset the connection, please disconnect fully using `disconnectFromHiFiAudioAPIServer()` and call this method again.";return Promise.resolve({success:!0,error:e})}let n;try{let e=new URL(t);n=e.hostname,null==i&&""!==e.port&&(i=Number(e.port))}catch(e){n=t||u.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT}this._mixerSession._disableReconnect=!1;let a=`wss://${n}:${i=i||u.DEFAULT_PROD_HIGH_FIDELITY_PORT}/?token=`;this._mixerSession.webRTCAddress=`${a}${e}`,m.M.log(`Using WebRTC Signaling Address:\n${a}<token redacted>`);let o=this;return o._failureNotificationPending=void 0,new Promise(((e,t)=>{o._resolveOpen=e,o._rejectOpen=t,this._manageConnection(vn.Connecting)}))}))}_connectToHiFiMixer(){if(this._mixerSession&&this._mixerSession.webRTCAddress||this._manageConnection(vn.Failed,{success:!1,error:"_connectToHiFiMixer() must be called after connectToHiFiAudioAPIServer()"}),this._mixerSession.isConnected())throw new Error("Session is already connected! If you need to reset the connection, please disconnect fully using `disconnectFromHiFiAudioAPIServer()` and call this method again.");let e=this._connectionRetryAndTimeoutConfig.timeoutPerConnectionAttemptMS;this._mixerSession.connectToHiFiMixer({webRTCSessionParams:this._webRTCSessionParams,customSTUNandTURNConfig:this._customSTUNandTURNConfig,timeout:e,initData:this._currentHiFiAudioAPIData})}_manageConnection(e,t){switch(e){case vn.Connecting:case vn.Reconnecting:return void(this._currentHiFiConnectionState!==vn.Connected?(m.M.log("_manageConnection: kicking off connection attempt."),this._updateStateAndCallUserStateChangeHandler(e,t),this._connectToHiFiMixer()):m.M.warn(`_manageConnection called for ${e} -- but already connected; taking no action.`));case vn.Connected:return clearTimeout(this._retryTimerInProgress),this._retryTimerInProgress=null,this._failureNotificationPending=void 0,void this._updateStateAndCallUserStateChangeHandler(e,t);case vn.Disconnecting:return void this._updateStateAndCallUserStateChangeHandler(e,t);case vn.Failed:return void(this._failureNotificationPending=t);case vn.Disconnected:if(this._retryTimerInProgress)return m.M.log("_manageConnection: Timer active; continuing to retry connection"),this._currentHiFiConnectionState!==vn.Connecting&&this._currentHiFiConnectionState!==vn.Reconnecting&&(m.M.warn(`_manageConnection handling reconnection, but encountered unexpected state ${this._currentHiFiConnectionState}; will attempt to reconnect, but please contact High Fidelity and report this message`),this._updateStateAndCallUserStateChangeHandler(vn.Reconnecting,t)),void setTimeout((()=>{this._manageConnection(this._currentHiFiConnectionState)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS);let i=0;if(this._currentHiFiConnectionState===vn.Connecting&&this._connectionRetryAndTimeoutConfig.autoRetryInitialConnection&&!t.disableReconnect)i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection;else if(this._currentHiFiConnectionState===vn.Reconnecting&&this._connectionRetryAndTimeoutConfig.autoRetryOnDisconnect&&!t.disableReconnect)m.M.warn(`_manageConnection handling reconnection, but is being called for ${e} and there isn't already a timer. Will attempt to reconnect, but please contact High Fidelity and report this message`),i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect;else{if(this._currentHiFiConnectionState!==vn.Connected||!this._connectionRetryAndTimeoutConfig.autoRetryOnDisconnect||t.disableReconnect)return this._failureNotificationPending?(this._updateStateAndCallUserStateChangeHandler(vn.Failed,this._failureNotificationPending),this._updateStateAndCallUserStateChangeHandler(vn.Disconnected,this._failureNotificationPending)):this._updateStateAndCallUserStateChangeHandler(vn.Disconnected,t),void(this._failureNotificationPending=void 0);i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect}return void(i>=0&&(m.M.warn("_manageConnection: Attempting retry of connection with timeout "+i),this._retryTimerInProgress=setTimeout((()=>{this._cancelRetriedConnectionAttempts()}),i),this._currentHiFiConnectionState===vn.Connected?(this._updateStateAndCallUserStateChangeHandler(vn.Reconnecting,t),setTimeout((()=>{this._manageConnection(vn.Reconnecting)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS)):this._currentHiFiConnectionState===vn.Connecting&&setTimeout((()=>{this._manageConnection(vn.Connecting)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS)));case vn.Unavailable:return void this._updateStateAndCallUserStateChangeHandler(e,t);default:return void m.M.error(`_manageConnection called for invalid state change to ${e}; taking no action.`)}}_updateStateAndCallUserStateChangeHandler(e,t){e===vn.Connected&&(this._lastTransmittedHiFiAudioAPIData=new c,this._transmitHiFiAudioAPIDataToServer(!0)),e!==this._currentHiFiConnectionState&&(this._currentHiFiConnectionState=e,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState,t)),e===vn.Connected&&this._resolveOpen&&(this._resolveOpen(t),this._resolveOpen=void 0,this._rejectOpen=void 0),e!==vn.Disconnected&&e!==vn.Unavailable||!this._rejectOpen||(this._rejectOpen(t),this._resolveOpen=void 0,this._rejectOpen=void 0)}_cancelRetriedConnectionAttempts(){m.M.warn("Cancelling retries of connections"),clearTimeout(this._retryTimerInProgress),this._retryTimerInProgress=void 0,this._failureNotificationPending||(this._failureNotificationPending={success:!1,error:"Connection retry attempts unsuccessful"}),this._updateStateAndCallUserStateChangeHandler(vn.Failed,this._failureNotificationPending),this._mixerSession.disconnectFromHiFiMixer()}disconnectFromHiFiAudioAPIServer(){return bn(this,void 0,void 0,(function*(){return this._mixerSession?this._currentHiFiConnectionState===vn.Disconnecting||this._currentHiFiConnectionState===vn.Disconnected?Promise.resolve("HiFiCommunicator is already disconnected or in the process of disconnecting."):(this._manageConnection(vn.Disconnecting),this._lastTransmittedHiFiAudioAPIData=new c,this._mixerSession.disconnectFromHiFiMixer()):Promise.resolve("No mixer session from which we can disconnect!")}))}setOtherUserGainForThisConnection(e,t){return bn(this,void 0,void 0,(function*(){let i={};i[e]=t;let n=this.setOtherUserGainsForThisConnection(i);return Promise.resolve(n)}))}setOtherUserGainsForThisConnection(e){return bn(this,void 0,void 0,(function*(){Object.assign(this._currentHiFiAudioAPIData._otherUserGainQueue,e);let t=this._transmitHiFiAudioAPIDataToServer();return Promise.resolve({success:t.success,error:t.error})}))}getOutputAudioMediaStream(){return this._mixerSession?this._mixerSession.getOutputAudioMediaStream():null}setInputAudioMediaStream(e,t=!1){return bn(this,void 0,void 0,(function*(){const i=yield this._mixerSession.setRAVIInputAudio(e,t);return i?this._inputAudioMediaStream=e:m.M.warn("Error trying to setRAVIInputAudio on this._mixerSession"),i}))}setInputAudioMuted(e){return bn(this,void 0,void 0,(function*(){return this._mixerSession?(m.M.debug(`Setting mute state to : ${e}`),yield this._mixerSession.setInputAudioMuted(e)):(m.M.warn("Couldn't set mute state: No `_mixerSession`."),!1)}))}getCommunicatorInfo(){let e={clientInfo:{inputAudioStreamSet:!!this._inputAudioMediaStream}};return"undefined"!=typeof self&&(e.clientInfo.apiVersion="v2.0.1-3"),this._mixerSession&&this._mixerSession.mixerInfo&&(e.serverInfo=this._mixerSession.mixerInfo),e}startCollectingWebRTCStats(e){this._mixerSession||m.M.error("Couldn't start collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.startCollectingWebRTCStats(e)}stopCollectingWebRTCStats(){this._mixerSession||m.M.error("Couldn't stop collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.stopCollectingWebRTCStats()}_updateUserData({position:e,orientation:t,volumeThreshold:i,hiFiGain:n,userAttenuation:a,userRolloff:o}={}){var s,d,c,h,u,_,m;e&&(this._currentHiFiAudioAPIData.position||(this._currentHiFiAudioAPIData.position=new r),this._currentHiFiAudioAPIData.position.x=null!==(s=e.x)&&void 0!==s?s:this._currentHiFiAudioAPIData.position.x,this._currentHiFiAudioAPIData.position.y=null!==(d=e.y)&&void 0!==d?d:this._currentHiFiAudioAPIData.position.y,this._currentHiFiAudioAPIData.position.z=null!==(c=e.z)&&void 0!==c?c:this._currentHiFiAudioAPIData.position.z),t&&(this._currentHiFiAudioAPIData.orientation||(this._currentHiFiAudioAPIData.orientation=new l),this._currentHiFiAudioAPIData.orientation.w=null!==(h=t.w)&&void 0!==h?h:this._currentHiFiAudioAPIData.orientation.w,this._currentHiFiAudioAPIData.orientation.x=null!==(u=t.x)&&void 0!==u?u:this._currentHiFiAudioAPIData.orientation.x,this._currentHiFiAudioAPIData.orientation.y=null!==(_=t.y)&&void 0!==_?_:this._currentHiFiAudioAPIData.orientation.y,this._currentHiFiAudioAPIData.orientation.z=null!==(m=t.z)&&void 0!==m?m:this._currentHiFiAudioAPIData.orientation.z),"number"!=typeof i&&null!==i||(this._currentHiFiAudioAPIData.volumeThreshold=i),"number"==typeof n&&(this._currentHiFiAudioAPIData.hiFiGain=Math.max(0,n)),"number"==typeof a&&(this._currentHiFiAudioAPIData.userAttenuation=a),"number"==typeof o&&(this._currentHiFiAudioAPIData.userRolloff=Math.max(0,o))}_maybeClearRateLimitTimeout(){this._timers.transmitRateLimitTimeout&&clearTimeout(this._timers.transmitRateLimitTimeout),this._timers.transmitRateLimitTimeout=null}_updateLastTransmittedHiFiAudioAPIData(e){var t,i,n,a,o,s,d;if(e.position&&(this._lastTransmittedHiFiAudioAPIData.position||(this._lastTransmittedHiFiAudioAPIData.position=new r),this._lastTransmittedHiFiAudioAPIData.position.x=null!==(t=e.position.x)&&void 0!==t?t:this._lastTransmittedHiFiAudioAPIData.position.x,this._lastTransmittedHiFiAudioAPIData.position.y=null!==(i=e.position.y)&&void 0!==i?i:this._lastTransmittedHiFiAudioAPIData.position.y,this._lastTransmittedHiFiAudioAPIData.position.z=null!==(n=e.position.z)&&void 0!==n?n:this._lastTransmittedHiFiAudioAPIData.position.z),e.orientation&&(this._lastTransmittedHiFiAudioAPIData.orientation||(this._lastTransmittedHiFiAudioAPIData.orientation=new l),this._lastTransmittedHiFiAudioAPIData.orientation.w=null!==(a=e.orientation.w)&&void 0!==a?a:this._lastTransmittedHiFiAudioAPIData.orientation.w,this._lastTransmittedHiFiAudioAPIData.orientation.x=null!==(o=e.orientation.x)&&void 0!==o?o:this._lastTransmittedHiFiAudioAPIData.orientation.x,this._lastTransmittedHiFiAudioAPIData.orientation.y=null!==(s=e.orientation.y)&&void 0!==s?s:this._lastTransmittedHiFiAudioAPIData.orientation.y,this._lastTransmittedHiFiAudioAPIData.orientation.z=null!==(d=e.orientation.z)&&void 0!==d?d:this._lastTransmittedHiFiAudioAPIData.orientation.z),"number"!=typeof e.volumeThreshold&&null!==e.volumeThreshold||(this._lastTransmittedHiFiAudioAPIData.volumeThreshold=e.volumeThreshold),"number"==typeof e.hiFiGain&&(this._lastTransmittedHiFiAudioAPIData.hiFiGain=e.hiFiGain),"number"==typeof e.userAttenuation&&(this._lastTransmittedHiFiAudioAPIData.userAttenuation=e.userAttenuation),"number"==typeof e.userRolloff&&(this._lastTransmittedHiFiAudioAPIData.userRolloff=e.userRolloff),"object"==typeof e._otherUserGainQueue){"object"!=typeof this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue&&(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue={});for(const t of Object.entries(e._otherUserGainQueue))this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue[t[0]]=t[1]}}_transmitHiFiAudioAPIDataToServer(e){if(this._mixerSession&&(!this._timers.transmitRateLimitTimeout||e)){this._timers.wantedToTransmitHiFiAudioAPIData=!1,this._maybeClearRateLimitTimeout(),e||(this._timers.transmitRateLimitTimeout=setTimeout((()=>{this._maybeClearRateLimitTimeout(),this._timers.wantedToTransmitHiFiAudioAPIData&&this._transmitHiFiAudioAPIDataToServer(!0)}),this.transmitRateLimitTimeoutMS));let t=this._mixerSession._transmitHiFiAudioAPIDataToServer(this._currentHiFiAudioAPIData,this._lastTransmittedHiFiAudioAPIData);return t.success?(this._updateLastTransmittedHiFiAudioAPIData(this._currentHiFiAudioAPIData),this._cleanUpHiFiAudioAPIDataHistory(),{success:!0,rawDataTransmitted:t.stringifiedDataForMixer}):{success:!1,error:t.error}}return this._mixerSession&&this._timers.transmitRateLimitTimeout&&!e?(this._timers.wantedToTransmitHiFiAudioAPIData=!0,{success:!0,error:"Transfer is rate limited. Transfer will occur shortly automatically."}):this._mixerSession?void 0:{success:!1,error:"No server connection yet; can't transmit user data."}}_cleanUpHiFiAudioAPIDataHistory(){this._currentHiFiAudioAPIData._otherUserGainQueue={},Object.keys(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue).length>1e3&&(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue={},m.M.warn("Stored `_lastTransmittedHiFiAudioAPIData._otherUserGainQueue` was too large and was cleared to save space."))}updateUserDataAndTransmit(e){return this._updateUserData(e),this._transmitHiFiAudioAPIDataToServer()}_handleUserDataUpdates(e){if(0!==this._userDataSubscriptions.length)for(let t=0;t<this._userDataSubscriptions.length;t++){let i=this._userDataSubscriptions[t];if(!i.callback)continue;let n=[];for(let t=0;t<e.length;t++){let a=e[t];if(i.providedUserID&&a.providedUserID!==i.providedUserID)continue;let o=new h;"string"==typeof a.providedUserID&&(o.providedUserID=a.providedUserID),"string"==typeof a.hashedVisitID&&(o.hashedVisitID=a.hashedVisitID);let s=!1;for(let e=0;e<i.components.length;e++)switch(i.components[e]){case mn.Position:a.position&&(o.position=a.position,s=!0);break;case mn.Orientation:a.orientation&&(o.orientation=a.orientation,s=!0);break;case mn.VolumeDecibels:"number"==typeof a.volumeDecibels&&(o.volumeDecibels=a.volumeDecibels,s=!0);break;case mn.IsStereo:"boolean"==typeof a.isStereo&&(o.isStereo=a.isStereo,s=!0)}s&&n.push(o)}i.callback&&n.length>0&&i.callback(n)}}_onUsersDisconnected(e){this.onUsersDisconnected&&this.onUsersDisconnected(e)}addUserDataSubscription(e){this._mixerSession?this._mixerSession.userDataStreamingScope!==Sn.None?(m.M.log(`Adding new User Data Subscription:\n${JSON.stringify(e)}`),this._userDataSubscriptions.push(e)):m.M.error("During `HiFiCommunicator` construction, the server was set up to **not** send user data! Data subscription not added."):m.M.error("No `_mixerSession`! Data subscription not added.")}}"undefined"!=typeof self&&n.H.checkBrowserCompatibility();let wn="v2.0.1-3",yn=n.H.getBestAudioConstraints,An=n.H.preciseInterval},649:(e,t,i)=>{var n;i.d(t,{D:()=>n,M:()=>a}),function(e){e.None="None",e.Error="Error",e.Warn="Warn",e.Debug="Debug"}(n||(n={}));class a{constructor(e){e=e||n.Debug}static setHiFiLogLevel(e){a.logLevel=e}static log(e){return a.logLevel===n.Debug&&(console.log(e),!0)}static debug(e){return this.log(e)}static warn(e){return(a.logLevel===n.Debug||a.logLevel===n.Warn)&&(console.warn(e),!0)}static error(e){return(a.logLevel===n.Debug||a.logLevel===n.Warn||a.logLevel===n.Error)&&(console.error(e),!0)}}a.logLevel=n.Error},24:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>HiFiUtilities});var _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(649);function dynamicRequire(e,t){return e.require(t)}let now;if(module=__webpack_require__.hmd(module),"undefined"==typeof self)try{now=dynamicRequire(module,"perf_hooks").performance.now}catch(e){}class HiFiUtilities{constructor(){}static recursivelyDiffObjects(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i,n={},a=(e,t,i)=>{let a=Object.prototype.toString.call(e),o=Object.prototype.toString.call(t);if("[object Undefined]"!==o)if(a===o)if("[object Object]"!==a)"[object Array]"!==a?"[object Function]"===a?e.toString()!==t.toString()&&(n[i]=t):e!==t&&(n[i]=t):((e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0})(e,t)||(n[i]=t);else{let a=HiFiUtilities.recursivelyDiffObjects(e,t);Object.keys(a).length>0&&(n[i]=a)}else n[i]=t;else n[i]=null};for(i in e)e.hasOwnProperty(i)&&a(e[i],t[i],i);for(i in t)t.hasOwnProperty(i)&&(e[i]||e[i]===t[i]||(n[i]=t[i]));return n}static getBestAudioConstraints(){let e={};return"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().echoCancellation&&(e.echoCancellation=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().noiseSuppression&&(e.noiseSuppression=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().autoGainControl&&(e.autoGainControl=!1),e}static preciseInterval(e,t){if(!now)return _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.warn("`preciseInterval()` is a wrapper for `setInterval()` in the browser context!"),setInterval(e,t);let i=now(),n=clearTimeout,a=()=>{let s=now();if(s<i)return n=clearImmediate,o=setImmediate(a);i+=t,n=clearTimeout,o=setTimeout(a,i-s-2),e()},o=setTimeout(a);return{clear:()=>n(o)}}static checkBrowserCompatibility(){let requiredFeatures=["navigator","navigator.mediaDevices.getUserMedia","navigator.mediaDevices.getSupportedConstraints","window.MediaStream","window.RTCDataChannel","window.RTCPeerConnection","window.RTCSessionDescription"];for(let i=0;i<requiredFeatures.length;i++)if(void 0===eval(requiredFeatures[i]))return _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.error("HiFi Audio API: The browser does not support: "+requiredFeatures[i]),"navigator.mediaDevices.getUserMedia"===requiredFeatures[i]&&_HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.error("HiFi Audio API: Your browser may be preventing access to this feature if you are running in an insecure context, i.e. an `http` server."),!1;return!0}static nonan(e,t){return isNaN(e)?t:e}static clamp(e,t,i){return e>i?i:e<t?t:e}static clampNonan(e,t,i,n){return e>i?i:e<t?t:HiFiUtilities.nonan(e,n)}static clampNormalized(e){return e>1?1:e<-1?-1:e}}},326:(e,t)=>{t.cL=window.MediaStream,window.MediaStreamTrack,window.RTCDataChannel,window.RTCDataChannelEvent,window.RTCDtlsTransport,window.RTCIceCandidate,window.RTCIceTransport,t.I$=window.RTCPeerConnection,window.RTCPeerConnectionIceEvent,window.RTCRtpReceiver,window.RTCRtpSender,window.RTCRtpTransceiver,window.RTCSctpTransport,t.Ao=window.RTCSessionDescription,window.getUserMedia,navigator.mediaDevices},26:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.loaded=!0,t.exports}return __webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__(946)})();