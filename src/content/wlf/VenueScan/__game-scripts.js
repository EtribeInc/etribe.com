var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("autoRender",{type:"boolean",default:!0,title:"Auto Render",description:"Disable to only render when camera is moving (saves power when the camera is still)"}),OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.initialize=function(){this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center),this._lastFramePivotPoint=this._pivotPoint.clone();var t=this.entity.getRotation();if(this._yaw=this._calcYaw(t),this._pitch=this._clampPitchAngle(this._calcPitch(t,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length())}this._targetDistance=this._distance,this._autoRenderDefault=this.app.autoRender,this.app.autoRender&&(this.app.autoRender=this.autoRender),this.autoRender||(this.app.renderNextFrame=!0),this.on("attr:autoRender",(function(t,i){this.app.autoRender=t,this.autoRender||(this.app.renderNextFrame=!0)}),this),this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this);var onResizeCanvas=function(){this._checkAspectRatio(),this.autoRender||(this.app.renderNextFrame=!0)};this.app.graphicsDevice.on("resizecanvas",onResizeCanvas,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",onResizeCanvas,this),this.app.autoRender=this._autoRenderDefault}),this)},OrbitCamera.prototype.update=function(t){if(!this.autoRender){var i=Math.abs(this._targetDistance-this._distance),e=Math.abs(this._targetYaw-this._yaw),a=Math.abs(this._targetPitch-this._pitch),s=this._lastFramePivotPoint.distance(this._pivotPoint);this.app.renderNextFrame=this.app.renderNextFrame||i>.01||e>.01||a>.01||s>0}var n=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,n),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,n),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,n),this._lastFramePivotPoint.copy(this._pivotPoint),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,s=0;if(t instanceof pc.Entity){var n=[],r=t.findComponents("render");for(a=0;a<r.length;++a)if(e=r[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);var h=t.findComponents("model");for(a=0;a<h.length;++a)if(e=h[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);for(a=0;a<n.length;a++)0===i?this._modelsAabb.copy(n[a].aabb):this._modelsAabb.add(n[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){if(0!=this.enabled){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)}},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var AnimateRotation=pc.createScript("animateRotation");AnimateRotation.attributes.add("loop",{title:"Loop",description:"If true that animation is looped.",type:"boolean"}),AnimateRotation.attributes.add("animateStart",{title:"Animate on Start",description:"If true that animation is started without wating for an event.",type:"boolean"}),AnimateRotation.attributes.add("triggerEvent",{title:"Trigger Event Name",description:"Event to listen to.",type:"string"}),AnimateRotation.attributes.add("rotationCurve",{type:"curve",title:"Rotation Curve",curves:["x","y","z"]}),AnimateRotation.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimateRotation.attributes.add("offset",{title:"Offset Animation",description:"If true that animation is only an offset to the start value.",type:"boolean"}),AnimateRotation.prototype.initialize=function(){this.animate=this.animateStart,this.entity.on(this.triggerEvent,(()=>{this.animate=!0}),this),this.startRotation=this.entity.getEulerAngles().clone(),this.rotation=new pc.Vec3,this.time=0},AnimateRotation.prototype.update=function(t){if(this.animate){this.time+=t,this.time>this.duration&&(this.loop||(this.animate=!1),this.time=0);var i=this.time/this.duration,a=this.rotationCurve.value(i);this.offset?(this.rotation.copy(this.startRotation),this.rotation.x+=a[0],this.rotation.y+=a[1],this.rotation.z+=a[2]):(this.rotation.copy(this.startRotation),this.rotation.x=a[0],this.rotation.y=a[1],this.rotation.z=a[2]),this.entity.setEulerAngles(this.rotation)}};var AnimatePosition=pc.createScript("animatePosition");AnimatePosition.attributes.add("loop",{title:"Loop",description:"If true that animation is looped.",type:"boolean"}),AnimatePosition.attributes.add("animateStart",{title:"Animate on Start",description:"If true that animation is started without wating for an event.",type:"boolean"}),AnimatePosition.attributes.add("triggerEvent",{title:"Trigger Event Name",description:"Event to listen to.",type:"string"}),AnimatePosition.attributes.add("animCurve",{type:"curve",title:"Position Curve",description:"Position applied to this entity over time.",curves:["x","y","z"]}),AnimatePosition.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimatePosition.attributes.add("offset",{title:"Offset Animation",description:"If true that animation is only an offset to the start value.",type:"boolean"}),AnimatePosition.prototype.initialize=function(){this.animate=this.animateStart,this.entity.on(this.triggerEvent,(()=>{this.animate=!0}),this),this.startPos=this.entity.getLocalPosition().clone(),this.pos=new pc.Vec3,this.time=0},AnimatePosition.prototype.update=function(t){if(this.animate){this.time+=t,this.time>this.duration&&(this.loop||(this.animate=!1),this.time=0);var i=this.time/this.duration,e=this.animCurve.value(i);this.offset?(this.pos.copy(this.startPos),this.pos.x+=e[0],this.pos.y+=e[1],this.pos.z+=e[2]):(this.pos.copy(this.startPos),this.pos.x=e[0],this.pos.y=e[1],this.pos.z=e[2]),this.entity.setLocalPosition(this.pos)}};var AnimateScale=pc.createScript("animateScale");AnimateScale.attributes.add("triggerEvent",{title:"Trigger Event Name",description:"Event to listen to.",type:"string"}),AnimateScale.attributes.add("scaleCurve",{type:"curve",title:"Scale Curve",description:"Scale applied to this entity over time.",curves:["x","y","z"]}),AnimateScale.attributes.add("duration",{type:"number",default:3,title:"Duration (secs)"}),AnimateScale.attributes.add("offset",{title:"Offset Animation",description:"If true that animation is only an offset to the start value.",type:"boolean"}),AnimateScale.prototype.initialize=function(){this.animate=!1,this.entity.on(this.triggerEvent,(()=>{this.animate=!0}),this),this.startScale=this.entity.getLocalScale().clone(),this.scale=new pc.Vec3,this.time=0},AnimateScale.prototype.update=function(t){if(this.animate){this.time+=t,this.time>this.duration&&(this.animate=!1,this.time=0);var e=this.time/this.duration,i=this.scaleCurve.value(e);this.offset?(this.scale.copy(this.startScale),this.scale.x+=i[0],this.scale.y+=i[1],this.scale.z+=i[2]):(this.scale.copy(this.startScale),this.scale.x=i[0],this.scale.y=i[1],this.scale.z=i[2]),this.entity.setLocalScale(this.scale)}};var IframePlane=pc.createScript("iframePlane");IframePlane.attributes.add("iframeUrl",{type:"string"}),IframePlane.attributes.add("interactable",{type:"boolean"}),IframePlane.attributes.add("pixelsPerUnit",{type:"number",default:640,description:"Number of canvas pixels per unit of world space. The larger the number, the higher the resolution of the iframe."}),IframePlane.attributes.add("closeImg",{type:"asset",assetType:"texture"}),IframePlane.attributes.add("pauseMethod",{type:"string",description:"Event body to fire to the iframe on pause."}),IframePlane.prototype.initialize=function(){var e,t;this.iframeUrl?(e=document.createElement("div"),this.iframeElem=document.createElement("iframe"),this.iframeElem.src=this.iframeUrl,this.iframeElem.style.border="0px",this.iframeElem.style.height="100%",this.iframeElem.style.width="100%",(t=document.createElement("div")).addEventListener("click",(()=>this.entity.fire("zoom:out"))),t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.height="100px",t.style.width="100px",t.style.color="white",e.append(this.iframeElem),e.append(t)):e=null,this._css3Plane=new pc.Css3Plane(e,this.entity,this.pixelsPerUnit),this.setInteractable(this.interactable);var i=new pc.StandardMaterial;i.depthWrite=!0,i.redWrite=!1,i.greenWrite=!1,i.blueWrite=!1,i.alphaWrite=!1,i.blendType=pc.BLEND_NONE,i.opacity=0,i.update(),this.entity.render.material=i,this.on("enable",(function(){this._css3Plane.enable()}),this),this.on("disable",(function(){this._css3Plane.disable()}),this),this.entity.on("iframe:interactable",this.setInteractable,this)},IframePlane.prototype.setInteractable=function(e){this._css3Plane&&this._css3Plane.blockEvents(!e),e||this.iframeElem.contentWindow.postMessage(this.pauseMethod,"*")};pc.extend(pc,function(){"use strict";var epsilon=function(e){return Math.abs(e)<1e-10?0:e},e=pc.Application.getApplication(),getCameraCSSMatrix=function(e){var t=e.data;return"matrix3d("+epsilon(t[0])+","+epsilon(-t[1])+","+epsilon(t[2])+","+epsilon(t[3])+","+epsilon(t[4])+","+epsilon(-t[5])+","+epsilon(t[6])+","+epsilon(t[7])+","+epsilon(t[8])+","+epsilon(-t[9])+","+epsilon(t[10])+","+epsilon(t[11])+","+epsilon(t[12])+","+epsilon(-t[13])+","+epsilon(t[14])+","+epsilon(t[15])+")"},Css3Renderer=function(){if(e.css3Renderer)return e.css3Renderer;e.css3Renderer=this,this._stageElement=null,this._cameras=[],this._cameraElements=[],this._defaultCameraElement=null,this._css3Targets=[],this._cameraInvertMat=new pc.Mat4,this._cameraHalfSize=new pc.Vec2;var t=document.createElement("div");t.style.overflow="hidden",t.style.pointerEvents="auto",t.style.position="absolute",t.style.zIndex="10",document.body.appendChild(t);var s=e.touch;s&&s.attach(t),e.elementInput&&e.elementInput.attach(t);var i=document.getElementById("application-canvas");i.style.pointerEvents="none",document.body.insertBefore(t,i),this._stageElement=t,this._defaultCameraElement=this.addCamera(e.root.findComponent("camera"));var n=this;function onWindowResize(){n._width=window.innerWidth,n._height=window.innerHeight,n._widthHalf=n._width/2,n._heightHalf=n._height/2,n._stageElement.style.width=n._width+"px",n._stageElement.style.height=n._height+"px";for(var e=0;e<n._cameraElements.length;e++)n._cameraElements[e].style.width=n._width+"px",n._cameraElements[e].style.height=n._height+"px"}onWindowResize(),window.addEventListener("resize",onWindowResize,!1)};Css3Renderer.prototype={render:function(){this._isRendering||(this._isRendering=!0,e.on("update",this._renderElements,this))},cancelRender:function(){e.off("update",this._renderElements,this),this._isRendering=!1},addCamera:function(e){if(!e)return this._defaultCameraElement;if(this._cameras.indexOf(e)>-1)return this._cameraElements[this._cameras.indexOf(e)];var t=document.createElement("div");return t.style.WebkitTransformStyle="preserve-3d",t.style.transformStyle="preserve-3d",t.style.pointerEvents="none",this._stageElement.appendChild(t),this._cameras.push(e),this._cameraElements.push(t),t},addTarget:function(e){this._css3Targets.indexOf(e)<=-1&&this._css3Targets.push(e)},removeTarget:function(e){var t=this._css3Targets.indexOf(e);-1!==t&&this._css3Targets.splice(t,1)},blockEvents:function(e){for(var t=0;t<this._css3Targets.length;this._css3Targets[t++].blockEvents(e));},_renderElements:function(){for(var e=0;e<this._cameras.length;e++){var t,s,i,n=this._cameras[e],a=this._cameraElements[e],r=n.projectionMatrix.data[5]*this._heightHalf;n.projection==pc.PROJECTION_PERSPECTIVE?(this._stageElement.style.WebkitPerspective=r+"px",this._stageElement.style.perspective=r+"px"):(this._stageElement.style.WebkitPerspective="",this._stageElement.style.perspective=""),n.projection==pc.PROJECTION_ORTHOGRAPHIC&&(pc.Mat4._getPerspectiveHalfSize(this._cameraHalfSize,n.fov,n.aspectRatio,n.nearClip,n.horizontalFov),t=-(this._cameraHalfSize.x-this._cameraHalfSize.x)/2,s=(this._cameraHalfSize.y-this._cameraHalfSize.y)/2),this._cameraInvertMat.copy(n.entity.getWorldTransform()).invert(),i=(n.projection==pc.PROJECTION_ORTHOGRAPHIC?"scale("+r+")translate("+epsilon(t)+"px,"+epsilon(s)+"px)"+getCameraCSSMatrix(this._cameraInvertMat):"translateZ("+r+"px)"+getCameraCSSMatrix(this._cameraInvertMat))+"translate("+this._widthHalf+"px,"+this._heightHalf+"px)",a.style.WebkitTransform=i,a.style.transform=i}for(var h=0;h<this._css3Targets.length;this._css3Targets[h++].updateTransform());}};var Css3Plane=function(t,s,i,n){e.css3Renderer||(e.css3Renderer=new pc.Css3Renderer),this._renderer=e.css3Renderer,t||((t=document.createElement("div")).innerHTML="CSS3 Plane",t.style.backgroundColor="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")",t.style.textAlign="center"),t.style.position="absolute",t.style.pointerEvents="auto",this.dom=t,s||(s=new pc.Entity,e.root.addChild(s)),this.entity=s,this.cameraElement=this._renderer.addCamera(n),this.cameraElement.appendChild(t),this._maxWidth=1920,this._maxHeight=1080,i=i||this._maxWidth,this.pixelsPerWorldUnit=new pc.Vec2(i,i),this._renderer.addTarget(this),this._renderer.render()};return Css3Plane.prototype={updateTransform:function(){var e,t,s,i=this.entity.getWorldTransform(),n=i.getScale(),a=Math.min(n.x*this.pixelsPerWorldUnit.x,this._maxWidth),r=Math.min(n.z*this.pixelsPerWorldUnit.y,this._maxHeight),h=(e=a,t=r,s=i.data,"translate(-50%,-50%)matrix3d("+epsilon(s[0]/e)+","+epsilon(s[1]/e)+","+epsilon(s[2]/e)+","+epsilon(s[3]/e)+","+epsilon(s[8]/t)+","+epsilon(s[9]/t)+","+epsilon(s[10]/t)+","+epsilon(s[11]/t)+","+epsilon(s[4])+","+epsilon(s[5])+","+epsilon(s[6])+","+epsilon(s[7])+","+epsilon(s[12])+","+epsilon(s[13])+","+epsilon(s[14])+","+epsilon(s[15])+")");this.dom.style.width=Math.round(a)+"px",this.dom.style.height=Math.round(r)+"px",this.dom.style.lineHeight=this.dom.style.height,this.dom.style.WebkitTransform=h,this.dom.style.transform=h},blockEvents:function(e){this.dom.style.pointerEvents=e?"none":"auto"},attachPlane:function(e){this.entity=e},disable:function(){this.cameraElement.removeChild(this.dom),this._renderer.removeTarget(this)},enable:function(){this.cameraElement.appendChild(this.dom),this._renderer.addTarget(this)}},{Css3Renderer:Css3Renderer,Css3Plane:Css3Plane}}());var FrameOnEvent=pc.createScript("frameOnEvent");FrameOnEvent.attributes.add("zoomInEvent",{type:"string"}),FrameOnEvent.attributes.add("zoomOutEvent",{type:"string"}),FrameOnEvent.attributes.add("camera",{type:"entity"}),FrameOnEvent.attributes.add("zoomPosition",{type:"entity"}),FrameOnEvent.prototype.initialize=function(){this.initialPos=this.camera.getLocalPosition().clone(),this.initialRot=this.camera.getLocalRotation().clone(),this.currentState=!1,this.entity.on(this.zoomInEvent,(()=>this.frame(!0)),this),this.entity.on(this.zoomOutEvent,(()=>this.frame(!1)),this),this.on("destroy",(function(){this.entity.off(this.zoomInEvent),this.entity.off(this.zoomOutEvent)}),this)},FrameOnEvent.prototype.enableOrbitScripts=function(t){this.camera.script.orbitCamera.enabled=t,this.camera.script.mouseInput.enabled=t,this.camera.script.touchInput.enabled=t},FrameOnEvent.prototype.frame=function(t){if(this.currentState==t)return;this.currentState=t,t&&(this.initialRot=this.camera.getLocalRotation().clone(),this.initialPos=this.camera.getLocalPosition().clone(),this.enableOrbitScripts(!1));let i=t?this.zoomPosition.getLocalPosition():this.initialPos,e=t?this.zoomPosition.getLocalRotation():this.initialRot;this.camera.tween(this.camera.getLocalPosition()).to(i,1,pc.SineOut).on("complete",(()=>this.enableOrbitScripts(!t)),this).start(),this.camera.tween(this.camera.getLocalRotation()).to(e,1,pc.SineOut).start(),this.entity.fire("iframe:interactable",t)},FrameOnEvent.prototype.update=function(t){};var EventOnClick=pc.createScript("eventOnClick");EventOnClick.attributes.add("onDownEvent",{type:"string"}),EventOnClick.attributes.add("onUpEvent",{type:"string"}),EventOnClick.attributes.add("upTimeout",{type:"number",description:"Timeout in s for when the upEvent is ignored."}),EventOnClick.prototype.initialize=function(){this.heldDown=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onUp,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onUp,this)}),this)},EventOnClick.prototype.onDown=function(t){this.heldDown=!0,this.downTimer=setTimeout((()=>this.heldDown=!1),1e3*this.upTimeout);var i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),e=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),n=this.app.systems.rigidbody.raycastFirst(i,e);n&&n.entity.fire(this.onDownEvent)},EventOnClick.prototype.onUp=function(t){if(this.heldDown){clearTimeout(this.downTimer);var i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),e=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),n=this.app.systems.rigidbody.raycastFirst(i,e);n&&n.entity.fire(this.onUpEvent)}},EventOnClick.prototype.update=function(t){};var EventOnKey=pc.createScript("eventOnKey");EventOnKey.attributes.add("keycode",{type:"number",description:"Keycode for key to listen for. Check https://keycode.info/ for info."}),EventOnKey.attributes.add("eventName",{type:"string"}),EventOnKey.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.on("destroy",(function(){this.app.keyboard.off(pc.EVENT_KEYDOWN,this.onKeyDown,this)}),this)},EventOnKey.prototype.onKeyDown=function(e){console.log(e.key),e.key==this.keycode&&(console.log("FIRE!"),this.entity.fire(this.eventName))},EventOnKey.prototype.update=function(e){};var ParallaxCam=pc.createScript("parallaxCam");ParallaxCam.attributes.add("camEntity",{type:"entity"}),ParallaxCam.attributes.add("maxTiltX",{type:"number"}),ParallaxCam.attributes.add("maxTiltY",{type:"number"}),ParallaxCam.attributes.add("speed",{type:"number",default:1}),ParallaxCam.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.pivot=this.entity.parent},ParallaxCam.prototype.onMouseMove=function(t){let a=t.x/this.app.graphicsDevice.width*this.app.graphicsDevice.maxPixelRatio-.5,e=t.y/this.app.graphicsDevice.height*this.app.graphicsDevice.maxPixelRatio-.5;this.tiltTarget=new pc.Vec3(-this.maxTiltX*e,-this.maxTiltY*a,0)},ParallaxCam.prototype.update=function(t){if(this.tiltTarget){let a=new pc.Vec3;this.pivot.setLocalEulerAngles(a.lerp(this.pivot.getLocalEulerAngles(),this.tiltTarget,t*this.speed))}};var AnimEventToEvent=pc.createScript("animEventToEvent");AnimEventToEvent.attributes.add("events",{title:"Events",description:"Events to listen to.",type:"json",array:!0,schema:[{name:"animEvent",type:"string"},{name:"eventName",type:"string"},{name:"target",type:"entity",description:"Target to fire the event on. If left empty, it is fired globaly on this.app ."}]}),AnimEventToEvent.prototype.initialize=function(){for(let e=0;e<this.events.length;e++){var t=this.events[e].target?this.events[e].target:this.app;this.entity.anim.on(this.events[e].animEvent,(()=>{t.fire(this.events[e].eventName)}))}},AnimEventToEvent.prototype.update=function(t){};var AnimateOnevent=pc.createScript("animateOnevent");AnimateOnevent.attributes.add("eventToListenTo",{description:"Event that this entity should listen for.",type:"string"}),AnimateOnevent.attributes.add("animEntity",{description:"Entity with the anim component 'animTriggerName' should be activated on",type:"entity"}),AnimateOnevent.attributes.add("animTriggerName",{description:"The name of the Trigger that should be activated on 'animEntity'",type:"string"}),AnimateOnevent.prototype.initialize=function(){this.entity.on(this.eventToListenTo,(()=>{this.animEntity.anim.setTrigger(this.animTriggerName,!0),this.app.fire("idle:stop")}),this)},AnimateOnevent.prototype.update=function(t){};var IdleAnimationTimer=pc.createScript("idleAnimationTimer");IdleAnimationTimer.attributes.add("timeout",{type:"number",default:10}),IdleAnimationTimer.attributes.add("stopEvent",{type:"string",description:"Idle Animations won't play after this event has been fired."}),IdleAnimationTimer.attributes.add("stopTarget",{type:"entity",description:"Target to listen for stopEvent. Will be this.app if left empty."}),IdleAnimationTimer.prototype.initialize=function(){this.timerInterval=setInterval((()=>{this.entity.anim.setTrigger("Idle_Timer",!0)}),1e3*this.timeout),(this.stopTarget?this.stopTarget:this.app).on(this.stopEvent,(()=>clearInterval(this.timerInterval)),this)},IdleAnimationTimer.prototype.update=function(t){};var EventOnUiClick=pc.createScript("eventOnUiClick");EventOnUiClick.attributes.add("eventName",{type:"string"}),EventOnUiClick.attributes.add("target",{type:"entity"}),EventOnUiClick.prototype.initialize=function(){this.entity.element.on("click",(()=>{console.log("UI click"),this.target.fire(this.eventName)}),this)},EventOnUiClick.prototype.update=function(t){};var EventToEvent=pc.createScript("eventToEvent");EventToEvent.attributes.add("inputEvent",{description:"Event that 'inputTarget' listens for.",type:"string"}),EventToEvent.attributes.add("inputTarget",{description:"Entity that listens for 'inputEvent'.",type:"entity"}),EventToEvent.attributes.add("outputEvent",{description:"Event that should be fired on 'outputTarget' when 'inputTarget' receives 'inputEvent'.",type:"string"}),EventToEvent.attributes.add("outputTarget",{description:"Entity that 'outputEvent' is fired on.",type:"entity"}),EventToEvent.prototype.initialize=function(){let t=this.inputTarget?this.inputTarget:this.app,e=this.outputTarget?this.outputTarget:this.app;t.on(this.inputEvent,(()=>e.fire(this.outputEvent)),this)},EventToEvent.prototype.update=function(t){};var SoundOnEvent=pc.createScript("soundOnEvent");SoundOnEvent.attributes.add("events",{title:"Events",description:"Events to listen to.",type:"json",array:!0,schema:[{name:"eventName",type:"string"},{name:"src",type:"entity",description:"Source to listen the event on. If left empty, it is listend globaly on this.app ."},{name:"soundSlot",type:"string",description:"Name of the soundSlot to play."}]}),SoundOnEvent.prototype.initialize=function(){var t=this.entity.sound;for(let e=0;e<this.events.length;e++){(this.events[e].src?this.events[e].src:this.app).on(this.events[e].eventName,(()=>{t.play(this.events[e].soundSlot)}))}},SoundOnEvent.prototype.update=function(t){};var SetHtmlGradientBg=pc.createScript("setHtmlGradientBg");SetHtmlGradientBg.prototype.initialize=function(){document.body.style.background="radial-gradient(circle, rgba(2,0,36,1) 0%, rgba(55,55,182,1) 35%, rgba(0,212,255,1) 100%)"},SetHtmlGradientBg.prototype.update=function(t){};var AnimationHandler=pc.createScript("animationHandler");AnimationHandler.attributes.add("anims",{type:"json",schema:[{name:"btn",type:"entity"},{name:"target",type:"entity"},{name:"slot_out",type:"string"},{name:"slot_in",type:"string"},{name:"camPos",type:"entity"}],array:!0}),AnimationHandler.attributes.add("camera",{type:"entity"}),AnimationHandler.attributes.add("btnSoundSlot",{type:"string"}),AnimationHandler.attributes.add("trigger_out",{type:"string"}),AnimationHandler.attributes.add("trigger_in",{type:"string"}),AnimationHandler.prototype.initialize=function(){this.soundSrc=this.entity.sound,this.camAnim=this.camera.script.cameraAnimation,this.isPlaying=!1;for(let t=0;t<this.anims.length;t++)this.anims[t].btn.on("btn:pressed",(()=>{this.soundSrc.play(this.btnSoundSlot),this.isPlaying||(null==this.active?(this.active=this.anims[t],this.anims[t].target.fire(this.trigger_out),this.anims[t].target.anim.once("anim:end",(()=>this.isPlaying=!1),this),this.camAnim.moveTo(this.anims[t].camPos),this.entity.script.animatePosition.enabled=!1,this.soundSrc.play(this.anims[t].slot_out)):this.active==this.anims[t]?(this.active.target.anim.once("anim:end",(()=>{this.active=void 0,this.isPlaying=!1}),this),this.active.target.fire(this.trigger_in),this.soundSrc.play(this.active.slot_in),this.camAnim.reset(),this.entity.script.animatePosition.enabled=!0):(this.active.target.anim.once("anim:end",(()=>{this.active=this.anims[t],this.anims[t].target.fire(this.trigger_out),this.anims[t].target.anim.once("anim:end",(()=>this.isPlaying=!1),this),this.camAnim.moveTo(this.anims[t].camPos),this.entity.script.animatePosition.enabled=!1,this.soundSrc.play(this.active.slot_out)}),this),this.active.target.fire(this.trigger_in),this.soundSrc.play(this.active.slot_in),this.camAnim.reset(),this.entity.script.animatePosition.enabled=!0),this.isPlaying=!0)}),this)},AnimationHandler.prototype.update=function(t){};var AnimTrigger=pc.createScript("animTrigger");AnimTrigger.attributes.add("triggers",{type:"string",array:!0}),AnimTrigger.prototype.initialize=function(){for(let i=0;i<this.triggers.length;i++)this.entity.on(this.triggers[i],(()=>{this.entity.anim.setTrigger(this.triggers[i],!0)}),this)},AnimTrigger.prototype.update=function(i){};var ShadowCatcher=pc.createScript("shadowcatcher");ShadowCatcher.attributes.add("material",{type:"asset"}),ShadowCatcher.attributes.add("intensity",{type:"number",min:0,max:1,default:1}),ShadowCatcher.prototype.initialize=function(){const a=this.material.resource||material;a.setParameter("intensity",this.intensity),a.chunks.APIVersion=pc.CHUNKAPI_1_57,a.chunks.emissivePS="\n        #ifdef GL2\n        #define SHADOW_SAMPLERVS sampler2DShadow\n        #else\n        #define SHADOW_SAMPLERVS sampler2D\n        #endif\n        vec3 dEmissive;\n        uniform float intensity;\n        float getShadowPCF5x5(SHADOW_SAMPLERVS shadowMap, vec3 shadowParams);\n        vec3 getTransparentShadow() {\n            float shadow = getShadowPCF5x5(light0_shadowMap, light0_shadowParams);\n            dAlpha = (1. - clamp(shadow + 0.5, 0., 1.)) * intensity;\n            return -gl_FragColor.rgb;\n        }\n\n        void getEmission() {\n\n        }\n    ",a.chunks.endPS="\n        gl_FragColor.rgb = combineColor();\n        gl_FragColor.rgb += getTransparentShadow();\n        gl_FragColor.rgb = addFog(gl_FragColor.rgb);\n\n        #ifndef HDR\n        gl_FragColor.rgb = toneMap(gl_FragColor.rgb);\n        gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);\n        #endif\n    ",a.blendType=pc.BLEND_PREMULTIPLIED,a.update(),this.on("attr:intensity",(function(n,e){a.setParameter("intensity",n)}))};var CameraAnimation=pc.createScript("cameraAnimation");CameraAnimation.prototype.initialize=function(){this.orbitPos=void 0,this.orbitRot=void 0,this.pos=new pc.Vec3},CameraAnimation.prototype.update=function(t){},CameraAnimation.prototype.moveTo=function(t){console.log("Moving camera to ",t),this.enableOrbitScripts(!1),this.orbitPos=this.entity.getPosition().clone(),this.orbitRot=this.entity.getEulerAngles().clone(),this.pos=this.orbitPos.clone(),this.rot=this.orbitRot.clone(),this.app.tween(this.pos).to(t.getPosition(),1,pc.Linear).on("update",(function(t){this.entity.setPosition(this.pos)}),this).start(),this.app.tween(this.rot).to(t.getEulerAngles(),1,pc.Linear).on("update",(function(t){this.entity.setEulerAngles(this.rot)}),this).start()},CameraAnimation.prototype.reset=function(){this.app.tween(this.pos).to(this.orbitPos,1,pc.Linear).on("update",(function(t){this.entity.setPosition(this.pos)}),this).on("complete",(()=>this.enableOrbitScripts(!0)),this).start(),this.app.tween(this.rot).to(this.orbitRot,1,pc.Linear).on("update",(function(t){this.entity.setEulerAngles(this.rot)}),this).start()},CameraAnimation.prototype.enableOrbitScripts=function(t){this.entity.script.orbitCamera.enabled=t,this.entity.script.mouseInput.enabled=t,this.entity.script.touchInput.enabled=t};var EventToEvents=pc.createScript("eventToEvents");EventToEvents.attributes.add("inputEvent",{description:"Event that 'inputTarget' listens for.",type:"string"}),EventToEvents.attributes.add("inputTarget",{description:"Entity that listens for 'inputEvent'.",type:"entity"}),EventToEvents.attributes.add("outputEvents",{type:"json",array:!0,schema:[{name:"event",type:"string"},{name:"target",type:"entity"}]}),EventToEvents.prototype.initialize=function(){(this.inputTarget?this.inputTarget:this.app).on(this.inputEvent,(()=>{this.outputEvents.forEach((t=>{(t.target?t.target:this.app).fire(t.event)}))}),this)},EventToEvents.prototype.update=function(t){};var EntityEnableOnAr=pc.createScript("entityEnableOnAr");EntityEnableOnAr.attributes.add("enableOnDefault",{type:"boolean",description:"If set to true, this Entity will be Enabled when not in AR mode.",default:!0}),EntityEnableOnAr.attributes.add("enableOnAR",{type:"string",enum:[{Disabled:"disabled"},{Always:"always"},{"On Tracking":"onTracking"}],description:"Disabled: entity will always be disabled during AR session;\n        Always: entity will always be enabled during AR session, regardless if XR is available;\n        On Tracking: entity will only be enabled after the AR session has started tracking.",default:"onTracking"}),EntityEnableOnAr.prototype.initialize=function(){this._registerListeners("on"),this.on("destroy",this._onDestroy,this)},EntityEnableOnAr.prototype.postInitialize=function(){this.entity.enabled=this.enableOnDefault},EntityEnableOnAr.prototype._onDestroy=function(){this._registerListeners("off")},EntityEnableOnAr.prototype._registerListeners=function(t){this.app[t]("ar:request:start",this._startAugmentedRealitySession,this),this.app[t]("ar:onStart",this._onArStart,this),this.app[t]("ar:onTracking",this._onArTracking,this),this.app[t]("ar:onEnd",this._onArEnd,this)},EntityEnableOnAr.prototype._startAugmentedRealitySession=function(){this.entity.enabled=!1},EntityEnableOnAr.prototype._onArStart=function(){"always"===this.enableOnAR?this.entity.enabled=!0:this.entity.enabled=!1},EntityEnableOnAr.prototype._onArTracking=function(){"onTracking"===this.enableOnAR&&(this.entity.enabled=!0)},EntityEnableOnAr.prototype._onArEnd=function(){this.enableOnDefault&&(this.entity.enabled=!0)};var HtmlLoader=pc.createScript("htmlLoader");HtmlLoader.attributes.add("html",{type:"asset",assetType:"html",title:"Html Asset"}),HtmlLoader.attributes.add("cssAssets",{type:"asset",assetType:"css",array:!0,title:"Css Assets"}),HtmlLoader.attributes.add("externalScripts",{type:"asset",array:!0}),HtmlLoader.attributes.add("binderScriptName",{type:"string",title:"Binder Script Name"}),HtmlLoader.attributes.add("imgAssets",{type:"json",array:!0,schema:[{name:"class",type:"string"},{name:"img",type:"asset"}]}),HtmlLoader.attributes.add("imgUrls",{type:"json",array:!0,schema:[{name:"class",type:"string"},{name:"url",type:"string"}]}),HtmlLoader.prototype.initialize=function(){this.htmlElement=document.createElement("div"),this.htmlElement.innerHTML=this.html.resource,this.htmlElement.style.opacity=0,document.body.appendChild(this.htmlElement),this.on("destory",(function(){this.htmlElement.remove()})),this.loadCss(),this.bindScripts(),this.loadImg()},HtmlLoader.prototype.update=function(t){},HtmlLoader.prototype.loadImg=function(){for(var t=0;t<this.imgAssets.length;t++){let e=document.getElementById(this.imgAssets[t].class);e?e.src=this.imgAssets[t].img.getFileUrl():document.querySelectorAll("."+this.imgAssets[t].class).forEach((e=>{e.src=this.imgAssets[t].img.getFileUrl()}),this)}for(t=0;t<this.imgUrls.length;t++){let e=document.getElementById(this.imgUrls[t].class);e?e.src=this.imgUrls[t].url:document.querySelectorAll("."+this.imgUrls[t].class).forEach((e=>{e.src=this.imgUrls[t].url}),this)}},HtmlLoader.prototype.loadCss=function(){this.counter=0;for(var t=0;t<this.cssAssets.length;t++){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.onload=()=>{this.counter++,this.onLoaded()},e.href=this.cssAssets[t].getFileUrl(),document.head.appendChild(e),console.log(e),this.on("destroy",(function(){e.remove()}),this)}this.onLoaded()},HtmlLoader.prototype.onLoaded=function(){this.counter>=this.cssAssets.length&&(this.htmlElement.style.opacity=1)},HtmlLoader.prototype.bindScripts=function(){for(var t=[],e=0;e<this.externalScripts.length;e++){console.log(this.externalScripts[e]);var s=this.externalScripts[e].getFileUrl();const i=document.createElement("script");i.src=s;const r=new Promise(((t,e)=>{i.addEventListener("load",(()=>{console.log("Script "+i+" loaded"),t()}))}));t.push(r),document.head.appendChild(i),this.on("destroy",(function(){i.remove()}))}Promise.all(t).then((()=>{""!=this.binderScriptName&&(this.scriptBinder=this.entity.script.get(this.binderScriptName),this.scriptBinder.bindEvents(this.htmlElement))}))};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var ArGround=pc.createScript("ar-ground");ArGround.attributes.add("material",{type:"asset"}),ArGround.attributes.add("intensity",{type:"number",min:0,max:1,default:1}),ArGround.prototype.initialize=function(){const t=this.material.resource;t.chunks.APIVersion=pc.CHUNKAPI_1_62,t.chunks.endPS="\n        litShaderArgs.opacity = mix(light0_shadowIntensity, 0.0, shadow0);\n        gl_FragColor.rgb = vec3(0.0);\n    ",t.blendType=pc.BLEND_PREMULTIPLIED,t.update(),this.on("attr:intensity",(function(n,r){t.setParameter("intensity",n)}))};

//# sourceMappingURL=__game-scripts.js.map